"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[34699,38368],{6446:(e,t,i)=>{i.d(t,{Of:()=>s,UR:()=>n,Ws:()=>l,bv:()=>a});const s=Symbol("ImageElementInstance"),n=Symbol("VideoElementInstance");function r(e){return null!=e&&"object"==typeof e&&s in e}function l(e){return null!=e&&"object"==typeof e&&n in e}function a(e){return r(e)||l(e)}},32066:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var s=i(35143),n=(i(39356),i(19276)),r=i(50076),l=(i(81806),i(76460)),a=i(87663),o=i(50346),h=i(68134),c=i(46053),d=(i(47249),i(85842)),u=i(76797),p=i(2413),m=i(11352),y=i(65658),f=i(23290),_=(i(5766),i(86875),i(52394),i(15434),i(59784),i(86560),i(13442),i(28808),i(14522),i(89189),i(66388),i(19247),i(65215),i(23701),i(5095),i(62484),i(61425),i(15941),i(3789),i(5568),i(80963),i(62032),i(89425),i(15709),i(88764),i(9435),i(50724),i(94046),i(94168),i(73988),i(27847),i(33049),i(4754),i(31385),i(278),i(71687),i(6134),i(9190),i(5104),i(41704),i(16083),i(27150),i(19313),i(59422),i(71447),i(84202),i(48988),i(17400),i(54099),i(81447),i(61551),i(28608),i(93345),i(61247),i(61678),i(89241),i(84662),i(35048),i(63584),i(99588),i(19457),i(83531),i(29492),i(76418),i(8254),i(47709),i(3825),i(90534),i(29234),i(56789),i(32743),i(98590),i(5096),i(72729),i(12331),i(16946),i(89179),i(28972),i(69543),i(69539),i(90113),i(81320),i(13308),i(33346),i(13720),i(88075),i(38550),i(9410),i(57156),i(98112),i(42294),i(81615),i(29300),i(64346),i(26455),i(4480),i(46405),i(13312),i(41406),i(57162),i(86955),i(33721),i(68009),i(69679),i(38983),i(83755),i(73548),i(14556),i(55171),i(13692),i(28606),i(98773),i(19451),i(57105),i(31633),i(34111),i(7724),i(482),i(86599),i(63885),i(40181),i(93453),i(15389)),v=i(96345),w=i(46901),g=i(23717),E=i(2101),b=i(91196),S=i(34699),R=i(59752);let C=class extends((0,E.e)((0,S.default)(b.default))){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this._interaction=null,this.layer=null,this.elements=new n.default}initialize(){this.addHandles([(0,h.watch)((()=>[this.interactive,this.suspended]),(async()=>{if(this.interactive&&!this._interaction){const{MediaLayerInteraction:e}=await i.e(88740).then(i.bind(i,88740));this._interaction=new e({view:this.view,layer:this.layer}),this.selectedElement!==this._interaction.selectedElement&&(this._interaction.selectedElement=this.selectedElement),this.interactionOptions!==this._interaction.options&&(this._interaction.options=this.interactionOptions)}this._interaction&&(this._interaction.enabled=!this.suspended&&this.interactive)}),h.syncAndInitial),(0,h.watch)((()=>this.interactionOptions),(e=>{this._interaction&&(this._interaction.options=e)}),h.syncAndInitial),(0,h.watch)((()=>this.selectedElement),(e=>{this._interaction&&(this._interaction.selectedElement=e)}),h.syncAndInitial)])}attach(){this.addAttachHandles([(0,h.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,h.on)((()=>this.layer.effectiveSource),"change",(e=>{let{element:t}=e;return this._elementUpdateHandler(t)}))]),this._overlayContainer=new g.A,this.container.addChild(this._overlayContainer),this._fetchQueue=new _.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t),scheduler:this.scheduler,priority:R.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new v.A({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const i=[],s=e.normalize(),n=[s.x,s.y];for(const{elementView:{normalizedCoords:r,element:l}}of this._elementReferences.values())null!=r&&(0,m.t1)(r.rings,n)&&i.push({type:"media",element:l,layer:this.layer,mapPoint:e,sourcePoint:l.toSource(e)});return i.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new A(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[i,s]=e.setElements(t);this._referenceElements(e,i),this._dereferenceElements(e,s),this.requestUpdate()}),(e=>{(0,o.isAbortError)(e)||l.A.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const i=this.layer.effectiveSource;if(null==i)return[];this.view.featuresTilingScheme.getTileBounds(T,e,!0);const s=new u.default({xmin:T[0],ymin:T[1],xmax:T[2],ymax:T[3],spatialReference:this.view.spatialReference});return i.queryElements(s,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const i of t)this._referenceElement(e,i)}_referenceElement(e,t){(0,a.tE)(this._elementReferences,t.uid,(()=>{const e=new f._({element:t,spatialReference:this.view.spatialReference}),i=new w.A(e);return this._overlayContainer.addChild(i),this.elements.add(t),this._updatingHandles.addPromise(t.load().catch((e=>{l.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new r.default("element-load-error","Element cannot be displayed",{element:t,error:e}))}))),{debugGraphic:null,elementView:e,overlay:i,tiles:new Set}})).tiles.add(e)}_dereferenceElements(e,t){for(const i of t)this._dereferenceElement(e,i)}_dereferenceElement(e,t){const i=this._elementReferences.get(t.uid);i.tiles.delete(e),i.tiles.size||(this._overlayContainer.removeChild(i.overlay),i.overlay.destroy(),i.elementView.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(i.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const i=t.elementView.normalizedCoords;if(null==i)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.elementView.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const s=[],n=[];for(const e of this._tileStrategy.tiles){const r=x(this.view.featuresTilingScheme,e,i);t.tiles.has(e)?r||n.push(e):r&&s.push(e)}for(const t of s)this._referenceElement(t,e);for(const t of n)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.elementView.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const i=new f._({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=i)for(const s of this._tileStrategy.tiles)x(this.view.featuresTilingScheme,s,i)&&this._referenceElement(s,e)}};(0,s._)([(0,c.MZ)()],C.prototype,"layer",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"elements",void 0),C=(0,s._)([(0,d.$)("esri.views.2d.layers.MediaLayerView2D")],C);const T=(0,p.vt)(),V={xmin:0,ymin:0,xmax:0,ymax:0};function x(e,t,i){return e.getTileBounds(T,t.key,!0),V.xmin=T[0],V.ymin=T[1],V.xmax=T[2],V.ymax=T[3],(0,y.fA)(V,i)}class A{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],i=new Set(this.elements);this.elements=e;for(const s of e)i.has(s)?i.delete(s):t.push(s);return this.isReady=!0,[t,Array.from(i)]}destroy(){}}const M=C},34699:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var s=i(35143),n=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),l=i(91967);let a=class extends l.default{constructor(e){super(e),this.editSourcePoints=!1}};(0,s._)([(0,n.MZ)()],a.prototype,"editSourcePoints",void 0),a=(0,s._)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],a);let o=class extends l.default{constructor(e){super(e),this.tool="transform",this.reshapeOptions=new a}};(0,s._)([(0,n.MZ)()],o.prototype,"tool",void 0),(0,s._)([(0,n.MZ)({type:a})],o.prototype,"reshapeOptions",void 0),o=(0,s._)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],o);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.layer=null,this.interactive=!1,this.interactionOptions=new o,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return(0,s._)([(0,n.MZ)()],t.prototype,"layer",void 0),(0,s._)([(0,n.MZ)()],t.prototype,"interactive",void 0),(0,s._)([(0,n.MZ)({type:o})],t.prototype,"interactionOptions",void 0),(0,s._)([(0,n.MZ)()],t.prototype,"selectedElement",void 0),t=(0,s._)([(0,r.$)("esri.views.layers.MediaLayerView")],t),t}}}]);
//# sourceMappingURL=38368.5ca87ec3.chunk.js.map