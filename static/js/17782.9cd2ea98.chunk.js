"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[17782,53680,91505,95401],{770:(e,t,n)=>{n.d(t,{bG:()=>s,Ty:()=>o,YJ:()=>u,Fq:()=>c,vt:()=>l});var a=n(53084),i=n(42633);class r{constructor(e){const{name:t,label:n,description:a,schemes:r}=e;this.name=t,this.label=n,this.description=a,this.schemes=r;const s=e.basemapGroups||i.Np;let l=[];Object.keys(s).forEach((e=>{l=l.concat(s[e])})),this.supportedBasemaps=l,this.basemapGroups=s}isBasemapSupported(e){const t=(0,i.T1)(e,this.supportedBasemaps);return!(!t||!this.supportedBasemaps.includes(t))}getRawSchemes(e){const{basemapId:t,basemapTheme:n}=function(e,t,n){let a=null,r=null;if(t&&(a=(0,i.T1)(t,e,!1),a)){const e=(0,i.BV)(a);null!=e&&(r=e)}return!a&&n&&(a="dark"===n?"dark-gray":"gray",r=n),a||r||(a="gray",r="light"),{basemapId:a,basemapTheme:r}}(this.supportedBasemaps,e.basemap,e.basemapTheme);let r=n;if(t){const e=(0,i.BV)(t,this.basemapGroups);null!=e&&(r=e)}let s=e.geometryType;"multipoint"===s?s="point":"mesh"===s&&(s="polygon");const l=this.schemes[s]||this.schemes.default;return{schemesInfo:(0,a.clone)(l[r]),basemapId:t,basemapTheme:n}}}function s(e){const t=e.themeDictionary,n=new Map;for(const a in t){const e=t[a];n.set(a,new r(e))}return n}function l(e,t){const n=[];return e.forEach((e=>{e.isBasemapSupported(t)&&n.push({name:e.name,label:e.label,description:e.description,basemaps:[...e.supportedBasemaps]})})),n}function o(e,t){if(!e)return;if(!t)return;let n=null;const a=[t.primaryScheme,...t.secondarySchemes];for(const i of a)if(i.name?.toLowerCase()===e.toLowerCase()){n=i;break}return n}function u(e,t,n){if(!e&&!t)return[];if(!n)return[];const a=!e?.length,i=!t?.length,r=[n.primaryScheme,...n.secondarySchemes],s=[];for(const l of r){const n=!!a||e.some((e=>l.tags.includes(e))),r=!i&&t.some((e=>l.tags.includes(e)));n&&!r&&s.push(l)}return s}function c(e){const t=e.theme;if(t)return t.getRawSchemes({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme})}},17782:(e,t,n)=>{n.r(t),n.d(t,{createRenderer:()=>I,regenerateRenderer:()=>B});var a=n(59784),i=n(50076),r=n(68002),s=n(47662),l=n(9922),o=n(33766);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=Math.round(e);if(n<=1)return 1;const a=n.toString().length;for(let i=a-1>=3?3:a-1;i>=0;i--){const a=10**i,r=Math.floor(e/a)*a,s=Math.ceil(e/a)*a,l=Math.round((r+s)/2),o=Math.abs(e-r)/e*100,u=Math.abs(e-s)/e*100,c=Math.abs(e-l)/e*100,d=Math.min(o,u,c);if(d<=t){if(d===o){n=r;break}if(d===u){n=s;break}if(d===c){n=l;break}}}return n}var c=n(53680),d=n(51006),m=n(16525),p=n(28383),f=n(90494),y=n(42633),h=n(11563);async function b(e){const{layerAdapter:t,...n}=await async function(e){if(!(e&&e.layer&&e.attributes))throw new i.default("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(e.attributes.some((e=>!!e.valueExpression))&&!e.view)throw new i.default("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");e.forBinning&&(0,f.p)(e,"summary-statistics-for-attributes");const{layer:t,...n}=e,a=[h.mb.CSVLayer,h.mb.FeatureLayer,h.mb.OGCFeatureLayer,h.mb.GeoJSONLayer,h.mb.KnowledgeGraphSublayer,h.mb.ParquetLayer,h.mb.WFSLayer],r=e.forBinning?h.Mi:a,s=(0,h.Jg)(t,r,e.forBinning);if(!s)throw new i.default("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+(0,h.Ho)(r).join(", "));const l={layerAdapter:s,...n};l.includeZeros=null==l.includeZeros||l.includeZeros,l.includeNegatives=null==l.includeNegatives||l.includeNegatives;const o=l.view,u=null!=l.signal?{signal:l.signal}:null;await Promise.all([o?.when(),s.load(u)]);const c=[];for(const i of l.attributes){const e=await(0,y.EG)({field:i.field,valueExpression:i.valueExpression});Array.prototype.push.apply(c,e)}const d=(0,p.MH)(s,c,"summary-statistics-for-attributes:invalid-parameters");if(d)throw d;return l}(e),a=(0,p.D9)(n.attributes,n.includeZeros,n.includeNegatives);return t.summaryStatistics({valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,view:n.view,filter:n.filter,outStatisticTypes:y.XR,signal:n.signal})}var g=n(98976);function w(e,t,n){return null!=e&&isFinite(e)&&((t??!0)||0!==e)&&((n??!0)||e>=0)}async function v(e){const{features:t,attributes:n,includeZeros:a,includeNegatives:i,view:r}=e;let s=0,l=0,o=1/0,u=-1/0,c=null;const d=new Map;for(let p=0;p<n.length;p++){const{valueExpression:e}=n[p];if(e){if(!c){const{arcadeUtils:e}=await(0,g.lw)();c=e}d.set(p,c.createFunction(e))}}const m=r?c?.getViewInfo({viewingMode:"2d"===r.type?"map":r.viewingMode,scale:r.scale,spatialReference:r.spatialReference}):null;for(const p of t){const e=p.geometry,t=p.attributes;if(e){const f=e.extent;if(f){const e=f.width*f.height;if(e>0){let f=0;const y=c?.createExecContext(p,m,r?.timeZone);for(let e=0;e<n.length;e++){const{field:r,valueExpression:s}=n[e];let l=null;if(r)l=t[r];else if(s){const t=d.get(e);l=c.executeFunction(t,y)}w(l,a,i)&&(f+=l||0)}if(w(f,a,i)){const t=f/e;++s,l+=t,t<o&&(o=t),t>u&&(u=t)}}}}}return{minDensity:o!==1/0?o:null,maxDensity:u!==-1/0?u:null,avgDensity:s?l/s:null}}var S=n(91505);const x=500;async function V(e){const t=e.view;if(!(e?.layer&&t&&e.attributes?.length))throw new i.default("dot-density-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(e.attributes.length>8)throw new i.default("dot-density-renderer:invalid-parameters","Dot density renderer does not support more than 8 attributes");e.forBinning&&(0,f.p)(e,"dot-density-renderer");const n={...e,view:t,layer:e.layer,attributes:e.attributes},a=[h.mb.FeatureLayer,h.mb.ParquetLayer,h.mb.KnowledgeGraphSublayer,h.mb.OGCFeatureLayer,h.mb.GeoJSONLayer,h.mb.WFSLayer],r=e.forBinning?h.Mi:a,s=(0,h.Jg)(n.layer,r,e.forBinning);if(!s)throw new i.default("dot-density-renderer:invalid-parameters","'layer' must be one of these types: "+(0,h.Ho)(r).join(", "));n.dotBlendingEnabled??=!0,n.dotValueOptimizationEnabled??=!0;const l=null!=n.signal?{signal:n.signal}:null;if(await Promise.all([t.when(),s.load(l)]),"polygon"!==s.geometryType)throw new i.default("dot-density-renderer:not-supported","Dot density renderer is supported for polygon layers only");const o=[],u=n.attributes;for(const i of u){const e=await(0,y.EG)({field:i.field,valueExpression:i.valueExpression});o.push(...e)}const c=(0,d.MH)(s,o.filter(Boolean),"dot-density-renderer:invalid-parameters");if(c)throw c;return{...n,layer:s}}function E(e){return{dotValue:1,referenceScale:e.scale,minSliderValue:1,maxSliderValue:100}}async function z(e){const{view:t,layer:n,attributes:a,signal:i,filter:s}=e,l=await n.getSampleFeatures({view:t,sampleSize:x,returnGeometry:!0,filter:s,signal:i},"json"),[o,c]=await Promise.all([(0,m.A)({features:l,geometryType:n.geometryType}),b({layer:n,attributes:a,filter:s,includeZeros:!1,includeNegatives:!1,view:t,signal:i})]),d=null!=o&&"avgSize"in o&&o.avgSize,p=c.avg;if(!d||!p)return E(t);const f=(0,r.i1)(t.scale,t.spatialReference);return{dotValue:u(p/(d*d/(f*f)*.1))||1,referenceScale:t.scale,minSliderValue:1,maxSliderValue:u(p)}}async function T(e){const{view:t,layer:n,attributes:a,signal:i,filter:s}=e,l=[];for(const r of a){const e=await(0,y.EG)({field:r.field,valueExpression:r.valueExpression});l.push(...e)}const o=await n.getSampleFeatures({view:t,sampleSize:x,requiredFields:l,filter:s,returnGeometry:!0,signal:i},"json"),{minDensity:c,maxDensity:d,avgDensity:m}=await v({features:o,attributes:a,includeZeros:!1,includeNegatives:!1,view:t});if(!m||!c||!d)return E(t);const p=(0,r.i1)(t.scale,t.spatialReference),f=p*p,h=u(c*f),b=u(d*f);let g=u(m*f*10)||1;return g>b&&(g=b),{dotValue:g,referenceScale:t.scale,minSliderValue:h,maxSliderValue:b}}async function I(e){const t=await V(e),n=t.layer,r=n.geometryType,u=await async function(e){let t=e.dotDensityScheme,n=null,a=null;const i=await(0,d.Ib)(e.basemap,e.view);if(n=null!=i.basemapId?i.basemapId:null,a=null!=i.basemapTheme?i.basemapTheme:null,t)return{scheme:(0,S.cloneScheme)(t),basemapId:n,basemapTheme:a};const r=(0,S.getSchemes)({numColors:e.attributes.length,basemapTheme:a});return r&&(t=r.primaryScheme,n=r.basemapId,a=r.basemapTheme),{scheme:t,basemapId:n,basemapTheme:a}}(t),c=u?.scheme;if(!c)throw new i.default("dot-density-renderer:insufficient-info","Unable to find dot-density scheme");const m=t.view,p=t.filter,f={layer:n,view:m,filter:p,attributes:t.attributes,signal:t.signal},y={layer:t.layer,view:m,filter:p,signal:t.signal},[h,b]=await Promise.all([t.trueDensity?T(f):z(f),t.outlineOptimizationEnabled?(0,o.A)(y).catch(d.ou):null]),{dotValue:g,referenceScale:w,minSliderValue:v,maxSliderValue:x}=h,E=(0,a.Iy)(c.colors,t.attributes.length),I=t.attributes.map(((e,t)=>({field:e.field,valueExpression:e.valueExpression,label:e.label,valueExpressionTitle:e.valueExpressionTitle,color:E[t]}))),B=new s.default({attributes:I,dotBlendingEnabled:t.dotBlendingEnabled,outline:b?(0,d.qc)(c,r,b.opacity):null,dotValue:g,referenceScale:t.dotValueOptimizationEnabled?w:null,legendOptions:t.legendOptions});return b?.visualVariables.length&&(B.visualVariables=b.visualVariables.map((e=>e.clone()))),B.authoringInfo=new l.default({type:"dot-density",minSliderValue:v,maxSliderValue:x}),{renderer:B,dotDensityScheme:c,basemapId:u.basemapId,basemapTheme:u.basemapTheme}}async function B(e){const{creatorParameters:t,renderer:n}=await async function(e){const t="regenerate-dot-density-renderer";await(0,c.AC)(e,t);const n=await(0,c.mE)(e);if("dot-density"!==(0,c.UJ)(n))throw new i.default(`${t}:invalid-parameters`,"Renderer is invalid");const{layer:a,forBinning:r,filter:s,view:l,signal:o}=e,u=(0,c.DW)(n),d=n.attributes.map((e=>({field:e.field,valueExpression:e.valueExpression,label:e.label,valueExpressionTitle:e.valueExpressionTitle}))),m=await V({layer:a,attributes:d,dotValueOptimizationEnabled:null!=n.referenceScale,outlineOptimizationEnabled:u,forBinning:r,filter:s,view:l,signal:o});return{...e,creatorParameters:m,renderer:n}}(e),{layer:a,attributes:r,outlineOptimizationEnabled:s,view:l,signal:u,filter:m}=t,p={layer:a,view:l,filter:m,attributes:r,signal:u},[f,y]=await Promise.all([t.trueDensity?T(p):z(p),s?(0,o.A)({layer:a,view:l,signal:u,filter:m}).catch(d.ou):null]),{dotValue:h,referenceScale:b,minSliderValue:g,maxSliderValue:w}=f;return n.dotValue=h,n.referenceScale=t.dotValueOptimizationEnabled?b:null,n.authoringInfo&&(n.authoringInfo.minSliderValue=g,n.authoringInfo.maxSliderValue=w),(0,c.ke)(n,y?.visualVariables,c._i),{renderer:n}}},53680:(e,t,n)=>{n.d(t,{AC:()=>i,DW:()=>o,Hj:()=>S,Ih:()=>y,Jy:()=>d,OW:()=>b,Rv:()=>u,UJ:()=>l,_i:()=>c,d8:()=>p,fs:()=>m,kc:()=>f,ke:()=>v,mE:()=>r,wx:()=>s});var a=n(50076);async function i(e,t){const{layer:n,view:i,forBinning:r,filter:s}=e;if(!n||!i)throw new a.default(`${t}:missing-parameters`,"'layer' and 'view' parameters are required");await n.load();const l="featureReduction"in n?n.featureReduction:null;if(r){if("binning"!==l?.type)throw new a.default(`${t}:invalid-parameters`,"'layer' must have 'featureReduction' property defined with 'binning' type when 'forBinning' parameter is true");if(s)throw new a.default(`${t}:invalid-parameters`,"'filter' parameter is not supported when 'forBinning' parameter is true")}return e}async function r(e){const{layer:t,forBinning:n,renderer:i}=e;await t.load();const r="featureReduction"in t?t.featureReduction:null,s=i?.clone()??(n&&"binning"===r?.type?r?.renderer?.clone():"renderer"in t?t.renderer?.clone():null);if(!s)throw new a.default("get-renderer-to-update:invalid-parameters","renderer not available");return s}function s(e,t,n){const a=e?.authoringInfo?.visualVariables;return a?.find((e=>"reference-size"===n?e.type===t&&"reference-size"===e.theme:e.type===t))}function l(e){if(!e)return null;const t=e.type,n="visualVariables"in e?e.visualVariables:null,a=n?.find(y),i=n?.find(b),r=e.authoringInfo,l=s(e,"color"),o=s(e,"size"),u=s(e,"size","reference-size");if("class-breaks"===t){if("univariate-color-size"===r?.type)return"univariate-color-size";if(a)return i?o?.units?"color-size-age":l?.units?"color-age-size":"color-size":l?.units?"color-age":u?"color-size":"color-continuous";if(i)return o?.units?"size-age":"size-continuous";if(e.classBreakInfos.length>1)return"class-breaks-color"===r?.type?"color-class-breaks":"class-breaks-size"===r?.type?"size-class-breaks":null;if(u)return"size-continuous"}return"unique-value"===t?e.valueExpression?"predominance"===r?.type?"predominance":"relationship"===r?.type?i||u?"relationship-size":"relationship":i||u?"type-size":"type":i?o?.units?"type-size-age":"type-size":u?"type-size":"type":"pie-chart"===t?"pie-chart":"dot-density"===t?"dot-density":null}function o(e){return!!e.visualVariables?.some(g)}function u(e){return!!e.visualVariables?.some(w)}function c(e){return e?.findIndex(g)??-1}function d(e){return e?.findIndex(b)??-1}function m(e){return e?.findIndex(y)??-1}function p(e){return e?.findIndex(h)??-1}function f(e){return e?.findIndex(w)??-1}function y(e){return"color"===e.type}function h(e){return"opacity"===e.type}function b(e){return"size"===e.type&&"outline"!==e.target&&"$view.scale"!==e.valueExpression}function g(e){return"size"===e.type&&"outline"===e.target}function w(e){return"size"===e.type&&"$view.scale"===e.valueExpression&&"outline"!==e.target&&Array.isArray(e.stops)}function v(e,t,n){const a=e.visualVariables,i=n(a);if(!t||Array.isArray(t)&&!t.length)return;Array.isArray(t)||(t=[t]);const r=t.map((e=>e.clone()));a?i>-1?a.splice(i,1,...r):a.push(...r):e.visualVariables=r}function S(e,t,n){const a=t?.visualVariables.find((e=>e.type===n)),i=s(e,n);i&&a&&(i.minSliderValue=a.minSliderValue,i.maxSliderValue=a.maxSliderValue,"size"===n&&"reference-size"===i.theme&&(i.sizeStops=a.sizeStops?.map((e=>e.clone())),i.referenceSizeScale=a.referenceSizeScale))}},91505:(e,t,n)=>{n.r(t),n.d(t,{cloneScheme:()=>y,getSchemeByName:()=>p,getSchemes:()=>m,getSchemesByTag:()=>f,getThemes:()=>d});var a=n(69539),i=n(18690),r=n(59784),s=n(89132),l=n(770);const o={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"}},u=["vibrant-rainbow","cat-dark","predominant-v2","predominant-v1","predominance-race","desert-blooms","tropical-bliss","under-the-sea","ocean-bay","cat-light","predominant-v4","predominance-money","predominant-v3","predominance-race-ethnic","pastel-chalk","predominance-rainbow","predominance-sequence","cat-popup-olympic-sunset"],c=(0,l.bG)({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for visualizing features using the density of randomly placed dots.",schemes:{default:{light:{primary:"predominant-v5",secondary:u,common:{outline:o.light,fillOpacity:.8}},dark:{primary:"predominant-v5",secondary:u,common:{outline:o.dark,fillOpacity:.8}}}}}}});function d(e){return(0,l.vt)(c,e)}function m(e){const t=(0,l.Fq)({basemap:e.basemap,basemapTheme:e.basemapTheme,theme:c.get("default")});if(!t)return;const{schemesInfo:n,basemapId:a,basemapTheme:r}=t,s=n.common,o=e.numColors;return{primaryScheme:h(n.primary,s,o),secondarySchemes:n.secondary.map((e=>h(e,s,o))).filter(i.Ru),basemapId:a,basemapTheme:r}}function p(e){return(0,l.Ty)(e.name,m(e))}function f(e){return(0,l.YJ)(e.includedTags,e.excludedTags,m(e))}function y(e){if(!e)return;const t={...e};return t.tags=[...t.tags],t.colors&&(t.colors=t.colors.map((e=>new a.default(e)))),t.outline&&(t.outline={color:t.outline.color&&new a.default(t.outline.color),width:t.outline.width}),t}function h(e,t,n){const i=s.A[e];if(i)return function(e){return{name:e.name,tags:[...e.tags],colors:e.colors.map((e=>new a.default(e))),outline:{color:new a.default(e.outline.color),width:e.outline.width},opacity:e.opacity}}({name:i.name,tags:i.tags,colors:i[n]||(0,r.Iy)(i.stops,n),opacity:t.fillOpacity,outline:t.outline})}}}]);
//# sourceMappingURL=17782.9cd2ea98.chunk.js.map