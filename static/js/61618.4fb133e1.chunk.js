"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[9805,32186,56203,61618,70961],{4852:(e,t,a)=>{a.d(t,{Ad:()=>g,O_:()=>d,m6:()=>m,wF:()=>p,y0:()=>h});var i=a(3825),r=a(50076),n=a(15941),o=a(50346),s=a(90534),l=a(97572),c=a(44538),u=a(38338);const h=e=>"FA"===e,d=async(e,t,i)=>{const n=new(await Promise.resolve().then(a.bind(a,9708)).then((e=>e.default)))({objectIds:[t]}),o=await e.queryAttachments(n,i),s=o[`${t}`]?.[0],l=s?.url;if(!l)throw new r.default("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:s.contentType.split("/")[1].toUpperCase(),url:l}};async function p(e,t){const i="string"==typeof e,r=i?e:e.url,{pathname:n,searchParams:l,origin:c}=new URL(r);let h=i?(0,s.getPathExtension)(n):e.datasetFormat;h||(h=await(0,u.gt)(r));const d=await Promise.resolve().then(a.bind(a,80068)).then((e=>e.default)),p=await d.open({ioConfig:{customFetchParameters:Object.fromEntries(l),skipMapInfo:!0},datasetFormat:h?.toUpperCase(),url:`${c}${n}`,signal:t?.signal});return p?async function(e,t){const{level:a,offset:i,size:r}=function(e){const{storageInfo:t,width:a,height:i}=e.rasterInfo,{maximumPyramidLevel:r,pyramidScalingFactor:n}=t,o=n??2;return{level:r,offset:{x:0,y:0},size:{width:Math.ceil(a/o**r),height:Math.ceil(i/o**r)}}}(e),{pixelBlock:n}=await e.fetchRawPixels(a,i,r,t);return(0,o.throwIfAborted)(t),n}(p,{signal:t?.signal}):null}async function m(e,t,a){if(!e)throw new r.default("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:n,url:o}=await d(e,+t,a);return(0,u.RP)(n)?await p({datasetFormat:n,url:o},a):(await(0,i.default)(o,{...a,useRequestQueue:!0,responseType:"image",query:{w:c.RK}})).data}function g(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{height:i,width:r}=e;t.width=r,t.height=i;const o=t.getContext("2d");if(!o)return;const s=function(e,t,a){const i=document.createElement("canvas"),r=i.getContext("2d");if(e instanceof HTMLImageElement)i.width=e.width,i.height=e.height,r?.drawImage(e,0,0);else{const n=a.createImageData(t.width,t.height);n&&(n.data.set(e.getAsRGBA()),i.width=n.width,i.height=n.height,r?.putImageData(n,0,0))}return i}(e,t,o);s.getContext("2d")&&(a>0?function(e,t,a,i,r){const o=(0,n.kU)(r),s=[(0,l.cC)(0,0,o),(0,l.cC)(a,0,o),(0,l.cC)(a,i,o),(0,l.cC)(0,i,o)],c=Math.max(...s.map((e=>e[0])))-Math.min(...s.map((e=>e[0]))),u=Math.max(...s.map((e=>e[1])))-Math.min(...s.map((e=>e[1]))),h=Math.min(a/c,i/u);e.save(),e.clearRect(0,0,a,i),e.translate(a/2,i/2),e.rotate(o),e.scale(h,h),e.drawImage(t,-a/2,-i/2,a,i),e.restore()}(o,s,r,i,a):o.drawImage(s,0,0))}},11113:(e,t,a)=>{a.d(t,{Ee:()=>l,Jd:()=>f,Nk:()=>d,OM:()=>y,Oo:()=>g,W4:()=>c,ix:()=>p,t_:()=>h,tr:()=>u,yh:()=>m,zJ:()=>o});var i=a(73582),r=a(24648),n=a(96820);function o(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,n.zJ)(e,(0,r.kM)(t,a).value,a,i,o)}function s(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,n.nD)(e,(0,r.kM)(t,a).value,a,i,o)}function l(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Ee)(e,t.value,t.unit,a,i)}function c(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.W4)(e,t.value,t.unit,a,i)}function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.tr)(e,t.value,t.unit,a,i)}function h(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.t_)(e,t.value,t.unit,a,i)}function d(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.ie,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,n.Me)(e.value,e.unit,e.rotationType,t,a,r,o)}function p(e,t,a,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i=i??2,a){case"imperial":return u(e,t,i,r);case"metric":return l(e,t,i,r);default:return o(e,t,a,i,r)}}function m(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(a){case"imperial":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.J1)(e,t.value,t.unit,a,i)}(e,t,i,r);case"metric":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Mm)(e,t.value,t.unit,a,i)}(e,t,i,r);default:return s(e,t,a,i,r)}}function g(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(a){case"imperial":return h(e,t,i,r);case"metric":return c(e,t,i,r);default:return o(e,t,a,i,r)}}function y(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(a){case"imperial":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.LF)(e,t.value,t.unit,a,i)}(e,t,i,r);case"metric":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.e_)(e,t.value,t.unit,a,i)}(e,t,i,r);default:return s(e,t,a,i,r)}}function f(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(a){case"imperial":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.Sz)(e,t.value,t.unit,a,i)}(e,t,i,r);case"metric":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,n.zq)(e,t.value,t.unit,a,i)}(e,t,i,r);default:return o(e,t,a,i,r)}}},19562:(e,t,a)=>{a.d(t,{C1:()=>R,FT:()=>M,Fz:()=>_,IL:()=>x,Jb:()=>C,Mi:()=>F,OO:()=>f,P1:()=>w,PR:()=>A,Tu:()=>S,Xg:()=>P,at:()=>v,dg:()=>Z,fg:()=>O,ov:()=>b,pB:()=>I,ph:()=>k});var i=a(69539),r=a(19276),n=a(59784),o=a(89465),s=a(84847),l=a(27796),c=a(34913),u=a(94918),h=a(47943),d=a(54347),p=a(37471),m=a(86875),g=a(38996),y=a(76940);const f=new y.default({size:15,style:"circle",color:[255,102,102,.5],outline:null}),v=new y.default({size:10,style:"circle",color:[0,128,192,.5],outline:null}),w=new m.default({style:"solid",color:[0,128,192,.5],outline:null}),_=new m.default({style:"solid",color:[255,102,102,.5],outline:null}),M=new y.default({size:10,style:"diamond",color:[255,102,102],outline:null}),b=new p.default({symbolLayers:new r.default([new l.default({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),x=new p.default({symbolLayers:new r.default([new h.default({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),I=new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),P=new u.default({symbolLayers:new r.default([new s.default({material:{color:[255,102,102,.5]},edges:null})])}),F=new u.default({symbolLayers:new r.default([new s.default({material:{color:[0,128,192,.25]},edges:null})])}),R=new y.default({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),A=new p.default({symbolLayers:new r.default([new h.default({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3.5;return new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:(0,n.bJ)(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}})},S=new c.default({symbolLayers:new r.default([new d.default({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),O=e=>new m.default({color:(0,n._L)(e,.3),outline:{color:e,width:2}});function Z(e){switch(e){case"point":return e=>new y.default({size:10,style:"circle",color:e??V(),outline:new g.default({color:[0,0,0],width:2})});case"polygon":return e=>new m.default({color:null,outline:z(e),style:"none"});case"polyline":return e=>z(e)}}function V(){return new i.default([255,0,0])}function z(e){return new g.default({color:e??V(),width:2})}function k(e,t,a){return e===t?a:"polyline"===e?z(a?.color):function(e){return new m.default({color:null,outline:z(e),style:"none"})}(a?.color)}},32186:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var i,r=a(35143),n=a(42553),o=a(46053),s=(a(81806),a(76460),a(47249),a(85842)),l=a(34761),c=a(13191),u=a(60008),h=a(4336),d=a(9392),p=a(52896);let m=i=class extends n.A{constructor(e){super(e),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(p.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(g,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,g,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new i(e)}};(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"translation",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAxis",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAngle",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"scale",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"rotation",null),(0,r._)([(0,o.MZ)()],m.prototype,"localMatrix",null),(0,r._)([(0,o.MZ)()],m.prototype,"localMatrixInverse",null),m=i=(0,r._)([(0,s.$)("esri.geometry.support.MeshTransform")],m);const g=(0,h.vt)(),y=m},39839:(e,t,a)=>{a.d(t,{$0:()=>G,AG:()=>_,AX:()=>B,CN:()=>$,EH:()=>T,Fj:()=>j,Md:()=>U,QI:()=>W,QV:()=>J,Qu:()=>v,WB:()=>N,Z9:()=>C,_I:()=>A,bO:()=>x,cG:()=>D,eY:()=>I,gO:()=>E,jr:()=>b,lW:()=>z,mf:()=>w,uH:()=>H,wv:()=>L,yP:()=>q});var i=a(50346),r=a(11113),n=a(24648),o=a(19555),s=a(63391),l=a(19247),c=a(65215),u=a(23701),h=a(9624),d=a(13312),p=a(7137),m=a(20749),g=a(97572),y=a(85367);const f=1e5;function v(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function w(e,t){let a=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return a<0&&(a+=180),a*Math.PI/180}function _(e,t,a){if(!e?.length||!t?.length||!a)return;const[i,r]=e,[,n]=t,o=n-r;return[i+o*Math.cos(a),r+o*Math.sin(a)]}function M(e,t,a){if((0,p.isSupported)(e)){const e=(0,p.geodesicLengths)([t],"meters")[0];return{area:(0,p.geodesicAreas)([a],"square-meters")[0],perimeter:e}}const i=d.default.WGS84,r=(0,h.project)(t,i),n=(0,h.project)(a,i);let o=(0,s.geodesicDensify)(n,f);if(o=(0,s.simplify)(o),!o)return null;const l=(0,p.geodesicLengths)([r],"meters")[0];return{area:(0,p.geodesicAreas)([o],"square-meters")[0],perimeter:l}}async function b(e,t,a,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;if(t.length<2||!r||!a||!e)return null;const s=E(a,e);if(!s)return null;const l=t.map((e=>[e.x,e.y])),c=l.at(0),u=l.at(-1);if(!c||!u)return null;const h=s.map((t=>B([c,u],t,e,n,!1))),d=await Promise.all(h);(0,i.throwIfAborted)(o);let p=0;for(const i of d){if(!i)return null;const e=Math.abs(i-r);p=Math.max(e,p)}return p}async function x(e,t,a,r,n){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(t.length<2||!r||!a||!e)throw new Error("Missing parameters");const l=D(a,e),c=t.map((e=>[e.x,e.y])),u=c.at(0),h=c.at(-1),d=l.map((t=>W([u,h],t,e,n,o,!1))),p=await Promise.all(d);(0,i.throwIfAborted)(s);let m=0;for(const i of p){if(!i)return 0;const e=Math.abs(i-r);m=Math.max(e,m)}return m}function I(e,t){const a=G(e,!1);if(a?.length)return 20*(0,o.Io)([a[0].x,a[0].y],[a.at(-1).x,a.at(-1).y])/t}function P(e){const t=e.spatialReference;if(t.isGeographic){if((0,p.isSupported)(t))return(0,p.geodesicLengths)([e],"meters")[0];const a=(0,h.project)(e,d.default.WGS84);return(0,p.geodesicLengths)([a],"meters")[0]}return t.isWebMercator?(0,s.geodesicLength)(e,"meters"):(0,s.planarLength)(e,"meters")}function F(e,t){const a=(0,s.simplify)(t);if(!a)return null;const i=(0,s.planarLength)(e,"meters");return{area:(0,s.planarArea)(a,"square-meters"),perimeter:i}}function R(e,t){let a=(0,s.geodesicDensify)(t,f,"meters");if(a=(0,s.simplify)(a),!a)return null;const i=(0,s.geodesicLength)(e,"meters");return{area:(0,s.geodesicArea)(a,"square-meters"),perimeter:i}}async function A(e,t,a){if(!t||!e)throw new Error("Missing required parameters");const r=await(0,m.imageToWorld)(e,t);(0,i.throwIfAborted)(a);const n=r.clone();n.z?n.z+=20:n.z=20;const{averageElevation:o,cameraPitch:s,cameraRoll:l,farDistance:c,...u}=t;return(0,y.worldToImage)(n,u)}async function C(e,t,a,r){const{attributes:n}=a,{location:o}=n,{updateElevationProps:s,...l}=t;if(!e||!t)throw new Error("Missing parameters");let c=o.clone();c.spatialReference.isGeographic&&(c=await(0,h.projectWithZConversion)(c,d.default.WebMercator));const u=await(0,m.imageToWorldPanoramic)(e,{...l,cameraLocation:c},s);(0,i.throwIfAborted)(r);const p=u.clone();return p.z?p.z+=20:p.z=20,(0,y.worldToImagePanoramic)(p,l)}function S(e,t,a,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,cameraPitch:c,cameraRoll:u,farDistance:h,...d}=i;if(r>=5||n<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),m=(0,y.worldToImage)(p,d),g=(0,o.Io)([a[0].x,a[0].y],[m.x,m.y]),f=a.at(0),v=a.at(-1);if(!f||!v)return null;const w=(0,o.Io)([f.x,f.y],[v.x,v.y])*e/g;return S(w,t,a,i,r+1,Math.abs(e-w))}function O(e,t,a,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,horizontalFieldOfView:c,verticalFieldOfView:u,farDistance:h,...d}=i;if(r>=5||n<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),m=(0,y.worldToImagePanoramic)(p,d),g=(0,o.Io)([a[0].x,a[0].y],[m.x,m.y]),f=a.at(0),v=a.at(-1);if(!f||!v)return null;const w=(0,o.Io)([f.x,f.y],[v.x,v.y])*e/g;return O(w,t,a,i,r+1,Math.abs(e-w))}async function Z(e,t){const{updateElevationProps:a,...i}=t;return await(0,m.imageToWorld)(e,i,a)}async function V(e,t){const{updateElevationProps:a,...i}=t;return(0,m.imageToWorldPanoramic)(e,i,a)}function z(e){navigator.clipboard.writeText(e).catch((e=>{throw e}))}function k(e){const t=e.map((e=>[e.x,e.y])),a=e[0].spatialReference;return new u.default({paths:[t],spatialReference:a})}function G(e,t){return e.map((e=>({x:t?.5+e[0]:e[0],y:t?.5-e[1]:e[1]})))}function L(e,t,a,i,o){const s="measurement"===e?t:a;if(o&&s)return(0,r.ix)(i,(0,n.d_)(s,"meters"),o,3)||null}function E(e,t){const{cameraPitch:a,cameraRoll:i,cameraLocation:r}=e,{x:n,y:o,z:s,spatialReference:c}=r;if(t.every((e=>0===e))||!t||!t.length)return null;const[u,h,,d,p]=t,m=[-d,0,d],g=[-p,0,p],y=[-u,0,u],f=[-h,0,h],v=[];for(const w of m)for(const t of g)for(const r of y)for(const u of y)for(const h of f){const d={...e};d.cameraPitch=a+w,d.cameraRoll=i+t,d.cameraLocation=new l.default({x:n+r,y:o+u,z:s?s+h:0,spatialReference:{wkid:c.wkid}}),v.push(d)}return v}function D(e,t){const{cameraHeading:a,cameraLocation:i}=e,{x:r,y:n,z:o,spatialReference:s}=i;if(t.every((e=>0===e))||!t||!t.length)throw new Error("Invalid parameters");const[c,u,h]=t,d=h>0?[-h,0,h]:[],p=c>0?[-c,0,c]:[],m=u>0?[-u,0,u]:[],g=[];for(const y of d)for(const t of p)for(const i of p)for(const c of m){const u={...e};u.cameraHeading=a+y,u.cameraLocation=new l.default({x:r+t,y:n+i,z:o?o+c:0,spatialReference:{wkid:s.wkid}}),g.push(u)}return g}function T(e,t,a,i,o){const s="measurement"===e?t:N(a);if(o&&s)return(0,r.ix)(i,(0,n.d_)(s,"meters"),o,3)||null}function H(e,t,a,i,o){const s="measurement"===e?t:a;if(o&&s)return(0,r.Jd)(i,(0,n.gT)(s,"square-meters"),o,3)||null}function N(e){return Math.sqrt(e.reduce(((e,t)=>e+t**2),0))}function j(e,t,a){if("default"===t)return e;const i={x:e[0],y:e[1],z:e[2]},r=(0,g.pq)(i,a[0],a[1]);return[r.x,r.y]}async function B(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;if(!e||!t||e.length<2)return null;const l=G(e,r);if(!l||l.length<2)return null;const[c,u]=[l[0],l.at(-1)];if(!u)return null;const h=[c],d=await(0,m.imageToWorld)(c,t);(0,i.throwIfAborted)(s);const p=d.clone();p.z?p.z+=20:p.z=20;const{averageElevation:g,cameraPitch:f,cameraRoll:w,farDistance:M,...b}=t,x=(0,y.worldToImage)(p,b),I=(0,o.Io)([c.x,c.y],[x.x,x.y]),P=v(c,x);if(!P)return;const F=_([c.x,c.y],[u.x,u.y],P);if(!F?.length)return;h.push({x:F[0],y:F[1]});const R=20*(0,o.Io)([h[0].x,h[0].y],[h[1].x,h[1].y])/I;if(!n)return R;const A=S(R,d,h,t,0,1);return A?.value}async function W(e,t,a,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const{attributes:c}=r,{location:u}=c,{updateElevationProps:p,...g}=t;if(!e||!t||e.length<2)throw new Error("Invalid parameters");const f=G(e,n),[w,M]=[f[0],f.at(-1)],b=[w];let x=u.clone();x.spatialReference.isGeographic&&(x=await(0,h.projectWithZConversion)(x,d.default.WebMercator));const I=await(0,m.imageToWorldPanoramic)(w,{...g,cameraLocation:x},p);(0,i.throwIfAborted)(l);const P=I.clone();P.z?P.z+=20:P.z=20;const F=(0,y.worldToImagePanoramic)(P,g),R=(0,o.Io)([w.x,w.y],[F.x,F.y]),A=v(w,F);if(!A)return;const C=_([w.x,w.y],[M.x,M.y],A);if(!C?.length)return;b.push({x:C[0],y:C[1]});const S=20*(0,o.Io)([b[0].x,b[0].y],[b[1].x,b[1].y])/R;if(!s)return S;const Z=O(S,I,b,t,0,1);return Z?.value}async function U(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<3)return null;const i=G(e,a),r=await Z(i,t),n=r.map((e=>{let{x:t,y:a}=e;return[t,a]}));e.push(e[0]),n.push(n[0]);const o=r[0].spatialReference,s=new u.default({paths:[n],spatialReference:o}),l=new c.default({rings:[n],spatialReference:o});return o.isGeographic?M(o,s,l):o.isWebMercator?R(s,l):F(s,l)}async function q(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(e.length<3)return null;const n=G(e,a),o=await V(n,t);(0,i.throwIfAborted)(r);const s=o.map((e=>{let{x:t,y:a}=e;return[t,a]}));e.push(e[0]),s.push(s[0]);const l=o[0].spatialReference,h=new u.default({paths:[s],spatialReference:l}),d=new c.default({rings:[s],spatialReference:l});return l.isGeographic?M(l,h,d):l.isWebMercator?R(h,d):F(h,d)}async function $(e,t){const a=G(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return P(k(await Z(a,t)))}async function J(e,t){let a=arguments.length>3?arguments[3]:void 0;const r=G(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),n=await V(r,t);return(0,i.throwIfAborted)(a),P(k(n))}},56203:(e,t,a)=>{a.r(t),a.d(t,{buffer:()=>z,changeDefaultSpatialReferenceTolerance:()=>K,clearDefaultSpatialReferenceTolerance:()=>Y,clip:()=>m,contains:()=>y,convexHull:()=>A,crosses:()=>f,cut:()=>g,densify:()=>B,difference:()=>C,disjoint:()=>x,distance:()=>v,equals:()=>w,extendedSpatialReferenceInfo:()=>p,flipHorizontal:()=>H,flipVertical:()=>N,generalize:()=>j,geodesicArea:()=>$,geodesicBuffer:()=>k,geodesicDensify:()=>W,geodesicLength:()=>J,intersect:()=>O,intersectLinesToPoints:()=>Q,intersects:()=>_,isSimple:()=>F,nearestCoordinate:()=>G,nearestVertex:()=>L,nearestVertices:()=>E,offset:()=>V,overlaps:()=>I,planarArea:()=>U,planarLength:()=>q,relate:()=>P,rotate:()=>T,simplify:()=>R,symmetricDifference:()=>S,touches:()=>M,union:()=>Z,within:()=>b});var i=a(16783),r=a(19247),n=a(19902);function o(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function s(e){return e?Array.isArray(e)?e.map(s):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,n.fromJSON)(e))):(0,n.fromJSON)(e)}let c;async function u(){return c||(c=(0,i.ho)("geometryEngineWorker",{strategy:"distributed"})),c}async function h(e,t){return(await u()).invoke("executeGEOperation",{operation:e,parameters:s(t)})}async function d(e,t){const a=await u();return Promise.all(a.broadcast("executeGEOperation",{operation:e,parameters:s(t)}))}function p(e){return h("extendedSpatialReferenceInfo",[e])}async function m(e,t){return l(await h("clip",[o(e),e,t]))}async function g(e,t){return l(await h("cut",[o(e),e,t]))}function y(e,t){return h("contains",[o(e),e,t])}function f(e,t){return h("crosses",[o(e),e,t])}function v(e,t,a){return h("distance",[o(e),e,t,a])}function w(e,t){return h("equals",[o(e),e,t])}function _(e,t){return h("intersects",[o(e),e,t])}function M(e,t){return h("touches",[o(e),e,t])}function b(e,t){return h("within",[o(e),e,t])}function x(e,t){return h("disjoint",[o(e),e,t])}function I(e,t){return h("overlaps",[o(e),e,t])}function P(e,t,a){return h("relate",[o(e),e,t,a])}function F(e){return h("isSimple",[o(e),e])}async function R(e){return l(await h("simplify",[o(e),e]))}async function A(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l(await h("convexHull",[o(e),e,t]))}async function C(e,t){return l(await h("difference",[o(e),e,t]))}async function S(e,t){return l(await h("symmetricDifference",[o(e),e,t]))}async function O(e,t){return l(await h("intersect",[o(e),e,t]))}async function Z(e){const t=function(e,t){let a;return Array.isArray(e)?a=e:(a=[],a.push(e),null!=t&&a.push(t)),a}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null);return l(await h("union",[o(t),t]))}async function V(e,t,a,i,r,n){return l(await h("offset",[o(e),e,t,a,i,r,n]))}async function z(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=[o(e),e,t,a,i];return l(await h("buffer",r))}async function k(e,t,a,i,r,n){const s=[o(e),e,t,a,i,r,n];return l(await h("geodesicBuffer",s))}async function G(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=await h("nearestCoordinate",[o(e),e,t,a]);return{...i,coordinate:r.default.fromJSON(i.coordinate)}}async function L(e,t){const a=await h("nearestVertex",[o(e),e,t]);return{...a,coordinate:r.default.fromJSON(a.coordinate)}}async function E(e,t,a,i){return(await h("nearestVertices",[o(e),e,t,a,i])).map((e=>({...e,coordinate:r.default.fromJSON(e.coordinate)})))}function D(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function T(e,t,a){if(null==e)throw new X;const i=e.spatialReference;if(null==(a=a??D(e)))throw new X;const r=e.constructor.fromJSON(await h("rotate",[i,e,t,a]));return r.spatialReference=i,r}async function H(e,t){if(null==e)throw new X;const a=e.spatialReference;if(null==(t=t??D(e)))throw new X;const i=e.constructor.fromJSON(await h("flipHorizontal",[a,e,t]));return i.spatialReference=a,i}async function N(e,t){if(null==e)throw new X;const a=e.spatialReference;if(null==(t=t??D(e)))throw new X;const i=e.constructor.fromJSON(await h("flipVertical",[a,e,t]));return i.spatialReference=a,i}async function j(e,t,a,i){return l(await h("generalize",[o(e),e,t,a,i]))}async function B(e,t,a){return l(await h("densify",[o(e),e,t,a]))}async function W(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return l(await h("geodesicDensify",[o(e),e,t,a,i]))}function U(e,t){return h("planarArea",[o(e),e,t])}function q(e,t){return h("planarLength",[o(e),e,t])}function $(e,t,a){return h("geodesicArea",[o(e),e,t,a])}function J(e,t,a){return h("geodesicLength",[o(e),e,t,a])}async function Q(e,t){return l(await h("intersectLinesToPoints",[o(e),e,t]))}async function K(e,t){await d("changeDefaultSpatialReferenceTolerance",[e,t])}async function Y(e){await d("clearDefaultSpatialReferenceTolerance",[e])}class X extends Error{constructor(){super("Illegal Argument Exception")}}},70961:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var i,r=a(35143),n=a(31633),o=a(46053),s=(a(81806),a(76460),a(47249),a(85842)),l=a(34111),c=a(19247),u=a(65215),h=a(13312),d=a(7137),p=a(45417),m=a(85996);let g=i=class extends u.default{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const a=(0,n.oU)(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let r,o="geographic";if(i.isWebMercator?o="webMercator":(null!=(i.wkid&&m.A[i.wkid])||(i.wkt2||i.wkt)&&(0,n.x1)(i.wkt2||i.wkt))&&(o="projected"),this.geodesic){let i;switch(o){case"webMercator":i=(0,p.webMercatorToGeographic)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=e}r=this._createGeodesicCircle(i,a,t),"webMercator"===o&&(r=(0,p.geographicToWebMercator)(r))}else{let i;"webMercator"===o||"projected"===o?i=a/(0,n.Ao)(e.spatialReference):"geographic"===o&&(i=(0,n.vl)(a,"meters",(0,l.tO)(e.spatialReference).radius)),r=this._createPlanarCircle(e,i,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:a,radiusUnit:r,geodesic:n}=this;return new i({center:e?.clone(),numberOfPoints:t,radius:a,radiusUnit:r,geodesic:n})}_createGeodesicCircle(e,t,a){const i=[],r=[e.x,e.y];for(let n=0;n<360;n+=360/a){const a=this.hasZ?[0,0,e.z??0]:[0,0];(0,d.directGeodeticSolver)(a,r,n,t,h.default.WGS84),i.push(a)}return i.push(i[0]),new u.default({rings:[i]})}_createPlanarCircle(e,t,a){const i=[],r=2*Math.PI/a;for(let n=0;n<a;++n){const a=r*n,o=[e.x+Math.cos(-a)*t,e.y+Math.sin(-a)*t];this.hasZ&&o.push(e.z??0),i.push(o)}return i.push(i[0]),new u.default({spatialReference:e.spatialReference,rings:[i]})}};(0,r._)([(0,o.MZ)({type:c.default})],g.prototype,"center",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"geodesic",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"numberOfPoints",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"radius",void 0),(0,r._)([(0,o.MZ)()],g.prototype,"radiusUnit",void 0),g=i=(0,r._)([(0,s.$)("esri.geometry.Circle")],g);const y=g},71523:(e,t,a)=>{a.d(t,{Cy:()=>s,UT:()=>h,hs:()=>c,lR:()=>l,wW:()=>u});var i=a(15941),r=a(2413),n=a(65391),o=a(5262);function s(e,t,a,i){if(null==i||e.hasZ||(i=void 0),"point"===e.type)return e.x+=t,e.y+=a,e.hasZ&&null!=i&&(e.z+=i),e;if("multipoint"===e.type){const r=e.points;for(let e=0;e<r.length;e++)r[e]=d(r[e],t,a,i);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=a,e.ymax+=a,null!=i&&(e.zmin??=0,e.zmin+=i,e.zmax??=0,e.zmax+=i),e;const r=(0,o.$K)(e),n="polyline"===e.type?e.paths:e.rings;for(let o=0;o<r.length;o++){const e=r[o];for(let r=0;r<e.length;r++)e[r]=d(e[r],t,a,i)}return"paths"in e?e.paths=n:e.rings=n,e}function l(e,t,a,i,r){const n=e.clone(),l=i.resolution;if("point"===n.type){if(r)s(n,t*l,-a*l);else{const e=i.state.transform,r=i.state.inverseTransform,o=e[0]*n.x+e[2]*n.y+e[4],s=e[1]*n.x+e[3]*n.y+e[5];n.x=r[0]*(o+t)+r[2]*(s+a)+r[4],n.y=r[1]*(o+t)+r[3]*(s+a)+r[5]}return n}if("multipoint"===n.type){if(r)s(n,t*l,-a*l);else{const e=n.points,r=i.state.transform,o=i.state.inverseTransform;for(let i=0;i<e.length;i++){const n=e[i],s=r[0]*n[0]+r[2]*n[1]+r[4],l=r[1]*n[0]+r[3]*n[1]+r[5],c=o[0]*(s+t)+o[2]*(l+a)+o[4],u=o[1]*(s+t)+o[3]*(l+a)+o[5];e[i]=p(n,c,u,void 0)}}return n}if("extent"===n.type){if(r)s(n,t*l,-a*l);else{const e=i.state.transform,r=i.state.inverseTransform,o=e[0]*n.xmin+e[2]*n.ymin+e[4],s=e[1]*n.xmin+e[3]*n.ymin+e[5],l=e[0]*n.xmax+e[2]*n.ymax+e[4],c=e[1]*n.xmax+e[3]*n.ymax+e[5];n.xmin=r[0]*(o+t)+r[2]*(s+a)+r[4],n.ymin=r[1]*(o+t)+r[3]*(s+a)+r[5],n.xmax=r[0]*(l+t)+r[2]*(c+a)+r[4],n.ymax=r[1]*(l+t)+r[3]*(c+a)+r[5]}return n}if(r)s(n,t*l,-a*l);else{const e=(0,o.$K)(n),r="polyline"===n.type?n.paths:n.rings,s=i.state.transform,l=i.state.inverseTransform;for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++){const i=r[e],n=s[0]*i[0]+s[2]*i[1]+s[4],o=s[1]*i[0]+s[3]*i[1]+s[5],c=l[0]*(n+t)+l[2]*(o+a)+l[4],u=l[1]*(n+t)+l[3]*(o+a)+l[5];r[e]=p(i,c,u,void 0)}}"paths"in n?n.paths=r:n.rings=r}return n}function c(e,t,a,i){if("point"===e.type){const{x:r,y:n}=e,o=i?i[0]:r,s=i?i[1]:n,l=e.clone(),c=(r-o)*t+o,u=(n-s)*a+s;return l.x=c,l.y=u,l}if("multipoint"===e.type){const s=(0,o.$K)(e),l=(0,r.vt)(),[c,u,h,d]=(0,n.Yz)(l,[s]),m=i?i[0]:(c+h)/2,g=i?i[1]:(d+u)/2,y=e.clone(),f=y.points;for(let e=0;e<f.length;e++){const i=f[e],[r,n]=i,o=(r-m)*t+m,s=(n-g)*a+g;f[e]=p(i,o,s,void 0)}return y}if("extent"===e.type){const{xmin:r,xmax:n,ymin:o,ymax:s}=e,l=i?i[0]:(r+n)/2,c=i?i[1]:(s+o)/2,u=e.clone();if(u.xmin=(r-l)*t+l,u.ymax=(s-c)*a+c,u.xmax=(n-l)*t+l,u.ymin=(o-c)*a+c,u.xmin>u.xmax){const e=u.xmin,t=u.xmax;u.xmin=t,u.xmax=e}if(u.ymin>u.ymax){const e=u.ymin,t=u.ymax;u.ymin=t,u.ymax=e}return u}const s=(0,o.$K)(e),l=(0,r.vt)(),[c,u,h,d]=(0,n.Yz)(l,s),m=i?i[0]:(c+h)/2,g=i?i[1]:(d+u)/2,y=e.clone(),f="polyline"===y.type?y.paths:y.rings;for(let r=0;r<s.length;r++){const e=s[r];for(let i=0;i<e.length;i++){const n=e[i],[o,s]=n,l=(o-m)*t+m,c=(s-g)*a+g;f[r][i]=p(n,l,c,void 0)}}return"paths"in y?y.paths=f:y.rings=f,y}function u(e,t,a,i,r,n){const o=Math.sqrt((a-e)*(a-e)+(i-t)*(i-t));return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))/o}function h(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=Math.atan2(t.y-a.y,t.x-a.x)-Math.atan2(e.y-a.y,e.x-a.x),o=Math.atan2(Math.sin(n),Math.cos(n));return r?o:(0,i.KJ)(o)}function d(e,t,a,i){return p(e,e[0]+t,e[1]+a,null!=e[2]&&null!=i?e[2]+i:void 0)}function p(e,t,a,i){const r=[t,a];return e.length>2&&r.push(null!=i?i:e[2]),e.length>3&&r.push(e[3]),r}},77357:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Mt});var i=a(35143),r=a(39356),n=a(18690),o=a(98773),s=a(19276),l=a(63241),c=a(50076),u=a(54099),h=a(42553),d=a(53084),p=a(76460),m=a(15941),g=a(30726),y=a(91291),f=a(50346),v=a(67993),w=a(68134),_=a(34154),M=a(31633),b=a(46053),x=(a(81806),a(85842)),I=a(19555),P=a(19451),F=a(56203),R=a(66388),A=a(19247),C=a(65215),S=a(23701),O=a(9624),Z=a(13312),V=a(5262),z=a(45417),k=a(63733),G=a(76797),L=a(13014),E=a(69098),D=a(21403),T=a(6409),H=a(28379),N=a(17707),j=a(86729),B=a(59913),W=(a(47249),a(7839)),U=a(8595);let q=class{static getCameraOrientation(e){return(0,U.y4)(e)}static register(e,t,a){W.A.set(e,{desc:t,constructor:a})}};q=(0,i._)([(0,x.$)("esri.layers.orientedImagery.core.cameraOrientationFactory")],q);const $=q;var J=a(40350),Q=a(97572);const K=e=>({cast:e=>{const t=parseFloat(e);return Number.isFinite(t)?t:void 0},json:{name:e,write:{writer:(e,t,a)=>{t[a]=Number.isFinite(e)?e:void 0}}}}),Y=e=>({cast:e=>"string"==typeof e?e.split(";").map(Number):e,json:{default:e,write:{writer:(e,t,a)=>{t[a]=e?.join(";")}}}});let X=class extends(E.A.ClonableMixin(h.A)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,t){const a={},{attributes:i,layer:r,geometry:n}=e,o={};for(const s in i)a[s.toLowerCase()]=i[s],o[s.toLowerCase()]=s;super.read({geometry:n,layer:r??{},sourceMap:o,...a},t)}write(e,t){const a=super.write(e,t),{sourceMap:i}=this;if(!i||!a)return a;const r={};for(const n in a){const e=i[n.toLowerCase()];e&&(r[e]=a[n])}return r}readCameraHeading(e,t){const{cameraheading:a,camheading:i,layer:r}=t;return a??i??r.cameraHeading}readCameraHeight(e,t){const{cameraheight:a,avghtag:i,layer:r}=t;return a??i??r.cameraHeight}readCamOffset(e,t){const{cameraoffset:a,camoffset:i}=t;return a?.split(";").map(Number)??i?.split(";").map(Number)??null}writeCameraOffset(e,t){e&&(t.cameraOffset=e.join(";"))}readCameraOrientation(e,t){const{cameraorientation:a,camori:i}=t;return a??i}readCameraPitch(e,t){const{camerapitch:a,campitch:i,layer:r}=t;return a??i??r.cameraPitch}readCameraRoll(e,t){const{cameraroll:a,camroll:i,layer:r}=t;return a??i??r.cameraRoll}readDepthImage(e,t){const{depthimage:a,depthimg:i,layer:r}=t,n=a??i??null,{depthImagePathPrefix:o,depthImagePathSuffix:s}=r??{};return(0,U.Rf)(n,o,s)}readElevationSource(e,t){const{elevationsource:a,layer:i}=t,{demPathSuffix:r,demPathPrefix:n}=i;if(a){const e=this._parseIfJSON(a);return(0,U.eR)(e,n,r)}return i.effectiveElevationSource}readFarDistance(e,t){const{fardistance:a,fardist:i,layer:r}=t;return a??i??r.farDistance}readHFOV(e,t){const{horizontalfieldofview:a,hfov:i,layer:r}=t;return a??i??r.horizontalFieldOfView}readImageURL(e,t){const{imagepath:a,layer:i}=t;a||function(e,t){throw new c.default("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}("imagePath",this);const{imagePathPrefix:r,imagePathSuffix:n}=i;return(0,U.Rf)(a,r,n)}readImageRotation(e,t){const{imagerotation:a,imgrot:i,layer:r}=t;return a??i??r.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,cameraHeight:t,elevation:a}=this;if(e){const{type:t,x:a,y:i,z:r,horizontalWKID:n,verticalWKID:o}=e,s="number"==typeof n?{wkid:n}:{wkt:n};if(t===J.g.LTP){const{latitude:t,longitude:a,ellipsoidRadius:i,squaredEccentricity:r,properties:n}=e,{x:o,y:s,z:l}=n;return new A.default((0,Q.Zq)([o,s,l],[t,a,i,r]))}const l=new A.default({x:a,y:i,z:r,spatialReference:s}),c=o?(0,j.N)("point",{wkid:o},s):null;return c&&c(l),l}if("number"!=typeof t)throw function(e){throw new c.default("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}("cameraHeight");const i=this.geometry.clone();return i.z=i.hasZ?i.z:(a??0)+t,i}set matrix(e){if(!e||9!==e.length)return p.A.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:e}),void this._set("matrix",null);this._set("matrix",e)}readNearDistance(e,t){const{neardistance:a,neardist:i,layer:r}=t;return a??i??r.nearDistance}readOrientationAccuracy(e,t){const{accuracy:a,orientationaccuracy:i}=t;return i?.split(";").map(Number)??a?.split(";").map(Number)??null}writeOrientationAccuracy(e,t){e&&(t.orientationAccuracy=e.join(";"))}readOIType(e,t){const{orientedimagerytype:a,oitype:i,camerapitch:r,campitch:n,layer:o}=t,s=U.fs.read(a??i??o.orientedImageryType),l=r??n??o.cameraPitch;return"oblique"===s?l<10?"nadir":"oblique":s}set radial(e){if(e)if("string"!=typeof e)this._set("radial",e);else{const[t,a,i]=e.split(";").map(Number);this._set("radial",[t??0,a??0,i??0])}else this._set("radial",[0,0,0])}set tangential(e){if(e)if("string"!=typeof e)this._set("tangential",e);else{const[t,a]=e.split(";").map(Number);this._set("tangential",[t??0,a??0])}else this._set("tangential",[0,0])}readVFOV(e,t){const{verticalfieldofview:a,vfov:i,layer:r}=t;return a??i??r.verticalFieldOfView}_parseIfJSON(e){let t=null;try{t=JSON.parse(e)}catch(a){p.A.getLogger(this).error("couldn't parse the given elevation source JSON",e,a)}return t}};(0,i._)([(0,b.MZ)(K())],X.prototype,"a0",void 0),(0,i._)([(0,b.MZ)(K())],X.prototype,"a1",void 0),(0,i._)([(0,b.MZ)(K())],X.prototype,"a2",void 0),(0,i._)([(0,b.MZ)({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],X.prototype,"acquisitionDate",void 0),(0,i._)([(0,b.MZ)(K())],X.prototype,"b0",void 0),(0,i._)([(0,b.MZ)(K())],X.prototype,"b1",void 0),(0,i._)([(0,b.MZ)(K())],X.prototype,"b2",void 0),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],X.prototype,"cameraHeading",void 0),(0,i._)([(0,H.w)("cameraHeading")],X.prototype,"readCameraHeading",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraHeight",void 0),(0,i._)([(0,H.w)("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],X.prototype,"readCameraHeight",null),(0,i._)([(0,b.MZ)()],X.prototype,"cameraOffset",void 0),(0,i._)([(0,H.w)("cameraOffset",["cameraoffset","camoffset"])],X.prototype,"readCamOffset",null),(0,i._)([(0,N.K)("cameraOffset")],X.prototype,"writeCameraOffset",null),(0,i._)([(0,b.MZ)({json:{write:{writer:(e,t,a)=>{t[a]=e.toString()}}},type:B.A}),(0,D.w)((e=>e?$.getCameraOrientation(e):null))],X.prototype,"cameraOrientation",void 0),(0,i._)([(0,H.w)("cameraOrientation",["cameraorientation","camori"])],X.prototype,"readCameraOrientation",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraPitch",void 0),(0,i._)([(0,H.w)("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],X.prototype,"readCameraPitch",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraRoll",void 0),(0,i._)([(0,H.w)("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],X.prototype,"readCameraRoll",null),(0,i._)([(0,b.MZ)({json:{write:!0},type:String})],X.prototype,"depthImage",void 0),(0,i._)([(0,H.w)("depthImage",["depthimage","depthimg"])],X.prototype,"readDepthImage",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"elevation",void 0),(0,i._)([(0,b.MZ)({json:{write:!0},clonable:"reference"})],X.prototype,"elevationSource",void 0),(0,i._)([(0,H.w)("elevationSource",["elevationsource","layer.effectiveElevationSource"])],X.prototype,"readElevationSource",null),(0,i._)([(0,b.MZ)({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],X.prototype,"exposureStationId",void 0),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"farDistance",void 0),(0,i._)([(0,H.w)("farDistance",["fardistance","fardist","layer.farDistance"])],X.prototype,"readFarDistance",null),(0,i._)([(0,b.MZ)(K("focallength"))],X.prototype,"focalLength",void 0),(0,i._)([(0,b.MZ)({type:A.default,json:{name:"geometry"}})],X.prototype,"geometry",void 0),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"horizontalFieldOfView",void 0),(0,i._)([(0,H.w)("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],X.prototype,"readHFOV",null),(0,i._)([(0,b.MZ)({json:{write:!0},type:String})],X.prototype,"imagePath",void 0),(0,i._)([(0,H.w)("imagePath",["imagepath"])],X.prototype,"readImageURL",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"imageRotation",void 0),(0,i._)([(0,H.w)("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],X.prototype,"readImageRotation",null),(0,i._)([(0,b.MZ)()],X.prototype,"isHorizontal",null),(0,i._)([(0,b.MZ)()],X.prototype,"isInspection",null),(0,i._)([(0,b.MZ)()],X.prototype,"isNadir",null),(0,i._)([(0,b.MZ)()],X.prototype,"isOblique",null),(0,i._)([(0,b.MZ)()],X.prototype,"isSpherical",null),(0,i._)([(0,b.MZ)()],X.prototype,"location",null),(0,i._)([(0,b.MZ)(Y())],X.prototype,"matrix",null),(0,i._)([(0,b.MZ)({json:{write:!0},type:String})],X.prototype,"name",void 0),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"nearDistance",void 0),(0,i._)([(0,H.w)("nearDistance",["neardistance","neardist","layer.nearDistance"])],X.prototype,"readNearDistance",null),(0,i._)([(0,b.MZ)({json:{write:!0,name:"objectid"},type:Number})],X.prototype,"objectId",void 0),(0,i._)([(0,b.MZ)()],X.prototype,"orientationAccuracy",void 0),(0,i._)([(0,H.w)("orientationAccuracy",["accuracy","orientationaccuracy"])],X.prototype,"readOrientationAccuracy",null),(0,i._)([(0,N.K)("orientationAccuracy")],X.prototype,"writeOrientationAccuracy",null),(0,i._)([(0,T.e)(U.fs)],X.prototype,"orientedImageryType",void 0),(0,i._)([(0,H.w)("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],X.prototype,"readOIType",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0,read:{source:"principalx"}}})],X.prototype,"principalX",void 0),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0,read:{source:"principaly"}}})],X.prototype,"principalY",void 0),(0,i._)([(0,b.MZ)(Y([0,0,0]))],X.prototype,"radial",null),(0,i._)([(0,b.MZ)({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],X.prototype,"sortOrder",void 0),(0,i._)([(0,b.MZ)({type:Object})],X.prototype,"sourceMap",void 0),(0,i._)([(0,b.MZ)(Y([0,0]))],X.prototype,"tangential",null),(0,i._)([(0,b.MZ)({type:Number,json:{write:!0}})],X.prototype,"verticalFieldOfView",void 0),(0,i._)([(0,H.w)("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],X.prototype,"readVFOV",null),X=(0,i._)([(0,x.$)("esri.layers.orientedImagery.core.ExposurePoint")],X);const ee=X;var te=a(68295);const ae={};async function ie(e,t){const{point:a,queryParams:i}=e;if(null==a)return null;const r={};let n=e.layerInstanceOrURL;const o=a.spatialReference.isGeographic?(0,z.geographicToWebMercator)(a.clone()):a.clone();if(r.outSpatialReference=o.spatialReference,i&&(r.maxRecordCountFactor=i.maxRecordCountFactor??5,r.outFields=i.outFields??["*"],r.where=i.where??"1=1",r.returnGeometry=i.returnGeometry??!0,r.outSpatialReference=i.outSpatialReference),"string"==typeof n&&(ae.layer&&ae.layer.url===n?n=ae.layer:(ae.layer?.destroy(),n=ae.layer=new L.default({url:n}))),n)try{await n.load();const e=n,a=function(e,t){const a=e.x-t,i=e.x+t,r=e.y-t,n=e.y+t;return new G.default({xmin:a,xmax:i,ymin:r,ymax:n,spatialReference:e.spatialReference})}(o,i?.maximumDistance??e.maximumDistance??1e3);r.returnZ=e.hasZ;const s=new te.default({geometry:a,...r}),l=await e.queryFeatures(s,t);return function(e){return t=>{const{features:a,spatialReference:i}=t;return a.forEach((t=>{t.geometry&&(t.geometry.spatialReference=i);const a=ee.fromJSON({...t.toJSON(),layer:e});a&&(t.attributes=a),t.layer=e,t.spatialReference=i})),t}}(e)(l)}catch(s){(0,f.throwIfNotAbortError)(s)}return null}var re=a(14556),ne=a(12294);function oe(e){const{camera:t,features:a,selectedPoint:i}=e;if(!a.length)return[];e.currentImage??={attributes:{cameraHeading:0,cameraPitch:0}};const r=function(e,t,a){return t.z??=0,t.elevation??=0,i=>{const{hfovWeight:r,vfovWeight:n,distanceWeight:o}=se(i.attributes,e?"3d":"2d"),s=i.attributes,{cameraHeight:l,cameraHeading:c,cameraPitch:u,farDistance:h,horizontalFieldOfView:d,verticalFieldOfView:p,isOblique:m}=s,g=s.geometry,y=180*Math.atan2(g.y-t.y,g.x-t.x)/Math.PI,f=(0,ne.Io)(t,g);let v,w,_=d,M=p,b=!1;e?(v=e.heading,w=e.tilt,_=180,M=180,b=!0):!m||u<10?(v=c,w=u,b=!1):(v=a.attributes.cameraHeading,w=u,b=!0,_=180),v>180&&(v-=360);let x=1;g.spatialReference.isWebMercator&&(x=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*g.y/re.$O.radius))));const I=Math.sqrt((Math.sqrt((t.x-g.x)**2+(t.y-g.y)**2)/x)**2+((t.z??0)-(t.elevation??0)-l)**2),P=90-180*Math.atan2(t.y-g.y,t.x-g.x)/Math.PI;let F=(Math.abs(P-v)>180?Math.abs(360-Math.abs(P-v)):Math.abs(P-v))/_;F=4*F+1;const R=180*Math.acos((s.cameraHeight-(t.z??0)+(t.elevation??0))/I)/Math.PI;let A=Math.abs(R-w)/M;A=4*A+1;let C=I/Math.sqrt(h**2+l**2);C=4*C+1;const S=r*F+n*A+o*C;let O;if(b){const e=c>180?c-360:c;O=r*((Math.abs(P-e)>180?Math.abs(360-Math.abs(P-e)):Math.abs(P-e))/d*4+1)+n*(Math.abs(R-u)/p*4+1)+o*C}else O=S;return{suitability:S,trueSuitability:O,feature:i,angle:y,distance:f,verticalAngle:Math.abs(180*Math.atan(f/l)/Math.PI)}}}(t,i,e.currentImage);return a.map(r)}function se(e,t){const a="isOblique"in e?e:new ee(e),{isOblique:i,isSpherical:r,isNadir:n}=a;return r?{hfovWeight:"2d"===t?0:1,vfovWeight:"2d"===t?0:.6,distanceWeight:"2d"===t?1:.5}:n?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:i?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}var le=a(86017),ce=a(58872),ue=a(20749),he=a(42269),de=a(36116),pe=a(85367),me=a(46530),ge=a(38996),ye=a(48280),fe=a(71523),ve=a(57308),we=a(7989),_e=a(25329),Me=a(18364),be=a(58963),xe=a(3825),Ie=a(45802),Pe=a(75939),Fe=a(38338),Re=a(57134);let Ae=class extends(E.A.ClonableMixin(h.A)){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(0===this.minFOV||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(0===this.maxFOV||this.view.camera.fov<this.maxFOV)}};(0,i._)([(0,b.MZ)({type:Boolean,readOnly:!0})],Ae.prototype,"canZoomIn",null),(0,i._)([(0,b.MZ)({type:Boolean,readOnly:!0})],Ae.prototype,"canZoomOut",null),(0,i._)([(0,b.MZ)({type:Number})],Ae.prototype,"maxFOV",void 0),(0,i._)([(0,b.MZ)({type:Number})],Ae.prototype,"minFOV",void 0),(0,i._)([(0,b.MZ)()],Ae.prototype,"view",void 0),(0,i._)([(0,b.MZ)({type:Number})],Ae.prototype,"zoomFactor",void 0),Ae=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Ae);const Ce=Ae;var Se=a(75657);let Oe=class extends Se.default{constructor(e){super(e),this.panoramicZoomConditions=new Ce,this.zoomTo=e=>{this.view.camera.fov=this.constrainFOV(e),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([(0,w.watch)((()=>[this.view?.ready,this.panoramicZoomConditions]),(()=>{this.view?.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))}),w.syncAndInitial),(0,w.watch)((()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV]),(e=>{let[t,a]=e;null!=t&&null!=a&&this.zoomTo(this.view.camera.fov)}),w.sync)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._set("view",e)}constrainFOV(e){const{maxFOV:t,minFOV:a}=this.panoramicZoomConditions;return(0,m.qE)(e,a,t)}zoomIn(){if(!this.canZoomIn)return;const e=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}zoomOut(){if(!this.canZoomOut)return;const e=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}};(0,i._)([(0,b.MZ)()],Oe.prototype,"canZoomIn",null),(0,i._)([(0,b.MZ)()],Oe.prototype,"canZoomOut",null),(0,i._)([(0,b.MZ)({type:Ce})],Oe.prototype,"panoramicZoomConditions",void 0),(0,i._)([(0,b.MZ)()],Oe.prototype,"state",null),(0,i._)([(0,b.MZ)()],Oe.prototype,"view",null),Oe=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Oe);const Ze=Oe;var Ve=a(10851),ze=a(33905),ke=a(75257),Ge=a(84847),Le=a(94918);function Ee(e,t){return 2*(0,m.KJ)(Math.atan(Math.tan((0,m.kU)(e/2))*Math.sqrt(t**2+1)))}const De="default",Te="navigation",He="fov-constraint",Ne="image-click-action";let je=class extends u.A.EventedAccessor{constructor(e){super(e),this._startPosition=null,this._targetPosition=null,this._graphics=new k.default({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new be.default({ground:new Me.default({opacity:0,navigationConstraint:null}),layers:new s.default([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(Te),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",(e=>{const t=e.key;["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t)&&e.stopPropagation()}))],Te)},this._addHFOVHandles=()=>{this.removeHandles(He),this.addHandles((0,w.watch)((()=>[this.maxHFOV,this.minHFOV]),(()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new Ce({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))}),w.syncAndInitial),He)},this._addZoomHandles=()=>{this._zoomViewModel=new Ze({view:this.imageRenderer,panoramicZoomConditions:new Ce({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const e=this.imageRenderer.ui.find("zoom");e&&(e.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._handleDoubleClick=e=>{e.stopPropagation(),e.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=e=>{e.stopPropagation();const{action:t,x:a,y:i}=e;switch(t){case"start":this._startPosition=this._targetPosition={x:a,y:i};break;case"update":this._targetPosition={x:a,y:i},this._updateCameraHeadingAndTilt()}},this._handleImageClick=e=>{if("image-loaded"===this.state&&this.imageRenderer.ready)switch(this.clickAction){case"emit":e.stopPropagation(),this.emit("click",e);break;case"hittest":e.stopPropagation(),e.async((async()=>{const t=await this.imageRenderer.hitTest(e.screenPoint,{include:this._graphics});this.emit("hittest-response",t)}));break;case"pixel-location":{if(e.stopPropagation(),!this.imageSize||!e.mapPoint)return void this.emit("pixel-location",null);const t=(0,Q.pq)(e.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...t,spatialReference:Z.default.WebMercator});break}}},this._handleWheel=e=>{const t=e.deltaX??e.native.deltaX;e.stopPropagation(),t>0||e.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>this._zoomViewModel?.zoomIn(),this._zoomOut=()=>this._zoomViewModel?.zoomOut(),this.addGraphic=(e,t)=>"image-loaded"===this.state&&!this._graphics.graphics.includes(e)&&(this._graphics.graphics.add(e,t),!0),this.addManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>!this._graphics.graphics.includes(e)));return this._graphics.graphics.addMany(t),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=e=>!("image-loaded"!==this.state||!this._graphics.graphics.includes(e))&&(this._graphics.remove(e),!0),this.removeManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>this._graphics.graphics.includes(e)));return this._graphics.removeMany(t),!0},this._imageRenderer=new Pe.default({map:this._map,viewingMode:"local",camera:{position:Re.ZH},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:Z.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(()=>{this.imageSource&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.fov),(()=>{this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.yaw),(e=>{this.camera.heading=e,this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.pitch),(e=>{this.camera.tilt=e,this._reloadCamera()}),w.syncAndInitial),(0,w.when)((()=>this.imageRenderer.ready),(()=>{this._addNavigationHandles(),this._addZoomHandles()}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(Ne),"none"!==e&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))}),w.syncAndInitial)],De)}get camera(){return this.imageRenderer.camera}set camera(e){e&&(this.imageRenderer.camera=e.clone())}get fov(){return this.camera.fov}set fov(e){Number.isFinite(e)&&this._zoomViewModel?.zoomTo(e)}get hfov(){const{fov:e}=this.camera,{size:[t,a]}=this.imageRenderer,i=t/a,r=Math.atan(i);return 2*(0,m.KJ)(Math.atan(Math.tan((0,m.kU)(e/2))*Math.sin(r)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,t]}=this.imageRenderer;return Ee(Re.EA,e/t)}get minHFOV(){const{size:[e,t]}=this.imageRenderer;return Ee(Re.li,e/t)}get vfov(){const{fov:e}=this.camera,{size:[t,a]}=this.imageRenderer,i=t/a,r=Math.atan(i);return 2*(0,m.KJ)(Math.atan(Math.tan((0,m.kU)(e/2))*Math.cos(r)))}async _loadImageInternal(e,t){let a;this.state="image-loading";try{a=(await(0,xe.default)(e,{responseType:"image",...t})).data}catch(i){throw(0,f.isAbortError)(i)?this.state="image-load-aborted":this.state="image-load-error",i}return this._updateImageSphere(a,t)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=(0,g.pR)(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const t=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,t)),this._startPosition=this._targetPosition}async _updateImageSphere(e,t){await(0,f.waitTick)(t);const{size:[a,i]}=this.imageRenderer;return this._imageGraphic=function(e){return new r.default({geometry:e,symbol:new Le.default({symbolLayers:new s.default([new Ge.default])})})}(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re.ZH,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Re.vK;const i=t.clone();i.z=-500;const r=Ve.default.createSphere(i,{size:a,densificationFactor:2,vertexSpace:"georeferenced",material:new ze.default({colorTexture:new ke.default({data:e})})});if(r.components[0].trustSourceNormals=!0,r.vertexAttributes.uv){const e=r.vertexAttributes.uv.length??0;for(let t=0;t<e;t++)r.vertexAttributes.uv[2*t+0]=1-r.vertexAttributes.uv[2*t+0],r.vertexAttributes.uv[2*t+1]=r.vertexAttributes.uv[2*t+1]}return r.centerAt(i),r}(e)),this._graphics.add(this._imageGraphic),this.fov=Ee(Re.EF,a/i),this.state="image-loaded",this.imageSize=[e.width,e.height],this._imageGraphic.geometry}async loadImage(e){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,e):(0,Fe.EW)(this.declaredClass,new c.default((0,Fe.Fe)("panoramic-viewer"),(0,Fe.br)("PanoramicViewerViewModel","imageSource")))}};(0,i._)([(0,b.MZ)()],je.prototype,"_graphics",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"_imageGraphic",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"_imageRenderer",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"_loadController",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"_map",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"_zoomViewModel",void 0),(0,i._)([(0,b.MZ)({type:Boolean})],je.prototype,"autoLoad",void 0),(0,i._)([(0,b.MZ)({type:we.default})],je.prototype,"camera",null),(0,i._)([(0,T.e)(new Ie.J({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],je.prototype,"clickAction",void 0),(0,i._)([(0,b.MZ)({type:Number})],je.prototype,"fov",null),(0,i._)([(0,b.MZ)({readOnly:!0})],je.prototype,"hfov",null),(0,i._)([(0,b.MZ)({readOnly:!0})],je.prototype,"imageRenderer",null),(0,i._)([(0,b.MZ)()],je.prototype,"imageSize",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"imageSource",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],je.prototype,"maxHFOV",null),(0,i._)([(0,b.MZ)({readOnly:!0})],je.prototype,"minHFOV",null),(0,i._)([(0,b.MZ)({type:Number})],je.prototype,"pitch",void 0),(0,i._)([(0,b.MZ)()],je.prototype,"state",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],je.prototype,"vfov",null),(0,i._)([(0,b.MZ)({type:Number})],je.prototype,"yaw",void 0),je=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],je);const Be=je;var We=a(98108),Ue=(a(76099),a(12254)),qe=a(54761);let $e=class extends _e.default{constructor(e){super(e),this.viewModel=new Be,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(We.D.widget,"esri-panoramic-viewer")})}};(0,i._)([(0,b.MZ)({type:Boolean})],$e.prototype,"autoLoad",null),(0,i._)([(0,b.MZ)({type:we.default})],$e.prototype,"camera",null),(0,i._)([(0,b.MZ)()],$e.prototype,"clickAction",null),(0,i._)([(0,b.MZ)({type:Number})],$e.prototype,"fov",null),(0,i._)([(0,b.MZ)({readOnly:!0,type:Number})],$e.prototype,"hfov",null),(0,i._)([(0,b.MZ)()],$e.prototype,"icon",null),(0,i._)([(0,b.MZ)({readOnly:!0})],$e.prototype,"imageRenderer",null),(0,i._)([(0,b.MZ)({readOnly:!0})],$e.prototype,"imageSize",null),(0,i._)([(0,b.MZ)()],$e.prototype,"imageSource",null),(0,i._)([(0,b.MZ)({type:Number})],$e.prototype,"pitch",null),(0,i._)([(0,b.MZ)({readOnly:!0})],$e.prototype,"state",null),(0,i._)([(0,b.MZ)({readOnly:!0,type:Number})],$e.prototype,"vfov",null),(0,i._)([(0,Ue.U)(["click","hittest-response","pixel-location"]),(0,b.MZ)({type:Be})],$e.prototype,"viewModel",void 0),(0,i._)([(0,b.MZ)({type:Number})],$e.prototype,"yaw",null),$e=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer")],$e);const Je=$e;var Qe=a(44538),Ke=a(99464),Ye=a(4852),Xe=a(39839),et=a(19562),tt=a(42810),at=a(63391),it=a(33562),rt=a(44038),nt=a(17941),ot=a(88235),st=a(28632);const lt="click-handle",ct="enhancements-handle";let ut=class extends u.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new k.default({blendMode:"source-atop"}),this._map=new be.default,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(ct),this.addHandles((0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(e=>{let[t,a,i]=e;this.image?.loaded&&(this.image.effect=`contrast(${10*(a+10)}%) brightness(${10*(t+10)}%)`,this.sharpenImage(this.image,i))}),w.syncAndInitial))},this._createPanConstraint=()=>{const{image:e,imageRenderer:t}=this,a=a=>{if(!(e&&t&&a.targetGeometry&&e.serviceRasterInfo))return a;const{extent:i}=e.serviceRasterInfo,{constraints:r,rotation:n,width:o,height:s}=t,{extent:l}=(0,at.rotate)(C.default.fromExtent(i),n),{width:c,height:u}=l,h=a.targetGeometry.clone(),d=r.scaleToZoom(a.scale),p=1/2**d,m=o/s;let g=p*c,y=p*u;d&&(c/o>u/s?y=g/m:g=y*m);const f=l.clone();return f.xmin+=g/2,f.xmax-=g/2,f.ymin+=y/2,f.ymax-=y/2,a.targetGeometry=(0,at.nearestCoordinate)(f,h).coordinate,this.state="image-loaded",a};return{constrain:a,applyPanConstraint:a}},this._createResizeHandles=e=>{e.removeHandles("resize"),e.addHandles((0,w.watch)((()=>{if(!this.imageRenderer.ready)return;const{extent:t}=e.serviceRasterInfo,{width:a,height:i,rotation:r}=this.imageRenderer,{extent:n}=(0,at.rotate)(C.default.fromExtent(t),r),{width:o,height:s}=n;return Math.max(o/a,s/i)}),(e=>{if(!this.imageRenderer||null==e)return;const{constraints:t,scale:a,spatialReference:i}=this.imageRenderer,r=t.minScale,n=(0,st.fr)(i),o=.25*n,s=n*e;let l=s;const c=[];for(;l>o;)c.push(l),l/=2;c.push(l);const{lods:u}=ot.default.create({scales:c});if(t.set({minScale:s,lods:u}),this._imageChanged)return this.imageRenderer.scale=s,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(a-r)<=1e-6?s:a}),w.syncAndInitial),"resize")},this._loadImageInternal=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.state="image-loading",t.clearImage(),t.error=null,t._imageChanged=!0;const i="string"==typeof e,r=i?void 0:e.datasetFormat,n=i?e:e.url,{customParameters:o,options:s}=a;return t._image=new it.default({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:r},url:n,customParameters:o}),t._image.when((async e=>{t._updatePanConstraint(),t._createResizeHandles(e),t._map.add(e),t.state="image-loaded"}),(a=>{(0,f.isAbortError)(a)?t.state="image-load-aborted":(t.state="image-load-error",t.error=a,p.A.getLogger(t).error(`error occurred while loading image ${i?e:JSON.stringify(e)}`,a),t.imageSource=null)})),t._image.load(s)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(e,t)=>{this._overlays.graphics.add(e,t)},this.addManyGraphics=e=>{this._overlays.addMany(e)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=(0,g.pR)(this._image))},this.loadImage=e=>{const{customParameters:t,imageSource:a}=this;return a?this._loadImageInternal(a,{customParameters:t,options:e}):(0,Fe.EW)(this.declaredClass,new c.default((0,Fe.Fe)("image-viewer"),(0,Fe.br)("ImageViewerViewModel","imageSource")))},this.removeGraphic=e=>{this._overlays.remove(e)},this.removeManyGraphics=e=>{this._overlays.removeMany(e)},this._imageRenderer=new tt.default({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:Z.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(e=>{e&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.image?.loaded),(()=>{this._createImageHandles()})),(0,w.watch)((()=>this.imageRotation),(()=>{this._rotateImage()})),(0,w.watch)((()=>this.imageRenderer.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.imageRenderer.map.allLayers.length),(e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(lt),"none"!==e&&this.addHandles(this.imageRenderer.on("click",(t=>{if(this.image?.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async((async()=>{const e=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",e)}));break;case"pixel-location":{if(t.stopPropagation(),!this.image?.serviceRasterInfo||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:e,pixelSize:a}=this.image.serviceRasterInfo,i=(t.mapPoint.x-e.xmin)*a.x,r=(e.ymax-t.mapPoint.y)*a.y,n=new A.default({x:i,y:r,spatialReference:e.spatialReference});this.emit("pixel-location",n);break}}})))}),w.syncAndInitial)])}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,m.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,m.qE)(e,-10,10))}get image(){return this._image}get imagePointsInView(){const{extent:e,ready:t}=this.imageRenderer,a=this.imageRotation,i=this.image?.fullExtent,r=this.image?.serviceRasterInfo,n=!0===this._imageRenderer.allLayerViews.find((e=>{let{layer:t}=e;return t===this.image}))?.attached;if(!(t&&e&&i&&r&&n))return null;const o=(0,at.rotate)(C.default.fromExtent(e),a),s=C.default.fromExtent(i),l=(0,at.intersect)(o,s),{rings:c}=l;return c.flat().map((e=>{let[t,a]=e;return{x:(t-r.extent.xmin)*r.pixelSize.x,y:(r.extent.ymax-a)*r.pixelSize.y}}))}get imageSize(){const{image:e}=this;if(!e?.raster)return null;const{width:t,height:a}=e.raster.rasterInfo;return[t,a]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find((e=>e.layer===this.image))}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,m.qE)(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const a=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],i=new rt.default({functionName:"Convolution",functionArguments:{type:nt.convolutionKernel.userDefined,cols:3,rows:3,kernel:a,convolutionType:nt.convolutionKernel.userDefined}});e.rasterFunction=i}};(0,i._)([(0,b.MZ)()],ut.prototype,"_image",void 0),(0,i._)([(0,b.MZ)()],ut.prototype,"_imageRenderer",void 0),(0,i._)([(0,b.MZ)()],ut.prototype,"_loadController",void 0),(0,i._)([(0,b.MZ)()],ut.prototype,"_overlays",void 0),(0,i._)([(0,b.MZ)()],ut.prototype,"_map",void 0),(0,i._)([(0,b.MZ)({type:Boolean})],ut.prototype,"autoLoad",void 0),(0,i._)([(0,b.MZ)({type:Number})],ut.prototype,"brightness",null),(0,i._)([(0,b.MZ)()],ut.prototype,"clickAction",void 0),(0,i._)([(0,b.MZ)({type:Number})],ut.prototype,"contrast",null),(0,i._)([(0,b.MZ)({type:Object})],ut.prototype,"customParameters",void 0),(0,i._)([(0,b.MZ)({type:c.default})],ut.prototype,"error",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],ut.prototype,"image",null),(0,i._)([(0,b.MZ)({readOnly:!0})],ut.prototype,"imagePointsInView",null),(0,i._)([(0,b.MZ)({readOnly:!0})],ut.prototype,"imageSize",null),(0,i._)([(0,b.MZ)({cast:Fe.mz})],ut.prototype,"imageSource",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],ut.prototype,"imageRenderer",null),(0,i._)([(0,b.MZ)({type:Number})],ut.prototype,"imageRotation",void 0),(0,i._)([(0,b.MZ)()],ut.prototype,"imageView",null),(0,i._)([(0,b.MZ)({type:Number})],ut.prototype,"sharpness",null),(0,i._)([(0,b.MZ)()],ut.prototype,"state",void 0),ut=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],ut);const ht=ut;let dt=class extends _e.default{constructor(){super(...arguments),this.viewModel=new ht,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){const e=this.viewModel.image?.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(We.D.widget,"esri-image-viewer")})}};(0,i._)([(0,b.MZ)({type:Boolean})],dt.prototype,"autoLoad",null),(0,i._)([(0,b.MZ)({type:Number}),(0,b.MZ)()],dt.prototype,"brightness",null),(0,i._)([(0,b.MZ)()],dt.prototype,"clickAction",null),(0,i._)([(0,b.MZ)({type:Number})],dt.prototype,"contrast",null),(0,i._)([(0,b.MZ)({type:Object})],dt.prototype,"customParameters",null),(0,i._)([(0,b.MZ)({readOnly:!0})],dt.prototype,"error",null),(0,i._)([(0,b.MZ)()],dt.prototype,"imageSize",null),(0,i._)([(0,b.MZ)({readOnly:!0})],dt.prototype,"imagePointsInView",null),(0,i._)([(0,b.MZ)({readOnly:!0,type:tt.default})],dt.prototype,"imageRenderer",null),(0,i._)([(0,b.MZ)()],dt.prototype,"imageRotation",null),(0,i._)([(0,b.MZ)()],dt.prototype,"imageSource",null),(0,i._)([(0,Ue.U)(["click","hittest-response","pixel-location"]),(0,b.MZ)({type:ht})],dt.prototype,"viewModel",void 0),(0,i._)([(0,b.MZ)({type:Number})],dt.prototype,"sharpness",null),(0,i._)([(0,b.MZ)({readOnly:!0})],dt.prototype,"state",null),dt=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewer")],dt);const pt=dt,mt="view-click",gt="image-click",yt="interaction-handles",ft=new Set(["JPG","JPEG"]),vt=/\.(\w+)$/,wt=()=>new c.default("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let _t=class extends(u.A.EventedMixin(y.A)){constructor(e){super(e),this.additionalFeatures=new s.default,this.additionalCameraLocations=new s.default,this.additionalFootprints=new s.default,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new s.default,this.coveragePolygons=new s.default,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(e,t,a)=>{const{currentBestFeature:i,selectedPoint:r,view:n}=this;if(n?.closePopup(),i&&r){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(a),await this._loadImage(a)}catch(o){(0,f.isAbortError)(o)||(this.loadImageError(o),p.A.getLogger(this).error("#loadIImage()","error occured while loading image",o))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new s.default,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new s.default,this.overlayedMapFeatures=new v.A,this.pixelCoordinates=null,this.pointSources=new s.default,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(e,t)=>{"image-loaded"===this.state&&await(this._adapter?.updateFootprint(e,t))},this.updateFootprintPanorama=async(e,t)=>{await(this._adapter?.updateFootprintPanorama(e,t))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new pt,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new k.default({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new Je,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new P.U,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=e=>{},this.highlight=e=>{if(!this._overlaysView)return;this.removeHighlight();const t=this.additionalFootprints.find((t=>{let{attributes:{imageID:a}}=t;return a===Number(e)}));this._highlightedFeatureHandle=t?this._overlaysView?.highlight(t):null},this.loadDataCaptureAdapter=async e=>{await this.loadSketch(e);const t=a.e(26964).then(a.bind(a,4583)),{default:i}=await t;return(0,f.throwIfAborted)(e),this.sketchAdapter=new i({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(e,t)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(e,t)),this.loadImageViewer=e=>{this._imageViewer.container=e},this.loadPanoramicViewer=e=>{this._panoramicViewer.container=e},this.removeHighlight=()=>this._highlightedFeatureHandle?.remove(),this.revealImageGeometry=e=>{},this.toggleImageAttributes=()=>{(0,g.DC)(this._openPopupTask),this._openPopupTask=(0,o.UT)((async e=>{const{currentBestFeature:t,popupEnabled:a,layer:i,view:n}=this;if(n?.closePopup(),!(n&&t&&a&&i))return;const{attributes:o,geometry:s}=t,l=new r.default({geometry:s,attributes:o.toJSON(),layer:i});(0,f.throwIfAborted)(e),await n.openPopup({features:[l],location:o.location.clone()})}))},this._createViewClickHandle=()=>{if(this.removeHandles(mt),"disabled"===this.state||null==this.view)return;const e=this.mapImageConversionToolState&&"image-loaded"===this.state?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",e,ve.o.WIDGET),mt)},this._createImageClickHandle=()=>{this.removeHandles(gt);const{mapImageConversionToolState:e,mode:t,activeViewer:a,currentBestFeature:i,footprintExtent:r}=this,n=a?.imageSize;if(!(e&&"none"!==t&&n&&r&&i))return;a.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>a),"pixel-location",(e=>{this.plotReferencePointOnImage(e),s?.abort(),s=(0,o.UT)((async a=>{if(!e)return;const r=await this.getMapPoint(e,{feature:i,imageSize:n,mode:t}).then((e=>{const t=this.view?.spatialReference;return(0,Q.or)(!t,e.spatialReference.equals(t))?e:(0,O.projectWithZConversion)(e,t)}));(0,f.throwIfAborted)(a),this.plotReferencePointOnGround(r)}))}));this.addHandles(l,gt)},this._createImageLocationHandle=()=>{this.removeHandles(gt);const{imageLocationToolState:e,mode:t,activeViewer:a,currentBestFeature:i,footprintExtent:r}=this,n=a?.imageSize;if(!(e&&"none"!==t&&n&&r&&i))return;a.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>a),"pixel-location",(e=>{this.pixelCoordinates=e,this.plotLocationPointOnImage(e),s?.abort(),s=(0,o.UT)((async a=>{if(!e)return;let r=await this.getMapPoint(e,{feature:i,imageSize:n,mode:t});(0,f.throwIfAborted)(a);const o=this.view?.spatialReference;o&&!r.spatialReference.equals(o)&&(r=await(0,O.projectWithZConversion)(r,o),(0,f.throwIfAborted)(a)),this.groundCoordinates=r}))}));this.addHandles(l,gt)},this._loadImage=async e=>{const{currentBestFeature:t,layer:a,mode:i}=this;if(this.clearGraphics(),!a||!t||"none"===i)return;const{attributes:r}=t,{imagePath:n,imageRotation:o,cameraHeading:s,cameraRoll:l,cameraPitch:c,objectId:u,cameraOrientation:h,location:d}=r,m=(l??0)+(o??0),g=d.spatialReference.isWGS84&&4!==h?.type?(0,z.geographicToWebMercator)(d):new A.default(d);let y=n;if((0,Ye.y0)(n))try{y=await(0,Ye.O_)(a,u,e)}catch(v){if((0,f.isAbortError)(v))return;return(0,Fe.NL)(v)?(p.A.getLogger(this).error(v),void this.setMessage("noAttachment","error",`${a.objectIdField}: ${u}`)):(p.A.getLogger(this).error(v,{[a.objectIdField]:u,layer:a}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${a.objectIdField} ${u}`))}try{await this.loadImageFromSource(y,{imageRotation:m,options:e,pitch:c,yaw:s,mode:i,cameraLocation:g}),(0,f.throwIfAborted)(e),await this.transformAndPlotSelectedLocation(e)}catch(v){(0,f.isAbortError)(v)||this.loadImageError(v)}},this._loadImageFromSourceInternal=async(e,t)=>{const{mode:a,imageRotation:i,options:r}=t,n="string"==typeof e,o=n?e:e.url,{pathname:s,searchParams:l}=new URL(o);let c=n?s.match(vt)?.[1]:e.datasetFormat;if(!c)try{c=await(0,Fe.gt)(o,{...t.options})}catch(u){(0,f.isAbortError)(u)||p.A.getLogger(this).error("#getContentType()",u)}switch(c??="UNKNOWN FORMAT",a){case"default":this._imageViewer.imageSource={datasetFormat:c.toUpperCase(),url:o.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(l),this._imageViewer.imageRotation=i??0,await this._imageViewer.loadImage(r);break;case"panoramic":if(ft.has(c.toUpperCase())){const{selectedPoint:e}=this,{pitch:a,yaw:i,cameraLocation:n,viewAngle:s}=t;this._panoramicViewer.imageSource=o;let l=i??0;"number"==typeof s?l=s-l:n&&e&&(l=await(0,Q.ox)(n,e)-l),this._panoramicViewer.pitch=a??0,this._panoramicViewer.yaw=l,await this._panoramicViewer.loadImage(r)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:c})}},this._loadViewAdapter=async e=>{const{view:t}=this;if(t)switch(t.type){case"2d":{const{default:t}=await a.e(15208).then(a.bind(a,15208));(0,f.throwIfAborted)(e),this._adapter=new t(this);break}case"3d":{const{default:t}=await a.e(11334).then(a.bind(a,11334));(0,f.throwIfAborted)(e),this._adapter=new t(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=e=>{e.stopPropagation(),e.preventDefault(),e.mapPoint&&this.plotMapPoint(e.mapPoint)},this._viewClickHandler=e=>{this._clickTask?.abort(),this._clickTask=(0,o.UT)((async t=>{const{pointerType:a,button:i,mapPoint:r}=e;if(("mouse"!==a||0===i)&&r)return e.stopPropagation(),e.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(r,{signal:t}))}))},this.plotSelectedPointOnImage=async(e,t)=>{if(await(0,f.waitTick)(t),!e)return;const a=new A.default({...h.A.isSerializable(e)?e.toJSON():e});if("default"===this.mode)a.x-=.5,a.y=.5-a.y,a.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new r.default({geometry:a,symbol:et.pB}),this._imageViewer.addGraphic(this._crossSymbol,0);else if("panoramic"===this.mode){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:n,pitch:o}=(0,Q.dM)(e,a,i),s=(0,Q.id)(n,o);this._crossSymbol=new r.default({geometry:new A.default(s,Z.default.WebMercator),symbol:et.ov}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([(0,w.watch)((()=>this.view),(()=>{this.load()}),w.syncAndInitial),(0,w.watch)((()=>this.view?.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.view?.map?.allLayers?.length),(e=>{e&&this.view?.map?.layers.reorder(this._overlays,e-1)}),w.initial),(0,w.watch)((()=>[this.state,this.mapImageConversionToolState,this.view]),(()=>{this._createViewClickHandle(),this._createImageClickHandle()}),w.syncAndInitial),(0,w.watch)((()=>[this.state,this.imageLocationToolState,this.view]),(()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()}),w.syncAndInitial),(0,w.watch)((()=>this.measureType),(()=>{this.clearPreviousMeasurements()}),w.syncAndInitial),(0,w.watch)((()=>this.bestFeatureAngle),((e,t)=>{this.previousFeatureAngle=t??0}),w.syncAndInitial),(0,w.watch)((()=>this.currentBestFeature),(async(e,t)=>{(0,g.DC)(this._featureChangedTask),this._featureChangedTask=(0,o.UT)((async a=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:a}]))),await this._featureChangedTask.promise}),{sync:!0}),(0,w.watch)((()=>this.mode),(e=>{switch(this.removeHandles(yt),e){case"default":this.addHandles((0,w.watch)((()=>{const{state:e}=this;return"image-loaded"===e?this._imageViewer.imagePointsInView:null}),(e=>{e&&((0,g.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async t=>{await this.updateFootprint(e,{signal:t})})))}),{...w.syncAndInitial,equals:(e,t)=>(0,n.aI)(e,t,d.equalsShallow)}),yt);break;case"panoramic":this.addHandles((0,w.watch)((()=>{const{currentBestFeature:e,state:t}=this,{imageSize:a,vfov:i,hfov:r,pitch:n,yaw:o}=this._panoramicViewer;return e&&a&&!t.includes("loading")?[i,r,o,n]:null}),(e=>{if(!e||this.state.includes("loading"))return;const[t,a,i,r]=e;(0,g.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async e=>{await this.updateFootprintPanorama({verticalFieldOfView:t,horizontalFieldOfView:a,yaw:i,pitch:r},{signal:e})}))}),{...w.syncAndInitial,equals:(e,t)=>(0,n.aI)(e,t,d.equalsShallow)}),yt)}}),w.syncAndInitial),(0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(()=>{const{_imageViewer:e,brightness:t,contrast:a,mode:i,sharpness:r}=this;"default"===i&&(e.brightness=t,e.contrast=a,e.sharpness=r)}),w.syncAndInitial),(0,w.watch)((()=>this.activeViewer?.imageRenderer),(()=>{this.sketch&&(this.sketch.view=this.activeViewer?.imageRenderer)}))]),this.when().finally((()=>{this.notifyChange("state")}))}destroy(){this._updateFootprintTask=(0,g.DC)(this._updateFootprintTask),this._clickTask=(0,g.DC)(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=(0,g.pR)(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=(0,g.pR)(this.bestFeatureCurrentFootprint),this._crossSymbol=(0,g.pR)(this._crossSymbol),this._referencePointOnGround=(0,g.pR)(this._referencePointOnGround),this._referencePointOnImage=(0,g.pR)(this._referencePointOnImage),this._locationPointOnImage=(0,g.pR)(this._locationPointOnImage),this._overlays&&this.view?.map?.remove(this._overlays),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:a}=this;switch(a){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){return this.layer?.orientationAccuracy?.every((e=>0===e))??!0}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,m.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,m.qE)(e,-10,10))}get featureCount(){return this.features?.length??0}get imageGalleryEnabled(){const{currentBestFeature:e}=this;if(!e)return!1;const t=e.attributes.imagePath?.trim();return(0,Fe._U)(t)||(0,Ye.y0)(t)}get imageLoaded(){return(0,l.Lx)(p.A.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),"image-loaded"===this.state}get invalidCameraHeading(){return this.currentBestFeature?.attributes?.cameraHeading===Qe.BH}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return"default"===e?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find((0,Fe.FL)(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?(0,me.E)(e):null}get mode(){const e=this.currentBestFeature?.attributes;if(!e)return"none";const{horizontalFieldOfView:t,isSpherical:a}=e;return 360===t||a?"panoramic":"default"}get popupEnabled(){return!0===this.layer?.popupEnabled}get referencePoint(){return this._referencePointOnGround?.geometry}get sectorData(){const{_sectorData:e}=this;return e?Qe.PD.map((t=>e[t])):null}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,m.qE)(e,0,1))}get sketchGraphicsLayer(){return this.sketch?.layer}get state(){const{mode:e,disabled:t,_updatingHandles:{updating:a},_featureChangedTask:i}=this;if(t)return"disabled";if(!this.isFulfilled()||a||!1===i?.finished)return"loading";if(this.isRejected())return"error";if("error"===this.displayMessage?.type)return"image-load-error";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new s.default(e.map((e=>{let{attributes:{imagePath:t,objectId:a,cameraRoll:i,imageRotation:r}}=e;const n=t?.trim();return(0,Fe._U)(n)||(0,Ye.y0)(n)?{url:n,objectId:a,rotation:(i??0)+(r??0)}:null})).filter(n.Ru)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new k.default({elevationInfo:{mode:"absolute-height"}});case"default":return new k.default;case"none":return}}get _overlaysView(){return this.view?.layerViews.find((e=>{let{layer:t}=e;return t===this._overlays}))}async computeHeight(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{currentBestFeature:i,activeViewer:r,layer:n,footprintExtent:o}=this,s=r?.imageSize,l=i?.attributes,c=n?.orientationAccuracy;if(!l||!s||!e||e.length<2||!c)return;const u="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Q.Mm)(l,s[0],s[1]),h=e.at(0),d=e.at(-1);if(!(u&&h&&d&&c&&o))return;const p=[d,h],m=(0,Xe.$0)(p,!1),g="panoramic"===t?await(0,Xe.QI)(p,u,c,i,!0,!1):await(0,Xe.AX)(p,u,c,!0,a);if(!g)return;const y="panoramic"===t?await(0,Xe.bO)(c,m,u,g,i,!0):await(0,Xe.jr)(c,m,u,g,!0);return y?{value:g,accuracy:y}:{value:g}}async calculateAreaMeasurement(e,t,a){if(e.length<3||!this.currentBestFeature||!this.activeViewer?.imageSize||"none"===t)return null;const i="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,f.throwIfAborted)(a),i?"default"===t?await(0,Xe.Md)(e,i,!0):await(0,Xe.yP)(e,i,!0,a):null}async calculateDistanceMeasurement(e,t,a){const{currentBestFeature:i,activeViewer:r}=this;if(e.length<2||!i||!r?.imageSize||"none"===t)return null;const n="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,f.throwIfAborted)(a),n?"default"===t?await(0,Xe.CN)([e.at(0),e.at(-1)],n,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],n,!0):null}async calculateAccuracy(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:n}=this,o=i?.orientationAccuracy,s=o?.every((e=>0===e))||!o?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!r||!n?.imageSize||s)return null;const l=await this.getMeasurementProperties();if((0,f.throwIfAborted)(a),!l)return null;const c="area"===t?await(0,Xe.Md)(e,l,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],l,!0);(0,f.throwIfAborted)(a);const{updateElevationProps:u,...h}=l,d=(0,Xe.gO)(h,o);if(!d?.length)return null;const p=d.map((e=>({...e,updateElevationProps:u}))).map((async i=>{const r="area"===t?await(0,Xe.Md)(e,i,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],i,!0);if((0,f.throwIfAborted)(a),r&&c){if("area"===t){const e="number"!=typeof r?r.area:null;return e?Math.abs(e-c.area):null}return Math.abs(r-c)}return null})),m=await Promise.all(p);(0,f.throwIfAborted)(a);const g=m.filter((e=>null!==e));return 0===g.length?null:(0,Xe.WB)(g)}async calculateAccuracyPanoramic(e,t,a){const{layer:i,currentBestFeature:r,activeViewer:n,mode:o}=this,s=i?.orientationAccuracy,l=s?.every((e=>0===e))||!s?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!r||!n?.imageSize||l||"panoramic"!==o)return null;const c=await this.getMeasurementPropertiesPanoramic();if((0,f.throwIfAborted)(a),!c)return null;const u="area"===t?await(0,Xe.yP)(e,c,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],c,!0);(0,f.throwIfAborted)(a);const{updateElevationProps:h,...d}=c,p=(0,Xe.cG)(d,s);if(!p?.length)return null;const m=p.map((e=>({...e,updateElevationProps:h}))).map((async i=>{const r="area"===t?await(0,Xe.yP)(e,i,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],i,!0);if((0,f.throwIfAborted)(a),r&&u){if("area"===t){const e="number"!=typeof r?r.area:null;return e?Math.abs(e-u.area):null}return Math.abs(r-u)}return null})),g=await Promise.all(m);(0,f.throwIfAborted)(a);const y=g.filter((e=>null!==e));return 0===y.length?null:(0,Xe.WB)(y)}async calculateHeightMeasurementInfo(e,t,a){const{currentBestFeature:i,activeViewer:r}=this,n=r?.imageSize;if(!i||!r||!n?.length||"none"===t)return;const{attributes:o}=i,[s]=(0,Xe.$0)([e],"panoramic"!==t),l="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Q.Mm)(o,n[0],n[1]);if("panoramic"===t){if(!l)return;const e=await(0,Xe.Z9)(s,l,i,a);if(!e)return;e?.heading>180&&(e.heading-=360);const t=(0,Xe.mf)(s,e),r=(0,I.Io)([s.x,s.y],[e.x,e.y]);if(!t||!r)return;return{measurementAngle:t,tempDistance:r}}const c=await(0,Xe._I)(s,l,a);if(!c)return;const u=(0,Xe.Qu)(s,c),h=(0,I.Io)([s.x,s.y],[c.x,c.y]);return u&&h?{measurementAngle:u,tempDistance:h}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){this.measurementGraphic&&(this.activeViewer?.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&(this.activeViewer?.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){return this.sketch?.cancel()}digitizeCanRedo(){return this.sketch?.canRedo()??!1}digitizeCanUndo(){return this.sketch?.canUndo()??!1}digitizeComplete(){return this.sketch?.complete()}async digitizeCreate(e,t){const{sketch:a,dataCaptureLayer:i}=this;if(!a)throw wt();(0,Ke.DV)(i,e,a),await a.create(e,{...t,defaultZ:0})}async digitizeDelete(){if(!this.sketch)throw wt();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw wt();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw wt();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw wt();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw wt();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw wt();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:a,mode:i}=this,r=t?.imageSize,n=e?.attributes;if(!n||!r)return;const o=await this.computeHeight(a,i);o?.value&&o?.accuracy&&(this.heightMeasurementResult=o.value,this.heightMeasurementAccuracy=o.accuracy)}filterByFootprints(e,t){const a=[],i=[],r=[];return e.forEach((e=>{const{layer:{coveragePercent:n},attributes:o}=e;let s;const l=(0,M.GA)(e.geometry.spatialReference);o.cameraHeight/=l,o.farDistance/=l,o.nearDistance/=l,(0,ce.E1)(o.elevationSource)&&(o.elevationSource.constantElevation/=l);const{polygon:c,frustum:u}=(0,le.ns)(o);if(s=c.clone(),o.isInspection&&(s=(0,le.nt)(o)),n&&(s=(0,le.v3)(s,n)),(0,le.Eh)(s,t)){r.push(e);const{geometry:t,objectId:n,cameraHeight:s,cameraHeading:l}=o,h=t.clone();h.z=s,h.imageID=n,this.pointSources.push(h),l!==Qe.BH&&(a.push(c),u&&i.push(u))}})),{features:r,polygons:a,frustums:i}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:n}=i,o=(0,Q.Mm)(i,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,O.projectWithZConversion)(s,Z.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,Q.Ns)((s.z??0)-n,{elevationSample:a,elevationSource:r,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,Q.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:a,attributes:i}=e,{elevationSource:r,cameraHeight:n}=i,o=(0,Q.m0)(i,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,O.projectWithZConversion)(s,Z.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,Q.Ns)((s.z??0)-n,{elevationSample:a,elevationSource:r,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,Q.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new c.default("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then((e=>{let{features:a}=e;return t.applyEdits({deleteFeatures:a})}))}handleSectorClick(e){if(isNaN(e))return;const t=this._sectorData?.[Qe.PD[e]];t?.length&&this._updateCurrentBestFeature(t.at(0))}handleFeatureClick(e){const{sector:t,featureIndexInSector:a}=e;if(isNaN(a))return;const i=this._sectorData?.[t];i?.length&&this._updateCurrentBestFeature(i.at(a))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:a,heightMeasurementPixels:i,mode:r,activeViewer:n}=this,o=n?.imageSize;if(!e.vertices||!o)return;const s=(0,Xe.Fj)(e.vertices.at(-1),r,o);if(i.length<1||!s||!a||!t||"none"===r)return;const l=(0,Xe.AG)(i[0],s,t);if(!l?.length)return;this.heightMeasurementPixels.push(l),"panoramic"===r?this.createPolylineGraphicPano():this.createPolylineGraphic();const c=(0,Xe.eY)(this.heightMeasurementPixels,a);c&&(this.heightMeasurementResult=c)}async handleDrawVertexAddEvents(e,t){const{currentBestFeature:a,activeViewer:i,heightMeasurementPixels:r,mode:n}=this;if(!a||!i||!e.vertices?.length||"none"===n)return;const o=i?.imageSize;if(!r.length&&o){const a=(0,Xe.Fj)(e.vertices.at(-1),n,o);this.heightMeasurementPixels.push(a);const i=await this.calculateHeightMeasurementInfo(a,n,t);if(!i?.measurementAngle||!i?.tempDistance)return;this.measurementAngle=i.measurementAngle,this.tempDistance=i.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch((e=>{if(!(0,f.isAbortError)(e))throw e}))),this}async loadBestImage(e,t){return this.view?.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?(0,z.geographicToWebMercator)(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=(0,g.pR)(this.bestFeatureCurrentFootprint),this._overlays?.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){p.A.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){if(!this.sketch){const t=a.e(81257).then(a.bind(a,81257)),{default:i}=await t;(0,f.throwIfAborted)(e),this.sketch=new i({layer:this._sketchGraphicsLayer,view:this.activeViewer?.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=a.e(41526).then(a.bind(a,41526)),{default:i}=await t;if((0,f.throwIfAborted)(e),this.sketchAdapter=new i({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:a,sketchAdapter:i,activeViewer:r,mode:n}=this;if(!a||!i||!r||"none"===n)return;if(this.displayNewMeasurementButton=!1,"panoramic"===n&&(a.defaultCreateOptions.defaultZ=0),await a.create(e),"panoramic"===n){const{drawOperation:e}=a.view.activeTool;e.constraintsEnabled=!1,e._set("elevationDrawSurface",null)}const o=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;o&&this.sketch&&(this.sketch.polygonSymbol=(0,et.fg)(o),this.sketch.polylineSymbol="panoramic"===n?et.Tu:(0,et.Jb)(o))}startHeightMeasurement(){this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??=new ye.default({view:this.activeViewer?.imageRenderer}),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],(e=>this.handleDrawEvents(e)))}createPolylineGraphic(){const e=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],t=this.activeViewer?.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new S.default({paths:[e],spatialReference:t});else{const a=new S.default({paths:[e],spatialReference:t}),i=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new r.default({geometry:a,symbol:(0,et.Jb)(i,2.5)}),this.activeViewer?.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){const e=this.activeViewer?.imageRenderer.spatialReference,t=this.activeViewer?.imageSize;if(!t)return;const a={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},i={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:n,pitch:o}=(0,Q.dM)(a,t[0],t[1]),{heading:s,pitch:l}=(0,Q.dM)(i,t[0],t[1]),c=[[...(0,Q.id)(n,o)],[...(0,Q.id)(s,l)]];if(this.heightGraphic)this.heightGraphic.geometry=new S.default({paths:[c],spatialReference:e});else{const t=new S.default({paths:[c],spatialReference:e});this.heightGraphic=new r.default({geometry:t,symbol:et.Tu}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:a,overlayedCameraLocations:i,layer:n,mode:o,state:s}=this,l=t?.imageSize;if(!l||!a||!n||"none"===o||s.includes("loading"))return;const{polygon:c}=(0,le.ns)(a.attributes);if(t.removeManyGraphics(i.toArray()),i.removeAll(),e){const{features:e}=await n.queryFeatures({where:`${n.objectIdField} <> ${a.attributes.objectId}`,geometry:c,returnGeometry:!0,outFields:[n.objectIdField]}),s=await Promise.all(e.map((async e=>{const{attributes:t,geometry:i}=e,n=await this.getPixels(i,{feature:a,imageSize:l,mode:o}),s=et.at.clone();return s.outline=new ge.default({color:[0,0,0],width:1}),new r.default({attributes:t,symbol:s,geometry:n})})));i.addMany(s),t.addManyGraphics(i.toArray())}}overlayGraphicsOnImage(e,t){this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),this.activeViewer?.addManyGraphics(t.toArray())}async overlayMapFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{activeViewer:a,currentBestFeature:i,mode:o,state:l,layer:c}=this,u=a?.imageSize;if(!u||!i||"none"===o||l.includes("loading")||!c)return;const{polygon:h}=(0,le.ns)(i.attributes);try{const{imageGeometryField:t,oiObjectIdField:a}=(0,Ke.Qv)(e,c.imageGeometryField,c.imageReferenceField);this.imageGeometryField=t.name,this.oiObjectIdField=a.name}catch(g){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",g)}const{features:d}=await e.queryFeatures({geometry:h,returnGeometry:!0,outFields:["*"]}),m=new s.default((await Promise.all(d.map((async a=>{const n=a.symbol?.clone()??e.renderer?.getSymbol(a)?.clone(),{attributes:s,geometry:l}=a,c=l,{imageGeometryField:h,oiObjectIdField:d}=this;if(h&&d&&(0,Ke.gE)(e,h,d)&&`${s[d]}`==`${i.attributes.objectId}`)try{return(0,Ke.jQ)(s,h,e,t,u,o,n)}catch(g){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:g,feature:a,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(c?.type){case"point":{const a=await this.getPixels(c,{feature:i,imageSize:u,mode:o});return new r.default({attributes:s,layer:e,symbol:n,geometry:a,visible:e.visible&&t})}case"polygon":{const{rings:a,spatialReference:l}=c,h=a.map((e=>e.map((e=>{let[t,a,i]=e;return new A.default({x:t,y:a,z:i,spatialReference:l})})))),d=await Promise.all(h.map((async e=>this.getPixels(e,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Q.n3))))));return new r.default({attributes:s,layer:e,symbol:n,geometry:new C.default({rings:d,spatialReference:Z.default.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:a,spatialReference:l}=c,h=a.map((e=>e.map((e=>{let[t,a,i]=e;return new A.default({x:t,y:a,z:i,spatialReference:l})})))),d=await Promise.all(h.map((async e=>this.getPixels(e,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Q.n3))))));return new r.default({attributes:s,layer:e,symbol:n,geometry:new S.default({paths:d,spatialReference:Z.default.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:a,spatialReference:l}=c,h=a.map((e=>{let[t,a,i]=e;return new A.default({x:t,y:a,z:i,spatialReference:l})})),d=await this.getPixels(h,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Q.n3)));return new r.default({attributes:s,layer:e,symbol:n,geometry:new R.default({points:d,spatialReference:Z.default.WebMercator}),visible:e.visible&&t})}}return null})))).filter(n.Ru));this.overlayGraphicsOnImage(`${e.id}`,m)}async getPixels(e,t){const{imageSize:a,mode:i}=t,r=(await this.worldToImage(Array.isArray(e)?e:[e])).map((e=>{if("default"===i)return new A.default({x:e.x-.5,y:.5-e.y,spatialReference:Z.default.WebMercator});const[t,r]=a,{heading:n,pitch:o}=(0,Q.dM)(e,t,r),s=(0,Q.id)(n,o);return new A.default(s,Z.default.WebMercator)}));return Array.isArray(e)?r:r[0]}async getMapPoint(e,t){const{feature:a,mode:i,imageSize:r}=t,{elevationSample:n,attributes:o}=a,{elevationSource:s,location:l,elevation:c,cameraHeight:u}=o;let h=l.clone();h.spatialReference.isGeographic&&(h=await(0,O.projectWithZConversion)(h,Z.default.WebMercator));const d=await(0,Q.Ns)(c??(l.z??0)-u,{elevationSample:n,elevationSource:s,extent:this.footprintExtent});let p;if("elevationSample"in d&&(0,Q.sp)(d.elevationSample)&&(a.elevationSample=d.elevationSample),"default"===i){const t=(0,Q.Mm)(o,r[0],r[1]);p=await(0,ue.imageToWorld)(Array.isArray(e)?e:[e],{...t,cameraLocation:h},d)}else{const t=(0,Q.m0)(o,r[0],r[1]);p=await(0,ue.imageToWorldPanoramic)(Array.isArray(e)?e:[e],{...t,cameraLocation:h},d)}return Array.isArray(e)?p:p[0]}async plotMapPoint(e){return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:this._transformController?.signal}})}plotReferencePointOnGround(e){this._referencePointOnGround&&(this._overlays?.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),null!=e&&(this._referencePointOnGround=new r.default({geometry:new A.default({...e.toJSON()}),symbol:et.FT}),this.view?this._overlays?.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:this._referencePointOnGround?.geometry}}))}plotReferencePointOnImage(e){if("image-loaded"===this.state)switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=h.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new r.default({geometry:new A.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.FT}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:n,pitch:o}=(0,Q.dM)(e,a,i),s=(0,Q.id)(n,o);this._referencePointOnImage=new r.default({geometry:new A.default(s,Z.default.WebMercator),symbol:et.IL}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if("image-loaded"===this.state)switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach((e=>{this._imageViewer.removeManyGraphics(e.toArray())})),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){const t=this.overlayedMapFeatures.get(e);t?.length&&(this.activeViewer?.removeManyGraphics(t.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=(0,g.DC)(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||"data-capture"!==t?.type)return;const{pendingGraphics:a,savedGraphics:i}=t,r=a.get(e.id),n=r?.toArray();if(!r||!n?.length)return;const{addFeatureResults:o}=await this.saveDataCaptureFeatures(n),s=o.reduce(((t,a,i)=>{let{objectId:r,globalId:o,error:s}=a;const l=n[i],{attributes:c}=l;return s?t.error.push(l):(r&&(c[e.objectIdField]=r),o&&e.globalIdField&&(c[e.globalIdField]=o),t.success.push(l)),t}),{success:[],error:[]});i.addMany(s.success),r.removeAll(),r.addMany(s.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:i,dataCaptureLayer:r,mode:o}=this,s=t?.imageSize;if(!s||!i||"none"===o)throw new c.default("Image size, current best feature and mode are required to save data capture features");if(!r)throw new c.default("Data capture layer is not available");const l=await Promise.all(e.map((async e=>{const t=e.clone(),{geometry:n}=t;if(!n)return;const l=n.type,c=r.hasZ,u=r.geometryType,h=l!==u,d=h?await a.e(71083).then(a.bind(a,71083)):null,p=d?.default[u],m=h?p?.(n):n;if(m)switch(m.type){case"point":return t.geometry=await this.getMapPoint((0,Q.Dy)(o,m,s),{feature:i,imageSize:s,mode:o}),c||(delete t.geometry.z,t.geometry.hasZ=!1),t.geometry.hasM=!1,t;case"polygon":{const e=await Promise.all(m.rings.map((async e=>this.getMapPoint(e.map((e=>{let[t,a,i]=e;return(0,Q.Dy)(o,{x:t,y:a,z:i},s)})),{feature:i,imageSize:s,mode:o}))));return t.geometry=new C.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,rings:e.map((e=>e.map(Q.n3)))}),t}case"polyline":{const e=await Promise.all(m.paths.map((async e=>this.getMapPoint(e.map((e=>{let[t,a,i]=e;return(0,Q.Dy)(o,{x:t,y:a,z:i},s)})),{feature:i,imageSize:s,mode:o}))));return t.geometry=new S.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,paths:e.map((e=>e.map(Q.n3)))}),t}}}))),u=l.filter(n.Ru);return r.applyEdits({addFeatures:u}).then((e=>{const{addFeatureResults:t}=e;let a=0;const i=l.map((e=>{const i=t[a++];return e?i:{error:new c.default("Error in saving data capture features"),objectId:null,globalId:null}}));return{...e,addFeatureResults:i}}))}async searchBestImage(e,t){try{const a=await ie(e,t);a&&await this._processFeatureResponse(a,e.point,{signal:t?.signal})}catch(a){(0,f.isAbortError)(a)||(this.setMessage("imageLoadError","error",a.message),p.A.getLogger(this).error("error occurred while finding best image",a))}}selectBestFeature(e){this.currentBestFeature=this.features?.find((t=>{let{attributes:a}=t;return a.objectId===Number(e)}))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach((t=>{t.visible=e}))}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach((t=>{t.visible=e}))}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){const a=this.activeViewer?.imageRenderer,{oiObjectIdField:i,currentBestFeature:r}=this;if(!a||!r||!i)return;const{attributes:{objectId:n}}=r,o=this.overlayedMapFeatures.get(e.id)?.toArray()??[],l=[],c=[];for(const s of o)`${s.getAttribute(i)}`==`${n}`?l.push(s):c.push(s);this.overlayGraphicsOnImage(e.id,new s.default(c)),this.collectionId=e.id;const u=await this.loadSketch(t),h=await this.loadDataCaptureAdapter(t);(0,f.throwIfAborted)(t),u.layer.addMany(l),u.layer.blendMode="source-atop",h.savedGraphics.addMany(l),a.ui.find("zoom").visible=!1,a.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.sketch?.cancel(),this.sketchGraphicsLayer?.removeAll(),this.sketchAdapter=(0,g.pR)(this.sketchAdapter),this.sketch=(0,g.pR)(this.sketch),this.collectionId=null;const{dataCaptureLayer:t}=this,a=this.activeViewer?.imageRenderer;if(!a||a.destroyed)return;a.map.layers.remove(this.sketchGraphicsLayer),e&&t&&await this.overlayMapFeatures(t,!0);const i=a.ui.find("zoom");i&&(i.visible=!0)}stopMeasurement(){this.heightMeasurementPixels=[],this.draw?.reset(),this.sketch?.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach((t=>{this._toggleVisiblity(t,e)}))}toggleOverlayMapFeatures(e,t){const a=this.overlayedMapFeatures.get(e);a&&this._toggleVisiblity(a,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){const{selectedLocation:t,options:a}=e;let i=!1,r=!1;const n=this.bestFeatureFootprint?.geometry;switch(n?.type){case"polygon":{const e=t.spatialReference.equals(n.spatialReference)?t:await(0,O.projectWithZConversion)(t,n.spatialReference);i=n.contains(e);break}case"mesh":{const e=t.spatialReference.equals(n.spatialReference)?t:await(0,O.projectWithZConversion)(t,n.spatialReference);r=n.extent.contains(e);break}}if(!i&&!r)return void this.clearReferencePointOnImage();const o=await this.worldToImage(t,a);if(o)return(0,f.throwIfAborted)(a),this.plotReferencePointOnImage(o),{x:o.x,y:o.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort(((e,t)=>e.suitability-t.suitability)),this._suitabilities=e;const t=this._suitabilities.map((e=>{let{feature:t}=e;return t}));this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const a=this.layer;if(a){const i={include:a},r=this.view.toScreen(e);if(!r)return;const n=await this.view.hitTest(r,i);return this._processHitTestResults(a,n,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(a){if((0,f.isAbortError)(a))return;this.setMessage("imageLoadError","error"),p.A.getLogger(this).error("error occurred while fetching features",a)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:a,features:i,invalidCameraHeading:r}=this;if(!e||!t||!a||!i||r)return void(this._sectorData=null);this._sectorData={};for(const c of Qe.PD)this._sectorData[c]=new s.default;const n=e.map(((e,t)=>({...e,featureIndex:t})));n.sort(((e,t)=>e.trueSuitability-t.trueSuitability));const o=n.map((e=>{let{distance:t}=e;return t})),l=Math.max(...o);n.forEach((e=>{const{distance:t,angle:a,featureIndex:r}=e,n=t/l*Qe.rV[2],o=(0,Fe.Cg)(t,l),s=(0,Fe.wB)(a);if(!this._sectorData)return;const c=Qe.rV[3]+n*Math.sin(a*Math.PI/180),u=Qe.rV[3]+n*Math.cos(a*Math.PI/180);let h;const d=i.at(r),p=d===this.currentBestFeature,m=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;if(p&&m)h=-90;else{const e=c-Qe.rV[3],t=u-Qe.rV[3],a=t/Math.sqrt(e**2+t**2);let i=180*Math.acos(a)/Math.PI;(e<0&&t<0||e<0&&t>0)&&(i*=-1),h=i}const g=""===o?s:`${o}_${s}`;p&&(h===this.bestFeatureAngle?this.previousFeatureAngle=h:this.bestFeatureAngle=h,this.navigatorCurrentBestFeature=m?null:{x:c,y:u,direction:s});const y=this._sectorData[g];y.add({angle:a,featureIndex:r,x:c,y:u,objectID:d.attributes.objectId,sector:g,featureIndexInSector:y.length})}))}_plotLocationPointOnDefaultImage(e){const t=h.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new r.default({geometry:new A.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.C1}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[a,i]=t,{heading:n,pitch:o}=(0,Q.dM)(e,a,i),s=(0,Q.id)(n,o);this._locationPointOnImage=new r.default({geometry:new A.default(s,Z.default.WebMercator),symbol:et.PR}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,a){const{features:i}=e;if(!i?.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:r,polygons:n,frustums:o}=this.filterByFootprints(i,t);if(!r.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let s;if(this.coveragePolygons.addMany(n),this.coverageFrustums.addMany(o),n[0]){let e=new C.default({spatialReference:n[0].spatialReference});for(const a of n)e=await(0,F.union)(e,a);const t=[];for(const{geometry:a}of r)e.contains(a)||t.push([a.x,a.y]);if(t.sort(((e,t)=>+(0,V.$3)([e,t]))),e.addRing(t),this.footprintExtent=(0,fe.hs)(e.extent,2,2),this.view?.supportsGround)try{s=await this.view.map.ground.createElevationSampler(this.footprintExtent,a)}catch(l){(0,f.isAbortError)(l)||p.A.getLogger(this).error(l)}}if((s||r[0].attributes.elevationSource)&&this.footprintExtent){const e=r[0].attributes.elevationSource;(0,ce.jV)(e)&&!s&&(s=await(0,de.gm)({extent:this.footprintExtent,lod:e.lod,url:e.url,rasterFunction:e.rasterFunction}));const a=await(0,Q.Ns)((r[0].attributes.location.z??0)-r[0].attributes.cameraHeight,{elevationSample:s,elevationSource:e,extent:this.footprintExtent}),[i,...n]=await(0,he.A)([t,...r.map((e=>e.attributes.geometry.clone()))],a);r[0].elevationSample=s??a.elevationSample,t.elevation=i.z,r.forEach(((e,t)=>{e.attributes.elevation=n[t].z}))}r[0].elevationSample&&r.forEach((e=>{e.elevationSample=r[0].elevationSample})),this._suitabilities=oe({features:r,selectedPoint:t,camera:(0,Fe.Gd)(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,a){const{screenPoint:i,results:[r]}=t,n="graphic"===r?.type&&this.shouldShowSelectedImage,o=r?.mapPoint??this.view?.toMap(i);if(!o)return;const{layerFloorFilterClause:s}=this,l=e.spatialReference.equals(o.spatialReference)?o:await(0,O.projectWithZConversion)(o,e.spatialReference),c=(0,_.sqlAnd)("1=1",(0,_.sqlAnd)(e.definitionExpression,s)),u=l.spatialReference.isGeographic?1:(0,M.GA)(l.spatialReference),h={layerInstanceOrURL:e,point:l,queryParams:{where:c,maximumDistance:e.maximumDistance?e.maximumDistance/u:void 0,objectIds:n?[r.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(h,a)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach((e=>{e.visible=t}))}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){const{pointSources:t,currentBestFeature:a,currentCoverageVisible:i,isAdditionalPointSourcesVisible:n}=this;if(a&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await(this._adapter?.createFootprints(e)),(0,f.throwIfAborted)(e);for(const e of t)e.imageID===a.attributes.objectId?this.currentBestFeatureLocation=new r.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.OO,visible:i}):this.additionalCameraLocations.push(new r.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.at,visible:n}))}}_updateCurrentBestFeature(e){if(!e)return;this.currentBestFeature=this.features?.at(e.featureIndex);const t=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;let a;if(t)a=-90;else{const t=e.x-Qe.rV[3],i=e.y-Qe.rV[3],r=i/Math.sqrt(t**2+i**2);let n=180*Math.acos(r)/Math.PI;(t<0&&i<0||t<0&&i>0)&&(n*=-1),a=n}a===this.bestFeatureAngle?this.previousFeatureAngle=a:this.bestFeatureAngle=a,this.navigatorCurrentBestFeature=t?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=(0,g.pR)(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=(0,g.pR)(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,a,i){this.displayMessage={key:e,type:t,data:a,map:i}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:a,selectedPoint:i,activeViewer:r}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=(0,g.pR)(this._crossSymbol)),!i||!t||"image-loaded"!==r?.state||a)return;let n;try{n=await this.worldToImage(i,e),(0,f.throwIfAborted)(e),await this.plotSelectedPointOnImage(n,e)}catch(o){(0,f.isAbortError)(o)||p.A.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:o,selectedPoint:i,feature:t})}}async worldToImage(e,t){const{footprintExtent:a}=this,{imageSize:i}=this.activeViewer;if("none"===this.mode||!this.currentBestFeature||!i||!a)return;const{attributes:{location:r,elevationSource:n,cameraHeading:o,elevation:s,cameraHeight:l},elevationSample:c}=this.currentBestFeature;let u=r.clone();const h=await(0,Q.Ns)(s??(r.z??0)-l,{elevationSample:c,elevationSource:n});this.currentBestFeature.elevationSample=h.elevationSample;const d=Array.isArray(e)?e:[e];let p,m=await Promise.all(d.map((e=>new Promise((t=>{if(!e.hasZ)return t((0,he.A)(e,h));t(e)})))));if(r.spatialReference.isGeographic&&(u=await(0,O.projectWithZConversion)(u,Z.default.WebMercator,t)),m=await Promise.all(m.map((async e=>u.spatialReference.equals(e.spatialReference)?e:await(0,O.projectWithZConversion)(e,u.spatialReference,t)))),(0,f.throwIfAborted)(t),"panoramic"===this.mode)p=(0,pe.worldToImagePanoramic)(m,{imageHeight:i[1],imageWidth:i[0],cameraHeading:o,cameraLocation:u});else{const e=(0,Q.cb)(this.currentBestFeature.attributes,i[0],i[1]);p=(0,pe.worldToImage)(m,{...e,cameraLocation:u})}return Array.isArray(e)?p:p[0]}updateCurrentCoveragePolygon(e){const{additionalFootprints:t,additionalCameraLocations:a,currentBestFeature:i,currentBestFeatureLocation:n,currentCoverageVisible:o,selectedPoint:s,view:l,_adapter:c,mode:u}=this,{attributes:{objectId:h},elevationSample:d}=i;if(this._initialCurrentCoverageUpdate){if(this._overlays?.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=(0,g.pR)(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=o,this.bestFeatureCurrentFootprint=e),l){const e=[...t,...a,n].filter(Fe.DU);l.supportsGround&&d&&c?.updateGroundElevation&&(this._updateGroundElevation&&c.updateGroundElevation(e,d),"panoramic"===u&&c.updateGroundElevation([this.bestFeatureCurrentFootprint],d)),this._updateGroundElevation=!1,s&&(e.splice(-2,0,this.bestFeatureCurrentFootprint),e.push(new r.default({geometry:s.clone(),symbol:et.pB.clone(),attributes:{imageID:h}}))),this._overlays.graphics.addMany(e)}}else if(l){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&(this._overlays?.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=(0,g.pR)(this.bestFeatureCurrentFootprint));const t=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,l?.supportsGround&&d&&c?.updateGroundElevation&&"panoramic"===u&&c.updateGroundElevation([e],d),e.visible=this.currentCoverageVisible,this._overlays?.graphics.add(this.bestFeatureCurrentFootprint,t>=0?t:this._overlays.graphics.length-1))}}};(0,i._)([(0,b.MZ)()],_t.prototype,"activeLayer",null),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"activeViewer",null),(0,i._)([(0,b.MZ)()],_t.prototype,"accuracyParametersMissing",null),(0,i._)([(0,b.MZ)()],_t.prototype,"additionalFeatures",void 0),(0,i._)([(0,b.MZ)({type:s.default.ofType(r.default)})],_t.prototype,"additionalCameraLocations",void 0),(0,i._)([(0,b.MZ)({type:s.default.ofType(r.default)})],_t.prototype,"additionalFootprints",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"areaMeasurementResult",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"areaMeasurementAccuracy",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"bestFeatureAngle",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"bestFeatureCurrentFootprint",void 0),(0,i._)([(0,b.MZ)({type:r.default})],_t.prototype,"bestFeatureFootprint",void 0),(0,i._)([(0,b.MZ)({type:Number})],_t.prototype,"brightness",null),(0,i._)([(0,b.MZ)()],_t.prototype,"collectionId",void 0),(0,i._)([(0,b.MZ)({type:Number})],_t.prototype,"contrast",null),(0,i._)([(0,b.MZ)()],_t.prototype,"conversionProps",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"coverageFrustums",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"coveragePolygons",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"currentBestFeature",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"currentBestFeatureLocation",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"currentCoverageVisible",void 0),(0,i._)([(0,b.MZ)({json:{write:!1}})],_t.prototype,"determineWorkflowForFeature",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"disabled",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"displayMessage",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"displayNewMeasurementButton",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"distanceMeasurementResult",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"distanceAccuracyArray",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"dataCaptureLayer",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"featureCount",null),(0,i._)([(0,b.MZ)()],_t.prototype,"features",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"groundCoordinates",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"heightMeasurementPixels",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"heightGraphic",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"heightMeasurementResult",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"heightMeasurementAccuracy",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"measurementAngle",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"tempDistance",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"imageGalleryEnabled",null),(0,i._)([(0,b.MZ)()],_t.prototype,"imageGeometryField",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"imageLoaded",null),(0,i._)([(0,b.MZ)()],_t.prototype,"imageLocationToolState",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"invalidCameraHeading",null),(0,i._)([(0,b.MZ)()],_t.prototype,"imagePointsInView",null),(0,i._)([(0,b.MZ)()],_t.prototype,"isAdditionalCoverageVisible",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"isAdditionalPointSourcesVisible",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"layer",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"layerView",null),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"layerFloorFilterClause",null),(0,i._)([(0,b.MZ)({type:Number})],_t.prototype,"localPort",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"mapImageConversionToolState",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"measureType",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"measurementGraphic",void 0),(0,i._)([(0,b.MZ)({readOnly:!0,value:"none"})],_t.prototype,"mode",null),(0,i._)([(0,b.MZ)()],_t.prototype,"navigatorCurrentBestFeature",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"oiObjectIdField",void 0),(0,i._)([(0,b.MZ)({type:s.default.ofType(r.default)})],_t.prototype,"overlayedCameraLocations",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"overlayedMapFeatures",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"pixelCoordinates",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"pointSources",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"popupEnabled",null),(0,i._)([(0,b.MZ)()],_t.prototype,"previousFeatureAngle",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"referencePoint",null),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"sectorData",null),(0,i._)([(0,b.MZ)()],_t.prototype,"selectedPoint",void 0),(0,i._)([(0,b.MZ)({type:Number})],_t.prototype,"sharpness",null),(0,i._)([(0,b.MZ)()],_t.prototype,"shouldShowSelectedImage",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"sketch",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"draw",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"sketchAdapter",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"sketchGraphicsLayer",null),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"state",null),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"thumbnails",null),(0,i._)([(0,b.MZ)()],_t.prototype,"updateFootprint",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"updateFootprintPanorama",void 0),(0,i._)([(0,b.MZ)({value:null})],_t.prototype,"view",null),(0,i._)([(0,b.MZ)()],_t.prototype,"_adapter",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_sketchGraphicsLayer",null),(0,i._)([(0,b.MZ)()],_t.prototype,"_highlightedFeatureHandle",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_imageViewer",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_initialCurrentCoverageUpdate",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_locationPointOnImage",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_overlays",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"_overlaysView",null),(0,i._)([(0,b.MZ)()],_t.prototype,"_panoramicViewer",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_previousCursor",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_referencePointOnGround",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_referencePointOnImage",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_sectorData",void 0),(0,i._)([(0,b.MZ)({readOnly:!0})],_t.prototype,"_updatingHandles",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"footprintExtent",void 0),(0,i._)([(0,b.MZ)()],_t.prototype,"_featureChangedTask",void 0),_t=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],_t);const Mt=_t},86017:(e,t,a)=>{a.d(t,{Eh:()=>I,PT:()=>V,WD:()=>S,ns:()=>M,nt:()=>R,v3:()=>C});var i=a(50346),r=a(44680),n=a(9392),o=a(63919),s=a(20664),l=a(70961),c=a(10851),u=a(66388),h=a(65215),d=a(9624),p=a(13312),m=a(14556),g=a(79629),y=a(56623),f=a(13927),v=a(80963),w=a(97572);const _=Math.PI/180;function M(e){return e.isSpherical?function(e){const{geometry:t,farDistance:a,objectId:i,nearDistance:r,cameraHeight:n}=e,o=(0,w.i2)(t.y,t.spatialReference),s=new l.default({center:t.clone(),radius:a*o});if(s.imageID=i,r){const e=new l.default({center:t.clone(),radius:r*o});s.addRing(e.rings[0])}const u=t.clone();u.z=n-a*o;const h=c.default.createSphere(u,{size:2*a*o});return h.imageID=i,{polygon:s,frustum:h}}(e):function(e){const{horizontalFieldOfView:t,verticalFieldOfView:a,geometry:i,cameraHeading:r}=e,n=(0,w.i2)(i.y,i.spatialReference);let o=e.cameraPitch,s=e.cameraRoll??0,l=150;t>150&&(o=90,s=0,l=5);const c=Math.ceil(t/l),u=function(e,t,a){const i=[];if(e%2==0)for(let r=0;r<e/2;r++)i.push(t-a/e*(r+.5),t+a/e*(r+.5));else{i.push(t);for(let r=1;r<e/2;r++)i.push(t-a/e*r,t+a/e*r)}return i.sort(),i}(c,r,t);let d=e.farDistance?e.farDistance*n:e.cameraHeight*n/Math.cos(o*_);e.cameraPitch+a/2>=90&&(d=(e.farDistance||20)*n);const p=new h.default({spatialReference:i?.spatialReference});p.imageID=e.objectId;let m=null;for(const h of u)m=b(h,o,e.cameraHeight,i,d,n,a,t,c,p,s,e.nearDistance);return m.imageID=e.objectId,{polygon:p,frustum:m}}(e)}function b(e,t,a,i,l,c,u,h,d,p){let m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0;const y=(0,o.mg)((0,r.vt)(),(0,w._i)([e,t,m??0])),f=F({cameraHeight:a,cameraPitch:t,farDistance:l,location:i,horizontalFieldOfView:h,nearDistance:g,verticalFieldOfView:u},y),v=(0,w.ei)([0,0,-1],y),{x:M,y:b}=i,I=(0,w.MY)([M,b,a],v,l,c),P=2*Math.tan(u*_/2)*l,R=2*Math.tan(h/d*_/2)*l,A=(0,w.ei)([0,1,0],y),C=(0,w.ei)([1,0,0],y),S=(0,w.Qu)(A,P/2,c),O=(0,w.Qu)(C,R/2,c),Z=(0,s.a)((0,n.Ul)(),S,O),V=(0,s.g)((0,n.Ul)(),S,O),z=x([(0,s.g)((0,n.Ul)(),I,Z),(0,s.g)((0,n.Ul)(),I,V),(0,s.a)((0,n.Ul)(),I,Z),(0,s.a)((0,n.Ul)(),I,V)],a,i,c);return z.push(z[0]),p.addRing(z),f}function x(e,t,a,i){return e.map((e=>function(e,t,a,i){{const r=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-a.x)**2+(e[1]-a.y)**2)/i)**2)*i,o=(0,w.Qu)((0,s.a)((0,n.Ul)(),[e[0],e[1],e[2]],[a.x,a.y,t]),1/r,1/i),l=t/(t-e[2]),c={x:(1-l)*a.x+l*e[0],y:(1-l)*a.y+l*e[1],z:(1-l)*t+l*e[2]},u=Math.sqrt((c.z-t)**2+(Math.sqrt((c.x-a.x)**2+(c.y-a.y)**2)/i)**2)*i,h=(0,w.Qu)((0,s.a)((0,n.Ul)(),[c.x,c.y,c.z],[a.x,a.y,t]),1/u,1/i);return P(o[0],h[0])&&P(o[1],h[1])&&P(o[2],h[2])||e[2]>=0?[e[0],e[1],0]:[c.x,c.y,c.z]}}(e,t,a,i)))}function I(e,t){return e.contains(t)}function P(e,t){return Math.sign(e)!==Math.sign(t)}function F(e,t,a){const{cameraHeight:i,cameraPitch:r,farDistance:o,location:l,horizontalFieldOfView:u,nearDistance:h,verticalFieldOfView:d}=e,p=A(l),m=r+d/2>=90==0,g=2*Math.tan(d*_/2)*h,f=2*Math.tan(u*_/2)*h,v=2*Math.tan(d*_/2)*o,M=2*Math.tan(u*_/2)*o;let b,x;x=[0,0,-1],x=(0,w.ei)(x,t),b=(0,w.MY)([l.x,l.y,i],x,o,p),m&&(b[2]=0);const I=(0,w.MY)([l.x,l.y,i],x,h,p);let P=[0,1,0];P=(0,w.ei)(P,t);let F=[1,0,0];F=(0,w.ei)(F,t);let R=[],C=[];h?(C=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],R=R.concat((0,s.g)((0,n.Ul)(),I,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(F,f/2,p)))),R=R.concat((0,s.g)((0,n.Ul)(),I,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(F,f/2,p)))),R=R.concat((0,s.a)((0,n.Ul)(),I,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(F,f/2,p)))),R=R.concat((0,s.a)((0,n.Ul)(),I,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,g/2,p),(0,w.Qu)(F,f/2,p))))):(R=[l.x,l.y,i],C=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),R=R.concat((0,s.g)((0,n.Ul)(),b,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,v/2,p),(0,w.Qu)(F,M/2,p)))),R=R.concat((0,s.g)((0,n.Ul)(),b,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,v/2,p),(0,w.Qu)(F,M/2,p)))),R=R.concat((0,s.a)((0,n.Ul)(),b,(0,s.a)((0,n.Ul)(),(0,w.Qu)(P,v/2,p),(0,w.Qu)(F,M/2,p)))),R=R.concat((0,s.a)((0,n.Ul)(),b,(0,s.g)((0,n.Ul)(),(0,w.Qu)(P,v/2,p),(0,w.Qu)(F,M/2,p))));const S=new y.H({position:Float64Array.from(R)});return new c.default({vertexAttributes:S,components:C,spatialReference:l.spatialReference})}function R(e){const{spatialReference:t,x:a,y:i}=e.geometry,{cameraHeading:r,cameraPitch:n,farDistance:o,nearDistance:s}=e,l=A(e.geometry),c=new h.default({spatialReference:t}),u=Math.abs(1.44*o*l);let d=Math.abs(1.44*s*l);(n<20||null==r)&&(d=u);const p=[];return p[0]={x:a+u*Math.sin((r-45)*_),y:i+u*Math.cos((r-45)*_)},p[1]={x:a+u*Math.sin((r+45)*_),y:i+u*Math.cos((r+45)*_)},p[2]={x:a+d*Math.sin((r+135)*_),y:i+d*Math.cos((r+135)*_)},p[3]={x:a+d*Math.sin((r+225)*_),y:i+d*Math.cos((r+225)*_)},c.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),c}function A(e){return e&&(0,v.K8)(e?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/m.$O.radius))):1}function C(e,t){const a=1+t/100;if("esri.geometry.Circle"===e.declaredClass){const{radius:t,center:i}=e,r=new l.default({radius:t*a,center:i});return e.rings.length>1&&r.addRing(e.rings[1]),r}if("esri.geometry.Polygon"===e.declaredClass){const t=new h.default({spatialReference:e.spatialReference}),i=e.centroid;if(i){const r=[];for(let t=0;t<e.rings[0].length;t++){const o=Math.sqrt((i.x-e.rings[0][t][0])**2+(i.y-e.rings[0][t][1])**2),l=(0,w.Qu)((0,s.a)((0,n.Ul)(),[e.rings[0][t][0],e.rings[0][t][1],0],[i.x,i.y,0]),1/o,1),c=(0,w.MY)([i.x,i.y,0],l,o*a,1);r.push({x:c[0],y:c[1]})}t.addRing([[r[0].x,r[0].y,0],[r[1].x,r[1].y,0],[r[2].x,r[2].y,0],[r[3].x,r[3].y,0],[r[0].x,r[0].y,0]])}return t}return e}async function S(e,t,a){const{cameraHeight:i,cameraLocation:r,cameraPitch:n,frustumVertices:o,horizontalFieldOfView:s,imageHeight:l,imageWidth:u,inSRS:h,outSRS:d,verticalFieldOfView:m,cameraRoll:g,options:f}=a,v=new p.default(h),_=new p.default(d),M=(0,w.x1)(s,m,g??0),b=o.length>15;return n+M.vfov/2>=90?await async function(e,t,a,i,r,n,o,s){let l,u=o?new Array:[e[0],e[1],e[2]],h=new Array;for(const c of t)o?(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),u=u.concat(...l),l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),h=h.concat(...l)):(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[a,0,1],[a,i,1],[0,i,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),u=u.concat(...l));u=u.concat(h);const d=await V(u,r,n,s),p=E(d);return new c.default({vertexAttributes:new y.H({position:d}),components:L(o?k(p,!0):G(p,!0)),spatialReference:n})}(o,e,u,l,v,_,b,f):await async function(e,t,a,i,r,n,o,s,l){const u=function(e,t,a,i,r){const n=z(e),o=z(e,"near");if(!n)return;const s=t.length;for(let l=0;l<s;l++){const e=Array.from(a[l]),t=[e[0]-i[0],e[1]-i[1],e[2]-(i[2]??r)];Z(i,t,l,o),O(i,t,l,n)}return{farPlane:n,nearPlane:o}}(e,t,a,i,r);if(!u)return;const{farPlane:h,nearPlane:d}=u,p=await V([...d?.vertexPositions??e.slice(0,3),...h.vertexPositions],o,s,l),m=E(p);return new c.default({vertexAttributes:new y.H({position:p}),components:L(n?k(m,!0):G(m,!0)),spatialReference:s})}(o,e,t,r,i,b,v,_,f)}function O(e,t,a,i){const{coefficients:r,vertexPositions:o}=i,s=(0,n.Ul)();(0,f.Ui)(r,{origin:e,direction:t},s)&&o.splice(3*a,3,...s)}function Z(e,t,a,i){if(!i)return;const r=(0,n.Ul)();(0,f.Ui)(i.coefficients,{origin:e,direction:t},r)&&i.vertexPositions.splice(3*a,3,...r)}async function V(e,t,a,r){if(t.equals(a))return e;const n=e.reduce(((e,t,a)=>{const i=Math.floor(a/3);return e[i]||(e[i]=new Array),e[i].push(t),e}),new Array),{points:o}=await(0,d.projectWithZConversion)(new u.default(n,t),a,r);return(0,i.throwIfAborted)(r),o.flat()}function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"far";const a=(0,f.vt)();let i;switch(t){case"far":if(i=Array.from(15===e.length?e.slice(3):e.slice(12)),(0,f.ci)(a,i,!1))return{coefficients:a,vertexPositions:i};break;case"near":if(i=Array.from(e.slice(0,12)),15===e.length||!(0,f.ci)(a,i,!1))return;return{coefficients:a,vertexPositions:i}}}const k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const a=[],i=e/2,r=Math.round((t?e-2:e)/2);for(let n=0;n<r;n++){const r=n+i,o=t?r+1:r,s=o%e,l=(t?r:o+1)%e;a.push({faces:new Uint32Array([n,l,s,n,n+1,s])})}return a};function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const a=[],i=t?e-2:e-1;for(let r=0;r<i;r++)a.push({faces:new Uint32Array([0,r+1,r+2])});return a}const L=e=>e.map((e=>new g.default(e))),E=e=>e.length/3},99464:(e,t,a)=>{a.d(t,{DV:()=>p,Qv:()=>m,gE:()=>h,gl:()=>d,jQ:()=>g,zT:()=>y});var i=a(39356),r=a(50076),n=a(65215),o=a(19902),s=a(97572),l=a(44538),c=a(19562);function u(e,t,a){const i=e.toLowerCase(),r=t.toLowerCase()===i,n=a?.toLowerCase()===i;return(0,s.or)(r,n)}function h(e,t,a){return function(e){return"point"===e||"polygon"===e||"polyline"===e}(e.geometryType)&&2===e.fields.filter((e=>{let{name:i,type:r,alias:n}=e;return u(a?.length?a:l.uS,i,n)||u(t?.length?t:l.j5,i,n)&&"blob"===r})).length}function d(e){return"feature"===e.type&&function(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}(e)}function p(e,t,a){if(!e)return;const{renderer:i}=e,r=(0,c.dg)(t),n=i?"symbol"in i?i.symbol:"defaultSymbol"in i?i.defaultSymbol:i.getSymbol():null,o=r(n?.color);a[`${t}Symbol`]=(t===e.geometryType?n:null)??o}function m(e,t,a){const i=e.fields.find((e=>{let{name:a,alias:i,type:r}=e;return u(t?.length?t:l.j5,a,i)&&"blob"===r})),n=e.fields.find((e=>{let{name:t,alias:i}=e;return u(a?.length?a:l.uS,t,i)}));if(!i||!n)throw new r.default("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:i,oiObjectIdField:n});return{imageGeometryField:i,oiObjectIdField:n}}function g(e,t,a,n,s,l,u){let h=function(e,t){const{geometry:a}=JSON.parse(atob(e[t]));return(0,o.fromJSON)(a)}(e,t);if(!h)throw new r.default("InvalidGeometry");return h=function(e,t,a){switch(t){case"default":return function(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,a]=e;return[t-.5,.5-a]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,a]=e;return[t-.5,.5-a]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,a]=e;return[t-.5,.5-a]}));break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return v(e,a)}}(h,l,s),new i.default({attributes:e,layer:a,symbol:(0,c.ph)(h.type,a.geometryType,u),geometry:h,visible:a.visible&&n})}function y(e,t,a){switch(t){case"default":return function(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,a]=e;return[t+.5,.5-a]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,a]=e;return[t+.5,.5-a]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,a]=e;return[t+.5,.5-a]}));break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return f(e,a)}}function f(e,t){switch(e.type){case"point":{const{x:a,y:i}=(0,s.pq)(e,t[0],t[1]);e.x=a,e.y=i,delete e.z;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const{x:a,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,i]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const{x:a,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,i]}))));break;case"multipoint":e.points=e.points.map((e=>{const{x:a,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,i]}));break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=f(n.default.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r;break}}return e}function v(e,t){switch(e.type){case"point":{const[a,i,r]=(0,s.D5)(e,t[0],t[1]);e.x=a,e.y=i,e.z=r;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const[a,i,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[a,i,r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const[a,i,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[a,i,r]}))));break;case"multipoint":e.points=e.points.map((e=>{const[a,i,r]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[a,i,r]}));break;case"extent":{const{xmin:a,xmax:i,ymin:r,ymax:o}=v(n.default.fromExtent(e),t).extent;e.xmax=i,e.xmin=a,e.ymax=o,e.ymin=r}}return e}}}]);
//# sourceMappingURL=61618.4fb133e1.chunk.js.map