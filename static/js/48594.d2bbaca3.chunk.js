"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[48594,79256],{5600:(e,t,n)=>{n.d(t,{Cq:()=>v,Dt:()=>m,JC:()=>y,Rj:()=>f,Sf:()=>p,b:()=>_,gZ:()=>c,w2:()=>h,xZ:()=>g});var i=n(76460),r=n(87663),s=n(50346),o=n(41289),a=n(25647),l=n(31933),u=n(5874);const d=()=>i.A.getLogger("esri.editing.templateUtils");function c(e){return null!=e&&"prototype"in e}function f(e){return h(e)&&!("definition"in e)}function p(e){return h(e)&&"definition"in e}function h(e){return null!=e&&"templateId"in e}function v(e){return p(e)&&"feature"===e?.type&&(null==e.definition||(0,a.sC)(e.definition))}function m(e){return p(e)&&"group"===e?.type&&(null==e.definition||(0,a.Xc)(e.definition))}function y(e){return p(e)&&"preset"===e?.type&&(null==e.definition||(0,a.vf)(e.definition))}function g(e){return p(e)&&null!=e?.definition}const w=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]];async function _(e,t,n){if(null==t)return e.map((e=>({layer:e,templates:w(e)})));const i=await async function(e,t){const n=await(0,u.Z)(t).load(),i=new Set;for(const r of e)(0,o.kb)(i,S(n,r));return await Promise.all(Array.from(i).map((e=>e.featureService.load()))),i}(e,t);(0,s.throwIfAborted)(n);const a=new Map,c=Array.from(i).map((e=>async function(e){let{serviceInfo:t,out:n,signal:i}=e;const{featureService:o,layersAndTables:a}=t,u=await async function(e){let{featureService:t,layers:n,signal:i}=e;if(!t.capabilities?.editing.supportsSharedTemplates)return new Map;const s=new Map(n.map((e=>[e.layerId,e]))),o=await t.querySharedTemplates({query:{layers:Array.from(s.keys())},requestOptions:{signal:i}}),a=new Map;for(const l of o)for(const e of l.layerIds)s.has(e)&&(0,r.tE)(a,s.get(e),(()=>[])).push(l);return a}({featureService:o,layers:a.toArray(),signal:i});(0,s.throwIfAborted)(i);for(const[r,s]of u.entries())if(0!==s.length)if((0,l.F2)(r)){const e=b(s),t=[],i=e.get(1/0)??t;for(const s of r.sublayers){const r=e.get(s.subtypeCode)??t;n.set(s,[...r,...i])}}else n.set(r,s)}({serviceInfo:e,out:a,signal:n,view:t}))),f=await Promise.allSettled(c);for(const r of f.filter((e=>"rejected"===e.status)))d().warn("Failed to fetch shared templates for service. Will use standard templates if available.",r.reason);return e.map((e=>({layer:e,templates:a.get(e)??w(e)})))}function S(e,t){return(0,l.Sv)(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):(0,l.yZ)(t)?e.tablesAndLayersLookup.get(t):null}function b(e){const t=new Map;for(const n of e)(0,r.tE)(t,n.subtypeCode??1/0,(()=>[])).push(n);return t}},5874:(e,t,n)=>{n.d(t,{Z:()=>E});var i=n(35143),r=n(55171),s=n(19276),o=n(50076),a=n(54099),l=n(49304),u=n(76460),d=n(87663),c=n(91291),f=n(50346),p=n(67993),h=n(68134),v=n(90534),m=n(46053),y=(n(81806),n(47249),n(85842)),g=n(19451),w=n(13096),_=n(31933),S=n(24883),b=n(96422),T=n(8163),A=n(91967);let I=class extends A.default{constructor(e){super(e),this.layers=new s.default,this.lockType="none",this.tables=new s.default,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new s.default([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}};(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"canCreateVersion",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"canEditVersionedData",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"featureService",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"layers",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"layersAndTables",null),(0,i._)([(0,m.MZ)()],I.prototype,"lockType",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"tables",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"versionInfo",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],I.prototype,"versionService",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"hasAdvancedEditingUserTypeExtension",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"loggedInServiceUser",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"featureServiceVersion",null),I=(0,i._)([(0,y.$)("esri.undoredo.support.ServiceVersionInfo")],I);var M=n(54265);const Z=new Map;function E(e){return(0,d.tE)(Z,e,(()=>{const t=new F({view:e});return e.addHandles({remove(){Z.delete(e),t.destroy()}}),t.load().catch((e=>{u.A.getLogger("esri.views.Services").error("Failed to load service metadata",e)})),t}))}let F=class extends(l.A.LoadableMixin(c.A.EsriPromiseMixin(a.A.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new g.U,this.items=new s.default,this.tablesAndLayersLookup=new p.A,this.additionalLayers=new s.default,this._debouncedCheckAndUpdateServiceInfos=(0,f.debounce)((async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const n=t.layersAndTables.getItemAt(0);n?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await(0,h.whenOnce)((()=>!this.updating)),await this._updateVersionInfos(e))})),this._debouncedLayersChanged=(0,f.debounce)((async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await(0,h.whenOnce)((()=>!this._updatingHandles.updating)),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const i of e)if("feature"===i.type||"subtype-group"===i.type){if(!i.url)continue;const e=(0,w.qg)(i.url).url.path,r=this._findServiceInfo(e);if(r)this.tablesAndLayersLookup.set(i,r),i.isTable?r.tables.push(i):r.layers.push(i);else if(!t.has(e))try{await this._addServiceInfo(e,i)}catch(n){u.A.getLogger(this).error(`Failed to load feature service: ${e}`,n)}finally{t.add(e)}}})()))})),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return(0,f.throwIfAborted)(e),this.addHandles([(0,h.watch)((()=>this._allLayersAndTables),(()=>{this._debouncedLayersChanged().catch((e=>{u.A.getLogger(this).warn("Failed to update service info",e)}))})),(0,h.watch)((()=>this.items.map((e=>e.layersAndTables.map((e=>e.gdbVersion??"")).join(",")))),(()=>{this.checkAndUpdateServiceInfos().catch((e=>{u.A.getLogger(this).warn("Failed to update service info",e)}))}))]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,n)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,n=this._findServiceInfo(t);if(!n?.versionService)throw new o.default("services:no-version-management-service");const i=n.hasAdvancedEditingUserTypeExtension,r=n.loggedInServiceUser.toUpperCase(),s=function(e){return!e||0===e.trim().length}(e.ownerName)?r:e.ownerName?.trim().toUpperCase();if(s!==r){if(n.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i)throw new o.default("services:no-advanced-editing-user-type-extension")}if("SDE"===s?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new o.default("services:no-valid-version-name");{const t=await n.versionService.getVersionInfos();if(t?.find((t=>t.versionIdentifier.name.toUpperCase()===(s+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(r+"."+e.versionName).toUpperCase())))throw new o.default("services:no-valid-version-name")}const a=await n.versionService.createVersion({versionName:e.versionName,access:s!==r?"public":e.access,description:e.description});if(s!==r){const{guid:t,name:i}=a.versionIdentifier;await n.versionService.alterVersion({guid:t,name:i},{ownerName:s,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:n.versionService})})())}deleteVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");if(i.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const r={name:t,guid:n};await i.versionService.deleteVersion(r)&&(await this._updateVersionInfo(i),this.emit("version-deleted",{versionIdentifier:r,versionManagementService:i.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new o.default("services:no-version-management-service");if(!t.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const n=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let i=!0;("none"!==t.versionService.getLockType(n)||(i=await t.versionService.startReading(n),i))&&(i=await t.versionService.startEditing(n),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const n=this._findServiceInfo(e);if(!n?.versionService)throw new o.default("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const i=n.versionInfo?.versionIdentifier??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid},r=n.versionService.getLockType(i);if("none"!==r)return"read"===r?(await n.versionService.stopReading(i),void n.updateLockType()):"edit"===r?(await n.versionService.stopEditing(i,t),await n.versionService.stopReading(i),void n.updateLockType()):void 0})())}async _changeVersionInternal(e,t,n){const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");const r=i.versionInfo?.versionIdentifier??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},s={name:t,guid:n};await i.versionService.changeVersion(this.view?.map,r,s)&&await this._updateVersionInfo(i)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const n=e.layersAndTables.getItemAt(0)?.gdbVersion,i=n?await t.getVersionIdentifierFromName(n):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(i)}_findServiceInfo(e){return this.items.find((t=>t.featureService.url===e))??null}_removeFeatureService(e){this.items.remove(e)}async _findPortal(e){const t=r.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const n=`${t.owningSystemUrl}/sharing/rest`,i=S.default.getDefault();return i?.loaded&&(0,v.normalize)(i.restUrl)===(0,v.normalize)(n)?i:new S.default({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch((e=>{u.A.getLogger(this).error("Failed to update version details",e)}))})())}async _addServiceInfo(e,t){const n=new T.default({url:e});await n.load();const i=await this._findPortal(e),r=i?.user?.username;let o=!1;r&&(o=await(0,b.RE)(i,r,"advediting"));let a=null;n.versionManagementServiceUrl&&(a=new M.default({url:n.versionManagementServiceUrl}),await a.load());const l=t.isTable?[]:[t],u=t.isTable?[t]:[],d=new I({loggedInServiceUser:r??"",hasAdvancedEditingUserTypeExtension:o,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:n,versionService:a,layers:new s.default(l),tables:new s.default(u)});return a&&await this._updateVersionInfo(d),this.items.push(d),this.tablesAndLayersLookup.set(t,d),t.isTable?d.tables.push(t):d.layers.push(t),d}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const n of e)"feature"!==n.type&&"subtype-group"!==n.type||this._processed.has(n)||t.push(n);for(const n of this._processed)if(!e.has(n)&&((0,_.F2)(n)||(0,_.yZ)(n))){const e=this.tablesAndLayersLookup.get(n);if(!e)continue;this.tablesAndLayersLookup.delete(n),n.isTable?e.tables.remove(n):e.layers.remove(n),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}};(0,i._)([(0,m.MZ)({constructOnly:!0})],F.prototype,"view",void 0),(0,i._)([(0,m.MZ)()],F.prototype,"items",void 0),(0,i._)([(0,m.MZ)()],F.prototype,"tablesAndLayersLookup",void 0),(0,i._)([(0,m.MZ)()],F.prototype,"additionalLayers",void 0),(0,i._)([(0,m.MZ)()],F.prototype,"updating",null),(0,i._)([(0,m.MZ)()],F.prototype,"_allLayersAndTables",null),F=(0,i._)([(0,y.$)("esri.undoredo.support.Services")],F)},20639:(e,t,n)=>{n.d(t,{Ng:()=>T,OM:()=>y,Q0:()=>_,T8:()=>w,ZP:()=>b,ZT:()=>S,eX:()=>M,fD:()=>F,fb:()=>h,fl:()=>p,iP:()=>E,oh:()=>A,rX:()=>L,sH:()=>v,yk:()=>O});n(11265),n(81806);var i=n(50076),r=n(15941),s=n(65256),o=n(96017),a=n(85632),l=n(36693),u=n(24241),d=n(38042);const c=l.n$,f={date:null,time:null,timeZoneOffset:null},p=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),h="latn",v=new Set(["date-only","time-only","timestamp-offset"]),m=e=>"valueAsDate"in e;function y(e){return{locale:(0,d.JK)(),numberingSystem:h,zone:e??c}}function g(e,t){return null==e?null:u.c9.fromMillis(e,y(t))}function w(e,t){if(null==e||!(0,a.Kg)(e)||""===e){if(t){const e=u.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return f}const n=u.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(o.mo,y()),time:n.toFormat(o.Uq.HMS_MS,y()),timeZoneOffset:n.offset.toString()}}function _(e,t){if(null==e||!(0,a.Et)(e)||isNaN(e))return f;const n=g(e,t);return n?{date:n.toFormat(o.mo,y(t)),time:n.toFormat(o.Fj,y(t))}:f}function S(e){switch(e.type){case"date":default:return(0,s.J2)("short-date-short-time");case"date-only":return(0,s.J2)("short-date");case"time-only":return(0,s.J2)("short-time");case"timestamp-offset":return{...(0,s.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function b(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,s.Yq)(t,n);case"date-only":return(0,s.iS)(t,n);case"time-only":return(0,s.F8)(t,n);case"timestamp-offset":return(0,s.Ey)(t,n);default:return null}}function T(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:i,timeZoneComponent:r,oldValue:s}=e;if(!t?.value)return null;const{year:a,month:d,day:c}=u.c9.fromFormat(t.value,o.mo),{hour:f,minute:p,second:h,millisecond:v}=I(i,l.n$)??u.c9.now(),m=w(s,n),y=r?.value?parseInt(r.value,10):null!=m.timeZoneOffset?parseInt(m.timeZoneOffset,10):(new Date).getTimezoneOffset(),g=u.mQ.instance(y),_=u.c9.fromObject({year:a,month:d,day:c,hour:f,minute:p,second:h,millisecond:v},{zone:g});return _.isValid?_.toISO({includeOffset:!0}):null}function A(e){const{dateComponent:t,timeComponent:n,timeZone:i,max:r,min:s,oldValue:o}=e,a=I(t,i);let l=!!e.applyRange;if(!a)return null;let d=null;if(null!=n?.value){const e=I(n,i),t=Date.now(),s=null!=r&&r<t?r:t,o=u.c9.fromMillis(s,y(i)),l=a||o,{year:c,month:f,day:p}=l,{hour:h,minute:v,second:m,millisecond:g}=e||o;d=l.set({year:c,month:f,day:p,hour:h,minute:v,second:m,millisecond:g})}else{const e=g(Z({value:o??Date.now(),max:r,min:s}),i),{year:t,month:n,day:u}=a,{hour:c,minute:f,second:p,millisecond:h}=e;l=!0,d=a.set({year:t,month:n,day:u,hour:c,minute:f,second:p,millisecond:h})}if(!d.isValid)return null;const c=d.toMillis();return l?Z({value:c,max:r,min:s}):c}function I(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=m(e)?u.c9.fromFormat(e.value,o.mo,y(t)):(0,o.UE)(e.value),n?.isValid?n:null}function M(e){const{max:t,min:n,value:i}=e;return!isNaN(i)&&!(null!=t&&i>t)&&!(null!=n&&i<n)}function Z(e){const{max:t,min:n,value:i}=e;return null!=t&&null!=n?(0,r.qE)(i,n,t):null!=t&&i>t?t:null!=n&&i<n?n:i}function E(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new i.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),r=new Array(3);for(let i=0;i<3;i++){const e=n.at(i)??"";r[i]=e.padStart(2,"0")}return r.join(":")}function F(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return E(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function L(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function O(e){const{type:t,range:n,value:i}=e;if(null==i||!n||i===n.min||i===n.max)return!0;if("date"===t)return M({value:i,min:n.min,max:n.max});const{rawMax:r,rawMin:s}=n;let a=null,l=null,u=null;switch(t){case"date-only":a=(0,o.Xi)(r),l=(0,o.Xi)(s),u=(0,o.Xi)(i);break;case"time-only":a=(0,o.UE)(r),l=(0,o.UE)(s),u=(0,o.UE)(i);break;case"timestamp-offset":a=(0,o.gz)(r),l=(0,o.gz)(s),u=(0,o.gz)(i)}return!u||M({value:u.valueOf(),min:l?.valueOf(),max:a?.valueOf()})}},23301:(e,t,n)=>{n.d(t,{$$:()=>S,D_:()=>f,Gd:()=>c,Kx:()=>i,PA:()=>y,Po:()=>p,Qv:()=>g,gK:()=>r,hQ:()=>_,jl:()=>v,of:()=>d,qn:()=>w,zU:()=>h});var i,r,s,o=n(71764),a=n(15142),l=n(53430),u=n(20639);(s=i||(i={})).Text="text",s.Number="number",s.Date="date",s.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(r||(r={}));const d=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function c(e,t){const{dataType:n,domain:i,field:s,maxLength:o,minLength:d,range:c,required:f}=t;if(null==e)return f?r.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(d>-1&&e.length<d)return r.TOO_SHORT;if(o>-1&&e.length>o)return r.TOO_LONG}return"date"!==n||(0,u.yk)({type:s.type,range:c,value:e})?i?(0,a.wb)(s,e,i):(0,l.validateFieldValue)(s,e)??(0,a.wb)(s,e):l.NumericRangeValidationError.OUT_OF_RANGE}function f(e,t){return!(!p(e)||!p(t))||e===t}function p(e){return null==e||""===e}function h(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;const s=m(n.length);if(!r||!(0,o.AI)(r))return s;const a=m(r.maxLength);return-1===a?s:-1===s?a:Math.min(s,a)}function v(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;if(!r||!(0,o.AI)(r))return-1;const s=m(r.minLength);if(s<0)return-1;const a=m(n.length);return a>-1&&a<s?-1:s}function m(e){return"number"==typeof e&&e>-1?e:-1}const y={type:"number"},g={type:"number",intlOptions:{notation:"scientific"}};function w(e){return e>=1e7||e<=-1e7}function _(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const S=e=>e&&!Number.isNaN(e.valueOf())},25647:(e,t,n)=>{function i(e){return"feature"===e.type}function r(e){return"group"===e.type}function s(e){return"preset"===e.type}n.d(t,{Xc:()=>r,sC:()=>i,vf:()=>s})},48594:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var i=n(35143),r=n(91967),s=n(19276),o=n(76460),a=n(67993),l=n(46053),u=(n(81806),n(47249),n(85842)),d=n(5600),c=n(79256);let f=class extends r.default{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new a.A}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&(0,d.w2)(this.fullTemplate)}get pendingFeatures(){return new s.default([...this._pendingEdits.keys()])}set selectedPendingFeature(e){this._set("selectedPendingFeature",e),this.temporaryHighlightFeature=null}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach((t=>{t.timeZone=e}))}isSubmittable(e){const t=this._pendingEdits.get(e);return!!t?.submittable||!!t?.isAssociation}isDisplayable(e){return!this._pendingEdits.get(e)?.isAssociation}addPendingFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAssociation:!1};this.temporaryHighlightFeature=null;const{_pendingEdits:i}=this;if(i.has(e))return i.get(e);e.sourceLayer||o.A.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData").warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const r=new c.default({feature:e,isAssociation:n.isAssociation});return r.trackChanges(t),i.set(e,r),r}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){this.temporaryHighlightFeature=null;const{_pendingEdits:t}=this,n=t.get(e);n&&(n.destroy(),t.delete(e)),this.selectedPendingFeature===e&&(this.selectedPendingFeature=null)}getFeatureTitle(e){return this._pendingEdits.get(e)?.displayTitle}};(0,i._)([(0,l.MZ)()],f.prototype,"creationInfo",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"editorItem",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"fullTemplate",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"isSharedTemplateWorkflow",null),(0,i._)([(0,l.MZ)()],f.prototype,"parent",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"pendingFeatures",null),(0,i._)([(0,l.MZ)()],f.prototype,"selectedPendingFeature",null),(0,i._)([(0,l.MZ)()],f.prototype,"temporaryHighlightFeature",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"templateExecutorInfo",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"viewModel",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"upload",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"timeZone",null),f=(0,i._)([(0,u.$)("esri.widgets.Editor.CreateFeaturesWorkflowData")],f);const p=f},79256:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var i=n(35143),r=n(91967),s=n(50346),o=n(46053),a=(n(81806),n(76460),n(47249),n(85842)),l=n(41289),u=n(23301);let d=class extends r.default{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=(0,s.debounce)(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){return!function(e,t){const n=e??{},i=t??{},r=new Set(Object.keys(n));(0,l.FB)(r,Object.keys(i));for(const s of r){const e=n[s],t=i[s];if(!(0,u.D_)(e,t))return!1}return!0}(this.initialFeature?.attributes,this.feature?.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(e){this._set("timeZone",e),(0,s.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.feature;this.initialFeature=e?.clone(),(0,s.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified")),(0,s.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const t=e?.geometry;return function(e){return null==e?null:JSON.stringify(e)}("mesh"===t?.type?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}async _refreshDisplayTitle(e){const t=this.feature,n=t?.sourceLayer;if(!n||!("getFeatureTitle"in n))return;const i=await n.getFeatureTitle(t,{fetchMissingFields:!1,timeZone:this.timeZone});e.aborted||(this.displayTitle=""===i?null:i)}};(0,i._)([(0,o.MZ)()],d.prototype,"_stagedForDelete",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"attributesModified",null),(0,i._)([(0,o.MZ)()],d.prototype,"feature",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"geometryModified",null),(0,i._)([(0,o.MZ)()],d.prototype,"initialFeature",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"modified",null),(0,i._)([(0,o.MZ)()],d.prototype,"submittable",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"displayTitle",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"isAssociation",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"timeZone",null),d=(0,i._)([(0,a.$)("esri.widgets.Editor.Edits")],d);const c=d},96422:(e,t,n)=>{n.d(t,{Kw:()=>s,RE:()=>a,Sl:()=>o});var i=n(55171),r=n(3825);async function s(e,t,n){const s=i.id?.findCredential(e.restUrl);if(!s)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const o={responseType:"json",query:{f:"json"}};if(n&&(o.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,r.default)(e.restUrl+"/community/self",o);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await(0,r.default)(e.restUrl+"/community/users/"+t,o);if(a.data){const e=a.data;return e.error?null:e}return null}async function o(e,t,n){const i=await s(e,t,!0);return i?.privileges?.includes(n)??!1}async function a(e,t,n){const i=await s(e,t,!0);return i?.userLicenseTypeExtensions?.includes(n)??!1}}}]);
//# sourceMappingURL=48594.d2bbaca3.chunk.js.map