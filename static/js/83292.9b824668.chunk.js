"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[83292],{35969:(e,t,i)=>{var s;i.d(t,{k:()=>s}),function(e){e.Continuous="continuous",e.Hourly="hourly"}(s||(s={}))},47272:(e,t,i)=>{var s;i.d(t,{H:()=>s}),function(e){e.Disabled="disabled",e.Ready="ready"}(s||(s={}))},50964:(e,t,i)=>{var s;i.d(t,{J:()=>s}),function(e){e.Threshold="threshold",e.Duration="duration",e.Discrete="discrete"}(s||(s={}));s.Threshold,s.Duration,s.Discrete},71587:(e,t,i)=>{function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e>=t)return i;if(i.push(e),t-e<2)return i;const s=t-1;i.push(s);const o=n(e+1,s);for(;;){const e=o.next();if(e.done)break;i.push(e.value)}return i}function*n(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const s=n(e,i),o=n(i+1,t);for(;;){const e=s.next(),t=o.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}i.d(t,{s:()=>s})},79468:(e,t,i)=>{function s(e,t,i,s){let n=null,o=1e3;"number"==typeof t?(o=t,s=i):(n=t??null,o=i);let r,a=0;const l=()=>{a=0,e.apply(s,r)},d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n.apply(s,t),r=t,o?a||(a=setTimeout(l,o)):l()};return d.remove=()=>{a&&(clearTimeout(a),a=0)},d.forceUpdate=()=>{a&&(clearTimeout(a),l())},d.hasPendingUpdates=()=>!!a,d}i.d(t,{n:()=>s})},83292:(e,t,i)=>{i.r(t),i.d(t,{default:()=>$});var s=i(35143),n=i(69539),o=i(91967),r=i(18690),a=i(98773),l=(i(81806),i(30726)),d=i(50346),u=i(68134),c=i(76931),h=i(18288),p=i(46053),_=(i(76460),i(85842)),m=i(9392),v=i(3136),f=i(30338),y=i(50578),w=i(19276),g=i(3975);i(47249);let T=class extends o.default{constructor(){super({}),this.color=new n.default([50,50,50,.7]),this.intervalOptions=new w.default([(0,h.t)(15,"minutes","milliseconds"),(0,h.t)(30,"minutes","milliseconds"),(0,h.t)(1,"hours","milliseconds"),(0,h.t)(2,"hours","milliseconds"),(0,h.t)(3,"hours","milliseconds")]),this.interval=this.intervalOptions.at(0)}set intervalOptions(e){this._set("intervalOptions",(0,g.V)(e,this._get("intervalOptions")))}};(0,s._)([(0,p.MZ)({type:n.default})],T.prototype,"color",void 0),(0,s._)([(0,p.MZ)()],T.prototype,"interval",void 0),(0,s._)([(0,p.MZ)({type:w.default})],T.prototype,"intervalOptions",null),T=(0,s._)([(0,_.$)("esri.widgets.ShadowCast.DiscreteOptions")],T);const M=T;var D=i(35969);let P=class extends o.default{constructor(){super(...arguments),this.color=new n.default([0,0,255,.7]),this.mode=D.k.Continuous}};(0,s._)([(0,p.MZ)({type:n.default})],P.prototype,"color",void 0),(0,s._)([(0,p.MZ)()],P.prototype,"mode",void 0),P=(0,s._)([(0,_.$)("esri.widgets.ShadowCast.DurationOptions")],P);const Z=P;var b,O,C=i(47272),A=i(54901),k=i(79468);(O=b||(b={})).PointerMove="pointer-move",O.Main="main";let z=class extends o.default{constructor(e){super(e),this._screenPoint=null,this._accumulatedShadowTime=null,this._shadowTimeTask=null,this._updateAccumulatedShadowTime=(e,t)=>{this._shadowTimeTask=(0,l.DC)(this._shadowTimeTask),this._shadowTimeTask=(0,a.UT)((async i=>{const{results:s,ground:n}=await e.hitTest(t);if((0,d.throwIfAborted)(i),0===s.length&&!n.mapPoint)return void(this._accumulatedShadowTime=null);const o=await this.getDuration(t,i);this._accumulatedShadowTime=o}))},this._throttledUpdateAccumulatedShadowTime=(0,k.n)(this._updateAccumulatedShadowTime,300)}initialize(){this.addHandles((0,u.watch)((()=>({enabled:this.enabled,view:this.view})),(e=>{let{enabled:t,view:i}=e;t&&null!=i?this._startTracking(i):this._stopTracking()}),u.syncAndInitial))}get screenPoint(){return this.enabled?this._screenPoint:null}get accumulatedShadowTime(){return this.enabled?this._accumulatedShadowTime:null}get testData(){}_startTracking(e){if(this.hasHandles(b.Main))return;const t=()=>{this.hasHandles(b.PointerMove)||this.addHandles(e.on("pointer-move",(t=>{const i=(0,c.tc)(t.x,t.y);this._screenPoint=i,this._throttledUpdateAccumulatedShadowTime(e,i)})),b.PointerMove)},i=()=>{this.removeHandles(b.PointerMove),this._screenPoint=null,this._accumulatedShadowTime=null};this.addHandles([this._throttledUpdateAccumulatedShadowTime,e.on("pointer-enter",t),e.on("pointer-leave",i),e.on("pointer-down",i),e.on("pointer-drag",i),e.on("pointer-up",t),e.on("click",(t=>{const i=(0,c.tc)(t.x,t.y);this._screenPoint=i,this._updateAccumulatedShadowTime(e,i)})),(0,A.hA)((()=>{this._shadowTimeTask=(0,l.DC)(this._shadowTimeTask)}))],b.Main),t()}_stopTracking(){this.removeHandles(b.Main)}};(0,s._)([(0,p.MZ)()],z.prototype,"getDuration",void 0),(0,s._)([(0,p.MZ)()],z.prototype,"view",void 0),(0,s._)([(0,p.MZ)()],z.prototype,"enabled",void 0),(0,s._)([(0,p.MZ)()],z.prototype,"screenPoint",null),(0,s._)([(0,p.MZ)()],z.prototype,"accumulatedShadowTime",null),(0,s._)([(0,p.MZ)()],z.prototype,"_screenPoint",void 0),(0,s._)([(0,p.MZ)()],z.prototype,"_accumulatedShadowTime",void 0),(0,s._)([(0,p.MZ)()],z.prototype,"_shadowTimeTask",void 0),z=(0,s._)([(0,_.$)("esri.widgets.ShadowCast.ShadowTooltipViewModel")],z);var S=i(50964);let U=class extends o.default{constructor(){super(...arguments),this.color=new n.default([255,0,0,.7]),this.value=(0,h.t)(4,"hours","milliseconds"),this.minValue=0,this.maxValue=(0,h.t)(8,"hours","milliseconds")}};(0,s._)([(0,p.MZ)({type:n.default})],U.prototype,"color",void 0),(0,s._)([(0,p.MZ)()],U.prototype,"value",void 0),(0,s._)([(0,p.MZ)()],U.prototype,"minValue",void 0),(0,s._)([(0,p.MZ)()],U.prototype,"maxValue",void 0),U=(0,s._)([(0,_.$)("esri.widgets.ShadowCast.ThresholdOptions")],U);const V=U;var x=i(71587);const H=[],R=(0,m.vt)(),E=[],I=(0,h.t)(1,"hours","milliseconds");let J=class extends o.default{constructor(e){super(e),this.view=null,this.tooltip=new z({getDuration:(e,t)=>this.getDuration(e,t)}),this.startTimeOfDay=(0,h.t)(10,"hours","milliseconds"),this.endTimeOfDay=(0,h.t)(16,"hours","milliseconds"),this.visualizationType=S.J.Threshold,this.thresholdOptions=new V,this.durationOptions=new Z,this.discreteOptions=new M,this._running=!0,this._stopPreviewingTask=null,this._forcePreview=!1,this._autoRestoreForcePreviewEnabled=!0,this._utcOffset=null,this.date=new Date}initialize(){this.addHandles([(0,u.watch)((()=>({view:this.view,tooltipEnabled:this._tooltipEnabled})),(e=>{let{view:t,tooltipEnabled:i}=e;this.tooltip.view=t,this.tooltip.enabled=i}),u.syncAndInitial),(0,u.watch)((()=>this._forcePreviewDependencies),(()=>{(0,l.DC)(this._stopPreviewingTask),this._forcePreview=!0,this._autoRestoreForcePreviewEnabled&&(this._stopPreviewingTask=(0,a.UT)((async e=>{await(0,d.after)(500,e),(0,d.throwIfAborted)(e),this._forcePreview=!1})))}),u.syncAndInitial),(0,u.watch)((()=>({renderer:this.renderer,parameters:this._visualizationParameters})),(e=>N(e.renderer,e.parameters)),u.syncAndInitial),(0,u.watch)((()=>({renderer:this.renderer,parameters:{lightDirections:this._lightDirections}})),(e=>N(e.renderer,e.parameters)),u.syncAndInitial),(0,u.watch)((()=>({renderer:this.renderer,parameters:{enabled:this._running}})),(e=>N(e.renderer,e.parameters)),u.syncAndInitial),(0,u.watch)((()=>({renderer:this.renderer,parameters:{previewing:this._previewing}})),(e=>N(e.renderer,e.parameters)),u.syncAndInitial)])}destroy(){this.stop(),N(this.renderer,{enabled:!1}),(0,l.pR)(this.tooltip)}get state(){return null!=this.view&&this.view.ready&&null!=this._referencePosition?C.H.Ready:C.H.Disabled}set date(e){const t=new Date(e);t.setHours(0,0,0,0),this._set("date",t)}get utcOffset(){return this._utcOffset??this._utcOffsetAuto}set utcOffset(e){this._utcOffset=e}get testData(){}get _previewing(){const{view:e}=this;return null==e?.allLayerViews||this._forcePreview||!e.stationary||e.allLayerViews.some((e=>G(e)&&e.updating))}get _utcOffsetAuto(){const e=this._referencePosition;return null!=e?(0,v.uu)(e[0],!1):0}get _dateUTCOffset(){let e=this.date;return e=(0,h.mi)(e,-e.getTimezoneOffset(),"minutes"),e=(0,h.mi)(e,-this.utcOffset,"hours"),e}get _startDateTimeUTC(){return(0,h.mi)(this._dateUTCOffset,this.startTimeOfDay)}get _endDateTimeUTC(){return(0,h.mi)(this._dateUTCOffset,this.endTimeOfDay)}get _referencePosition(){return this.view?.environmentManager?.referencePositionGeographic}get _interval(){const e=this._duration>0?Math.floor(this._duration/255):255,t=this.discreteOptions.interval;switch(this.visualizationType){case S.J.Threshold:case S.J.Duration:return e;case S.J.Discrete:return t>0?t:e}}get _sampleCount(){return this._lightDirections.length}get _duration(){return this.endTimeOfDay-this.startTimeOfDay}get _lightDirections(){const{view:e}=this;if(null==e)return H;const t="global"===e.viewingMode?R:this._referencePosition;if(null==t)return H;const i=this._interval,s=(0,f.ld)(this._startDateTimeUTC,this._endDateTimeUTC,i,t,e.state.viewingMode),n=s.length;E.length=0;const o=(0,x.s)(0,n,E),r=new Array(n);for(let a=0;a<n;++a)r[a]=s[o[a]];return r}get _tooltipEnabled(){return this.state===C.H.Ready&&this.visualizationType!==S.J.Discrete&&this._running&&!this._previewing}get _visualizationParameters(){if(!this._running)return null;switch(this.visualizationType){case S.J.Threshold:return this._thresholdVisualizationParameters;case S.J.Duration:return this._durationVisualizationParameters;case S.J.Discrete:return this._discreteVisualizationParameters}}get _thresholdVisualizationParameters(){const{value:e,color:t}=this.thresholdOptions,i=this._duration;return{visualization:y.o.Threshold,color:n.default.toUnitRGBA(t),threshold:i>0?e/this._duration:0}}get _durationVisualizationParameters(){const{color:e,mode:t}=this.durationOptions,i=this._duration,s=i>0&&t===D.k.Hourly?I/i:0;return{color:n.default.toUnitRGBA(e),visualization:y.o.Gradient,bandsEnabled:s>0,bandSize:s}}get _discreteVisualizationParameters(){return{color:n.default.toUnitRGBA(this.discreteOptions.color),visualization:y.o.Gradient,bandsEnabled:!1,bandSize:0}}get _forcePreviewDependencies(){const{view:e}=this;if(null==e)return null;const t=e.slicePlane,i=e.allLayerViews.toArray().filter(G),s=i.map((e=>e.layer)).filter(r.Ru),n=i.map((e=>e.visible)),o=s.map((e=>e.visible)),a=s.map((e=>e.opacity)),l=s.filter((e=>"definitionExpression"in e)).map((e=>e.definitionExpression)),d=i.filter((e=>"filter"in e)).map((e=>e.filter));return{slicePlane:t,startDateUTC:this._startDateTimeUTC,endDateUTC:this._endDateTimeUTC,layerViewVisibilities:n,layerVisibilities:o,layerOpacities:a,filters:d,definitionExpressions:l}}get renderer(){const{view:e}=this;if(null==e)return null;const t=e._stage;return null==t?null:t.renderer}start(){this.setRunning(!0)}stop(){this.setRunning(!1)}setRunning(e){this._running=e}async getDuration(e,t){const{view:i,renderer:s,_sampleCount:n}=this;if(null==i||null==s||0===n)return 0;const o=i.state.camera.screenToRender((0,c.gs)(e.x,e.y),(0,c.QG)());return s.readAccumulatedShadow(o)*this._duration}};function N(e,t){null!=e&&null!=t&&e.setParameters({shadowCast:t})}function G(e){if(e.suspended)return!1;switch(e.type){case"building-scene-3d":case"csv-3d":case"elevation-3d":case"feature-3d":case"geojson-3d":case"graphics-3d":case"integrated-mesh-3d":case"integrated-mesh-3dtiles":case"ogc-feature-3d":case"route-3d":case"scene-layer-3d":case"scene-layer-graphics-3d":case"stream-3d":case"wms-3d":return!0;case"base-dynamic-3d":case"catalog-3d":case"catalog-footprint-3d":case"catalog-dynamic-group-3d":case"dimension-3d":case"imagery-3d":case"imagery-tile-3d":case"line-of-sight-3d":case"map-image-3d":case"point-cloud-3d":case"tile-3d":case"vector-tile-3d":case"viewshed-3d":case"voxel-3d":case"wfs-3d":case"wmts-3d":case"media-3d":default:return!1;case"group":return e.layerViews.toArray().some((e=>G(e)))}}(0,s._)([(0,p.MZ)()],J.prototype,"state",null),(0,s._)([(0,p.MZ)()],J.prototype,"view",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"tooltip",void 0),(0,s._)([(0,p.MZ)({type:Date,nonNullable:!0})],J.prototype,"date",null),(0,s._)([(0,p.MZ)({nonNullable:!0})],J.prototype,"utcOffset",null),(0,s._)([(0,p.MZ)({nonNullable:!0})],J.prototype,"startTimeOfDay",void 0),(0,s._)([(0,p.MZ)({nonNullable:!0})],J.prototype,"endTimeOfDay",void 0),(0,s._)([(0,p.MZ)({nonNullable:!0})],J.prototype,"visualizationType",void 0),(0,s._)([(0,p.MZ)({type:V,nonNullable:!0})],J.prototype,"thresholdOptions",void 0),(0,s._)([(0,p.MZ)({type:Z,nonNullable:!0})],J.prototype,"durationOptions",void 0),(0,s._)([(0,p.MZ)({type:M,nonNullable:!0})],J.prototype,"discreteOptions",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_running",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_stopPreviewingTask",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_forcePreview",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_autoRestoreForcePreviewEnabled",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_previewing",null),(0,s._)([(0,p.MZ)()],J.prototype,"_utcOffset",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"_utcOffsetAuto",null),(0,s._)([(0,p.MZ)()],J.prototype,"_dateUTCOffset",null),(0,s._)([(0,p.MZ)()],J.prototype,"_startDateTimeUTC",null),(0,s._)([(0,p.MZ)()],J.prototype,"_endDateTimeUTC",null),(0,s._)([(0,p.MZ)()],J.prototype,"_referencePosition",null),(0,s._)([(0,p.MZ)()],J.prototype,"_interval",null),(0,s._)([(0,p.MZ)()],J.prototype,"_sampleCount",null),(0,s._)([(0,p.MZ)()],J.prototype,"_duration",null),(0,s._)([(0,p.MZ)()],J.prototype,"_lightDirections",null),(0,s._)([(0,p.MZ)()],J.prototype,"_tooltipEnabled",null),(0,s._)([(0,p.MZ)()],J.prototype,"_visualizationParameters",null),(0,s._)([(0,p.MZ)()],J.prototype,"_thresholdVisualizationParameters",null),(0,s._)([(0,p.MZ)()],J.prototype,"_durationVisualizationParameters",null),(0,s._)([(0,p.MZ)()],J.prototype,"_discreteVisualizationParameters",null),(0,s._)([(0,p.MZ)()],J.prototype,"_forcePreviewDependencies",null),(0,s._)([(0,p.MZ)()],J.prototype,"renderer",null),J=(0,s._)([(0,_.$)("esri.widgets.ShadowCast.ShadowCastViewModel")],J);const $=J}}]);
//# sourceMappingURL=83292.9b824668.chunk.js.map