"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[2257,28866,98156],{2257:(e,t,n)=>{n.d(t,{D8:()=>r,TO:()=>a,d0:()=>l});var i=n(53430);async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.popupTemplate;if(null==t)return[];const n=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=t,{objectIdField:r,typeIdField:l,globalIdField:u,relationships:s}=e;if(n.includes("*"))return["*"];const o=a?(0,i.getFeatureEditFields)(e):[],c=(0,i.fixFields)(e.fieldsIndex,[...n,...o]);return l&&c.push(l),c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r),c&&u&&e.fieldsIndex?.has(u)&&!c.includes(u)&&c.push(u),s&&s.forEach((t=>{const{keyField:n}=t;c&&n&&e.fieldsIndex?.has(n)&&!c.includes(n)&&c.push(n)})),c}function r(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function l(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})}},28866:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(35143),a=n(39356),r=n(50076),l=n(46053),u=(n(81806),n(76460),n(47249),n(85842)),s=n(51939),o=n(43543),c=n(59844),f=n(2257);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return(0,o.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?(0,c.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!(0,c.eh)(this.layer.serviceRasterInfo,e)}catch{return!1}}async fetchPopupFeaturesAtLocation(e,t){const{layer:n}=this;if(!e)throw new r.default("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:n});const{popupEnabled:i}=n,l=(0,f.D8)(n,t);if(!i||null==l)return[];const u=[],{value:o,magdirValue:c,processedValue:d}=await n.identify(e,{timeExtent:this.timeExtent,signal:t?.signal});let m="";if(o?.length){m="imagery-tile"===n.type&&n.hasStandardTime()&&null!=o[0]?o.map((e=>n.getStandardTimeValue(e))).join(", "):o.join(", ");const e={ObjectId:0};e[s.F_.servicePixelValue]="imagery-tile"===n.type&&"Function"===n.raster.datasetFormat?d?.join(", "):m,e[s.F_.rawServicePixelValue]=m;const t=n.raster?.rasterInfo??n.serviceRasterInfo,i=t?.attributeTable;if(null!=i){const{fields:t,features:n}=i,a=t.find((e=>{let{name:t}=e;return"value"===t.toLowerCase()})),r=e[s.F_.servicePixelValue],l=a?n.find((e=>String(e.attributes[a.name])===r)):null;if(l)for(const i in l.attributes)l.attributes.hasOwnProperty(i)&&(e[s.ER+i]=l.attributes[i])}const r=t?.dataType;if("vector-magdir"!==r&&"vector-uv"!==r||(e[s.F_.magnitude]=c?.[0],e[s.F_.direction]=c?.[1]),"imagery-tile"===n.type){const{multidimensionalDefinition:t}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});(0,s.eS)(n.rasterFields,e,t)}const l=new a.default({geometry:this.fullExtent?.clone(),attributes:e,layer:n,sourceLayer:n});u.push(l)}return u}async getSourceScale(){return await this.layer.load(),(0,c.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return(0,c.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,i._)([(0,l.MZ)()],t.prototype,"fullExtent",null),(0,i._)([(0,l.MZ)()],t.prototype,"layer",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,i._)([(0,l.MZ)()],t.prototype,"tileInfo",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,i._)([(0,l.MZ)()],t.prototype,"datumTransformation",null),t=(0,i._)([(0,u.$)("esri.views.layers.ImageryTileLayerView")],t),t}},43543:(e,t,n)=>{n.d(t,{F:()=>a});var i=n(98156);function a(e,t,n){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:a=!1,timeOffset:r,useViewTime:l}=e;let u=e.timeExtent;a&&(u=(0,i.toLocalTimeExtent)(u));let s=l?t&&u?t.intersection(u):t||u:u;return!s||s.isEmpty||s.isAllTime?s:(r&&(s=s.offset(-r.value,r.unit)),a&&(s=(0,i.toUTCTimeExtent)(s)),s.equals(n)?n:s)}},51939:(e,t,n)=>{n.d(t,{AL:()=>v,DV:()=>h,ER:()=>a,F_:()=>u,Nd:()=>m,Oo:()=>r,dy:()=>d,eS:()=>E,h4:()=>b,jC:()=>g,nq:()=>p,rZ:()=>f,y6:()=>y});var i=n(44135);const a="Raster.",r="Raster.Dim.",l=".Max",u={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},s=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function o(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function c(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,type:"double"})}function f(e){return o(u.servicePixelValue,e??"Service Pixel Value")}function d(e){return o(u.rawServicePixelValue,e??"Raw Service Pixel Value")}function m(){return o(u.itemPixelValue,"Item Pixel Value")}function p(e){return o(`${u.servicePixelValue}.${e}`,e)}function h(e){return c(`${u.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function y(){return c(`${u.direction}`,"Direction (\xb0)")}function g(e){return e.fields.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name=`${a}${e.name}`,t}))}function v(e){const t=new Set,n=new Set,a=new Map;return e.variables.forEach((e=>{let{dimensions:i}=e;i.forEach((e=>{if(e.recurring)a.set(e.name,e.unit);else{const i="ISO8601"===e.unit?.trim()?t:n;i.add(e.name),e.hasRanges&&i.add(`${e.name}${l}`)}}))})),[o(u.variable,"Variable"),...[...t].map((e=>function(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,type:"date"})}(`${r}${e}`,w(e)))),...[...n].map((e=>c(`${r}${e}`,w(e)))),...[...a].map((e=>{let[t,n]=e;return c(`${r}${t}`,x(t,n))}))]}function x(e,t){return t=t?.toLowerCase(),t&&s.has(t)?s.get(t):w(e)}function w(e){const t=e.endsWith(l),n=t?e.slice(0,-4):e,i="StdTime"===n?"Standard Time":"StdZ"===n?"Standard Z":n;return t?`${i} Max`:i}function T(e,t){return t?new Date(e):e}function E(e,t,n){n?.length&&(t[u.variable]=n[0].variableName,n.forEach((n=>{let{dimensionName:i,values:a}=n;if(i&&a?.length){const n=`${r}${i}`,u=e.find((e=>{let{name:t}=e;return t===n}));if(!u)return;const s="date"===u.type,o=a[0];if(Array.isArray(o)){if(t[`${r}${i}`]=T(o[0],s),null!=o[1]){const n=`${r}${i}${l}`;if(e.some((e=>{let{name:t}=e;return t===n}))){const e=T(o[1],s);t[n]=e}}}else t[`${r}${i}`]=T(o,s)}})))}function b(e,t){if(t.pixelType.startsWith("f")&&e.forEach((e=>{let{format:t,fieldName:n}=e;t&&n&&/^raster\.(item|service)pixelvalue/i.test(n)&&(t.places=2)})),t.multidimensionalInfo){const n=t.multidimensionalInfo.variables.flatMap((e=>{let{dimensions:t}=e;return t}));e.forEach((e=>{let{format:t,fieldName:i}=e;if(t&&i?.startsWith(r)){const e=i.slice(r.length),a=`${e}${l}`,u=n.find((t=>{let{name:n}=t;return n===e||n===a}));u?.values?.every((e=>Number.isInteger(e)))&&(t.places=0)}}))}}},98156:(e,t,n)=>{n.r(t),n.d(t,{getTimeExtentFromLayers:()=>d,getTimeSliderSettingsFromWebDocument:()=>p,toLocalTimeExtent:()=>y,toUTCTimeExtent:()=>h});var i=n(18690),a=n(53084),r=n(18288),l=n(59187),u=n(42052),s=n(72027);function o(e){return void 0!==e.timeInfo}async function c(e,t){return e.widgets?.timeSlider?.fullTimeExtent??d(e.allLayers,t)}function f(e){const{numStops:t,stopInterval:n,stops:i}=e;return i?{dates:(0,a.clone)(i)}:n?{interval:n.clone()}:{count:t??5}}async function d(e,t){if(0===e.length)return l.default.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const n=e.filter(o),a=e.filter((e=>!o(e)&&null!=e.visibilityTimeExtent));if(0===n.length&&0===a.length)return l.default.allTime;const r=[],u=[];for(const i of n)"feature"!==i?.type&&"map-image"!==i?.type||!i.timeInfo?.hasLiveData?u.push(i):r.push(i);const s=e=>null==e||e.isAllTime,c=[...u.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=e;return t?.intersection(n)??n})),...a.map((e=>e.visibilityTimeExtent))];if(c.some(s))return l.default.allTime;const f=r.map((async e=>{const n=(await e.fetchRecomputedExtents({signal:t}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return n?.intersection(i)??i})),d=(await Promise.allSettled(f)).map((e=>"fulfilled"===e.status?e.value:null));if(d.some(s))return l.default.allTime;const m=[...d,...c].filter(i.Ru);return 0===m.length?l.default.allTime:m.reduce(((e,t)=>e.union(t)))}function m(e,t){const n=e.currentTimeExtent;if(!n)return null;const{start:i,end:a}=n,r=i??a??null;switch(t){case"time-window":return new l.default({start:i,end:a});case"cumulative-from-start":return new l.default({start:null,end:r});case"cumulative-from-end":return new l.default({start:r,end:null});case"instant":return new l.default({start:r,end:r})}}async function p(e,t){if(!(0,u.r)(e)&&!function(e){return null!=e&&"object"==typeof e&&s.X in e}(e))return null;await e.load({signal:t});const n=e?.widgets?.timeSlider;if(!n)return null;const i=await c(e,t),a=n.loop,r=function(e){const t=e.numThumbs??2,n=e.currentTimeExtent;if(n){const{start:e,end:i}=n;return null!=e&&null!=i&&e.getTime()===i.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:i,loop:a,mode:r,playRate:n.stopDelay??2e3,stops:f(n),timeExtent:m(n,r)}}function h(e){if(!e)return e;const{start:t,end:n}=e;return new l.default({start:null!=t?(0,r.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,r.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}function y(e){if(!e)return e;const{start:t,end:n}=e;return new l.default({start:null!=t?(0,r.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,r.S1)(n,n.getTimezoneOffset(),"minutes"):n})}}}]);
//# sourceMappingURL=28866.4b9921db.chunk.js.map