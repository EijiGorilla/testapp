"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[59123,63733,67234],{32344:(e,t,i)=>{i.d(t,{NM:()=>r,Sf:()=>n,cH:()=>o,sQ:()=>s});class n{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class r{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class s{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.view=e,this.vertexIndex=t,this.vertices=i,this.mapPoint=n,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===i.length?i[0]:null}preventDefault(){this.defaultPrevented=!0}}class o{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===e.length?e[0]:null}preventDefault(){this.defaultPrevented=!0}}},53181:(e,t,i)=>{i.d(t,{J:()=>P});var n=i(39356),r=i(54901),s=i(76931),o=i(40565),a=i(19555),l=i(72745),p=i(9392),d=i(19247),h=i(23701),c=i(13312),u=i(89465),y=i(38996),v=i(76940),_=i(28808),m=i(23862),g=i(63078),f=i(14727);class P extends f.b{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new d.default({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new d.default({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new h.default({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:(0,o.PZ)(c.default,t.spatialReference)}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new h.default({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:(0,o.PZ)(c.default,t.spatialReference)}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=(0,l.vt)(),n=(0,l.vt)(),r=(0,p.vt)();(0,a.Re)(i,(0,m.Xz)(e.centerVertex),(0,m.Xz)(e.previousVertex)),(0,a.Re)(n,(0,m.Xz)(e.nextVertex),(0,m.Xz)(e.previousVertex)),(0,a.$A)(r,i,n);const s="rightAngleQuad"+(r[2]<0?45:225);return this._visualizeSnappingIndicator(new h.default({paths:[[[...e.previousVertex],[...e.centerVertex],[...e.nextVertex]]],spatialReference:(0,o.PZ)(c.default,t.spatialReference)}),this._getOrCreateSymbol(s,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new n.default({geometry:e,symbol:t});return this._graphicsLayer.add(i),(0,r.hA)((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(e,t){const i=this._symbolPairingsByType;return i.get(e)?.color!==t&&i.set(e,{color:t,symbol:x(e,t)}),i.get(e).symbol}}function x(e,t){const i=[...t.toRgb(),255*t.a];switch(e){case"point":return new v.default({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new v.default({outline:new y.default({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new u.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:_.uT.Butt,joinStyle:_.wd.Round,miterLimit:10,width:(0,s.PN)(g.N.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new u.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n="rightAngleQuad45"===e?45:225;return new u.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,s.PN)(g.N.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,s.PN)(g.N.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}},59123:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var n=i(35143),r=(i(76460),i(81806),i(47249),i(50076),i(85842)),s=i(19247),o=i(67234),a=i(32344),l=i(57308),p=i(82307),d=i(11500);const h=Symbol("view-handles"),c=Symbol("undo-redo-handles");let u=class extends o.default{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),l.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,d.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),l.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,d.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),l.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),l.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),l.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),l.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),l.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),l.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===p.NE.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==p.NE.complete||i?t!==p.NE.undo||this.interactiveUndoDisabled||i?t!==p.NE.redo||this.interactiveUndoDisabled||i?t!==p.NE.pan||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),l.o.TOOL),this.view.on("key-up",(e=>{e.key===p.NE.pan&&e.stopPropagation()}),l.o.TOOL)],h)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new a.NM(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new a.Sf(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new a.Sf(this.view,e.vertices[0].index,t))}}))],c)}_removeViewHandles(){this.removeHandles(h)}_removeUndoRedoHandles(){this.removeHandles(c)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||this._editGeometryOperations.appendVertex(t)}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new a.sQ(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new s.default(this._stagedVertex):null))))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new a.cH(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this._removeViewHandles()}};u=(0,n._)([(0,r.$)("esri.views.draw.MultipointDrawAction")],u);const y=u},63733:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var n=i(35143),r=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),o=i(5364),a=i(25515),l=i(65624),p=i(5682),d=i(64519),h=i(731);let c=class extends((0,l.dM)((0,p.j)(a.default))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,n._)([(0,r.MZ)({type:h.A})],c.prototype,"elevationInfo",void 0),(0,n._)([(0,r.MZ)((0,o.C)(d.Y,"graphics"))],c.prototype,"graphics",void 0),(0,n._)([(0,r.MZ)({type:["show","hide"]})],c.prototype,"listMode",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,r.MZ)({readOnly:!0})],c.prototype,"type",void 0),(0,n._)([(0,r.MZ)({constructOnly:!0})],c.prototype,"internal",void 0),c=(0,n._)([(0,s.$)("esri.layers.GraphicsLayer")],c);const u=c},67234:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var n,r=i(35143),s=i(54099),o=i(53084),a=i(30726),l=i(50346),p=i(76931),d=i(46053),h=(i(81806),i(76460),i(85842)),c=i(63733),u=i(18117),y=i(64465),v=i(53181),_=i(89238),m=i(974),g=i(59833),f=i(13284),P=i(14318);let x=n=class extends s.A.EventedAccessor{constructor(e){super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=(0,_.BV)(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new g.p(new m.ZE(e.editGeometryType??"polygon",this._coordinateHelper),y.RT.Local),this._snappingGraphicsLayer=new c.default({id:n.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new f.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new v.J(this._snappingGraphicsLayer)}),this._activeComponent=new m.uA(e.view.spatialReference,y.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,delete t.snappingManager,t}initialize(){this._snappingOperation=new P.O({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,a.pR)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation?.stagedPoint}set _stagedVertex(e){this._snappingOperation&&(this._snappingOperation.stagedPoint=(0,o.clone)(e))}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const i=this.elevationInfo??w;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.gs)(e.x,e.y),i,this._getGeometryZValue())}else{const i=this.elevationInfo??M;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.gs)(e.x,e.y),i,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const i=(0,u.T)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=i;const n=this._snappingManager;if(null==n)return this._stagedVertex=i,void t();(0,l.ignoreAbortErrors)(this._snappingOperation.snap({point:i},n,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){const t=this._editGeometryOperations.data.components[0].getLastVertex()?.pos;if(t&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:i,y:n}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&i===this._lastVertexUnsnapped.x&&n===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};x.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,r._)([(0,d.MZ)({readOnly:!0})],x.prototype,"vertices",null),(0,r._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],x.prototype,"interactiveUndoDisabled",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],x.prototype,"history",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],x.prototype,"redoHistory",void 0),(0,r._)([(0,d.MZ)()],x.prototype,"snapToScene",void 0),(0,r._)([(0,d.MZ)()],x.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],x.prototype,"elevationInfo",void 0),(0,r._)([(0,d.MZ)({nonNullable:!0})],x.prototype,"defaultZ",void 0),(0,r._)([(0,d.MZ)()],x.prototype,"hasZ",null),(0,r._)([(0,d.MZ)()],x.prototype,"_snappingOperation",void 0),(0,r._)([(0,d.MZ)()],x.prototype,"_stagedVertex",null),x=n=(0,r._)([(0,h.$)("esri.views.draw.DrawAction")],x);const w={mode:"absolute-height",offset:0},M={mode:"on-the-ground",offset:0};const S=x}}]);
//# sourceMappingURL=59123.75555e40.chunk.js.map