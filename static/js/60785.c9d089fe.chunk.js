"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[60785],{60785:(e,t,i)=>{i.r(t),i.d(t,{default:()=>A});var s=i(35143),o=i(18690),r=i(19276),a=i(54901),n=i(50346),l=i(68134),c=i(88685),d=i(46053),h=(i(81806),i(76460),i(85842)),u=i(24883),m=i(16159),p=i(75747),v=i(76940),_=i(57274),g=i(25329),w=i(54099),y=(i(47249),i(56829));let b=class extends(w.A.EventedMixin(y.g)){constructor(e){super(e)}get cursor(){return"crosshair"}onInputEvent(e){"click"===e.type&&this._handleClick(e)}_handleClick(e){this.emit("click",e)}};(0,s._)([(0,d.MZ)({readOnly:!0})],b.prototype,"cursor",null),(0,s._)([(0,d.MZ)({constructOnly:!0})],b.prototype,"stop",void 0),b=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsSearchTool")],b);var f=i(38745),S=i(91967);let M=class extends S.default{constructor(){super(...arguments),this.layerDetails=!0,this.saveAsButton=!0,this.saveButton=!0}};(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],M.prototype,"layerDetails",void 0),(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],M.prototype,"saveAsButton",void 0),(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],M.prototype,"saveButton",void 0),M=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsVisibleElements")],M);const K=M;var k=i(77430),I=i(19448),F=i(94126),T=i(98108),x=(i(76099),i(63582)),D=i(54761);const $="esri-directions",E={base:$,accordion:`${$}__accordion`,actionContainer:`${$}__action-container`,addStopButton:`${$}__add-stop-button`,departureTime:`${$}__departure-time`,departureTimeOptions:`${$}__departure-time-options`,directionsHeader:`${$}__directions-header`,directionsHeaderStopName:`${$}__directions-header-stop-name`,editFooter:`${$}__edit-footer`,editToolbar:`${$}__edit-toolbar`,editToolbarContainer:`${$}__edit-toolbar-container`,flexColumn:`${$}__flex-column`,flexRow:`${$}__flex-row`,headerStops:`${$}__header-stops`,labelEmphasize:`${$}__label-emphasize`,labelNoBottomMargin:`${$}__label-no-bottom-margin`,marginInlineMedium:`${$}__margin-inline-medium`,optimizeSection:`${$}__optimize-section`,optimizeSwitches:`${$}__optimize-switches`,paddingMedium:`${$}__padding-medium`,primaryFlowItem:`${$}__primary-flow-item`,primaryFooter:`${$}__primary-footer`,primaryFooterCentered:`${$}__primary-footer-centered`,primaryFooterLoader:`${$}__primary-footer-loader`,routeItem:`${$}__route-item`,routeItemButton:`${$}__route-item-button`,routeItemButtonContent:`${$}__route-item-button-content`,routeItemLabel:`${$}__route-item-label`,routeItemDescription:`${$}__route-item-description`,saveError:`${$}__save-error`,saveErrorIcon:`${$}__save-error-icon`,saveErrorLabel:`${$}__save-error-label`,saveProcessLoader:`${$}__save-process-loader`,selectedFeatureContainer:`${$}__selected-feature-container`,separator:`${$}__separator`,solveRoute:`${$}__solve-route`,stopContainer:`${$}__stop-container`,stopList:`${$}__stop-list`,stopItem:`${$}__stop-item`};let C=class extends g.default{constructor(e,t){super(e,t),this._activeManeuver=null,this._placeholderStops=new r.default([new p.default,new p.default]),this._portalFolderCombobox=null,this._portalFolders=null,this._portalItemNameInput=null,this._portalUserName=null,this._sections=null,this._stopsToSearches=new Map,this._currentFlowItem="primary",this._parentFlowItem="primary",this._saveState="initialized",this._searchTool=null,this.headingLevel=2,this.messages=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new f.default,this.visibleElements=new K,this._solveRouteDebounced=(0,n.debounce)((()=>this._solveRoute()))}initialize(){this.addHandles([(0,l.watch)((()=>this.viewModel.layer),(()=>{try{this.viewModel.load()}catch{}}),l.initial),(0,l.watch)((()=>this.viewModel.layer?.routeInfo),(()=>{this._sections=this._getStopSections()}),l.initial),(0,l.watch)((()=>this.viewModel.layer?.stops.toArray()),(e=>{e&&this.view?.activeTool&&this._searchTool&&this.view.activeTool===this._searchTool&&!e.includes(this._searchTool.stop)&&(this.view.tools.remove(this._searchTool),this._searchTool=null)}))])}loadDependencies(){return(0,F.W)({accordion:()=>i.e(41439).then(i.bind(i,41439)),"accordion-item":()=>i.e(17095).then(i.bind(i,17095)),action:()=>Promise.resolve().then(i.bind(i,85375)),"block-section":()=>i.e(23948).then(i.bind(i,23948)),button:()=>Promise.resolve().then(i.bind(i,43285)),combobox:()=>i.e(64880).then(i.bind(i,64880)),"combobox-item":()=>i.e(73438).then(i.bind(i,73438)),dropdown:()=>Promise.resolve().then(i.bind(i,24482)),flow:()=>i.e(87473).then(i.bind(i,87473)),"flow-item":()=>i.e(68445).then(i.bind(i,68445)),icon:()=>Promise.resolve().then(i.bind(i,16702)),input:()=>Promise.resolve().then(i.bind(i,38841)),"input-date-picker":()=>i.e(40240).then(i.bind(i,40240)),"input-time-picker":()=>i.e(59971).then(i.bind(i,59971)),label:()=>Promise.resolve().then(i.bind(i,11839)),list:()=>Promise.resolve().then(i.bind(i,75802)),"list-item":()=>Promise.resolve().then(i.bind(i,70205)),loader:()=>Promise.resolve().then(i.bind(i,35688)),notice:()=>i.e(12261).then(i.bind(i,12261)),panel:()=>Promise.resolve().then(i.bind(i,32647)),switch:()=>i.e(8989).then(i.bind(i,8989))})}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e);return i.view=t,this._overrideDefaultSources(i),i}const i=new _.default({icon:!1,popupEnabled:!1,resultGraphicEnabled:!1,view:t,...this.searchProperties});return this._normalizeSearchSources(i),this.addHandles([(0,l.on)((()=>i.allSources),"change",(()=>this._normalizeSearchSources(i))),i.on("search-clear",(()=>{e.geometry=null,e.name=null,this.viewModel.layer?.removeResult()})),i.on("select-result",(()=>{const t=i.selectedResult;e.geometry=t?.feature.geometry,e.name=t?.name,this._solveRouteDebounced()})),(0,l.watch)((()=>i.searchTerm),(t=>{e.name=t}))],i),this._stopsToSearches.set(e,i),i}getDirections(){return this.viewModel.getDirections()}render(){return(0,D.K)("div",{class:this.classes(E.base,T.D.widget,T.D.panel)},(0,D.K)("calcite-flow",null,this._renderPrimaryFlowItem(),this._renderDirectionsFlowItem(),this._renderEditFlowItem(),this._renderSaveFlowItem()))}save(){return this.viewModel.save()}saveAs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_applyLocatorSourceOverrides(e){let{allSources:t}=e;for(const i of t)"url"in i&&i.url&&(i.locationType??="street",(0,I.m$)(i.url)&&this.apiKey&&null==i.apiKey&&(i.apiKey=this.apiKey,i.url=I.jd))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_getEffectiveStops(){return this.viewModel.layer?.stops??this._placeholderStops}_getErrorDescription(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_getNetworkFeatureName(e){switch(e.type){case"stop":switch(e.locationType){case"stop":default:return this.messages.networkFeatures.stops.stop;case"waypoint":return this.messages.networkFeatures.stops.waypoint;case"break":return this.messages.networkFeatures.stops.break}case"point-barrier":return this.messages.networkFeatures.pointBarrier;case"polyline-barrier":return this.messages.networkFeatures.polylineBarrier;case"polygon-barrier":return this.messages.networkFeatures.polygonBarrier}}_getRouteCostSummary(){const e=this.viewModel.layer?.routeInfo;if(!e)return null;const t=e.totalDistance??0,i=e.totalDuration??0,{messagesUnits:s,unit:o}=this;return{distance:(0,k.BO)(s,t,o),duration:(0,k.a3)(i)}}_getStopSections(){if(!this.viewModel.layer)return null;const{directionPoints:e,directionLines:t,stops:i}=this.viewModel.layer;if(!e||!t)return null;const s=[];let o=null;for(const r of e){const{objectId:e,stopId:a}=r;if(null!=a){const e=i.find((e=>{let{objectId:t}=e;return t===a}));o&&o.stop===e||(o={stop:e,directions:[]},s.push(o));continue}if(null==o)continue;const n=t.find((t=>{let{directionPointId:i}=t;return i===e}));null!=n&&o.directions.push({directionPoint:r,directionLine:n})}return s}_handleLocateStopAction(e){const{view:t}=this;if(!t)return;const i="directions-search-tool";this.removeHandles(i),this._searchTool=new b({stop:e,view:t}),this.addHandles([this._searchTool.on("click",(async t=>{if(t.mapPoint&&this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e),s=await i.search(t.mapPoint),o=s?.results?.[0].results?.[0];if(o){const{feature:t,name:s}=o;i.searchTerm=s,e.geometry=t.geometry}}this.removeHandles(i)})),(0,a.hA)((()=>{this._searchTool&&(this.view?.tools.remove(this._searchTool),this._searchTool=null)}))],i),t.addAndActivateTool(this._searchTool)}_handleEditingDoneClick(){this.viewModel.stopEditing(),this._currentFlowItem="primary"}async _handleSaveLayerAsAction(){const e=u.default.getDefault();try{await e.signIn()}catch(t){if((0,n.isAbortError)(t)||"identity-manager:user-aborted"===t.name)return;return this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",void(this._saveState="connect-to-portal-error")}this._saveState="fetch-portal-information",this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",this._portalUserName=e.user?.username;try{this._portalFolders=await(e.user?.fetchFolders())}catch{return void(this._saveState="fetch-portal-information-error")}this._saveState="save-layer"}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){for(const t of e.viewModel.defaultSources)t.autoNavigate=!1}_renderClearRouteAction(e){return(0,D.K)("calcite-action",{icon:"trash",key:"clear-route",onclick:()=>{this._currentFlowItem="primary",this.viewModel.reset()},...e,text:this.messages.common.clear,textEnabled:!0})}_renderDeleteStopAction(e){const t=this._getEffectiveStops();return(0,D.K)("calcite-action",{icon:"trash",onclick:()=>{t.remove(e),this._disposeSearch(e),this._solveRouteDebounced()},scale:"s",slot:"actions-end",text:this.messages.deleteStop,title:this.messages.deleteStop})}_renderDepartureTime(){const{DEPART_AT:e,NOW:t,UNSPECIFIED:i}=k.jW;return(0,D.K)("calcite-label",{class:E.departureTime,key:"departure-time"},this.messages.departureTime,(0,D.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.departureTime,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.departureOption=i[0].value,this._solveRouteDebounced())}},(0,D.K)("calcite-combobox-item",{heading:this.messages.leaveNow,key:t,label:this.messages.leaveNow,selected:this.viewModel.departureOption===t,value:t}),(0,D.K)("calcite-combobox-item",{heading:this.messages.departAt,key:e,label:this.messages.departAt,selected:this.viewModel.departureOption===e,value:e}),(0,D.K)("calcite-combobox-item",{heading:this.messages.timeUnspecified,key:i,label:this.messages.timeUnspecified,selected:this.viewModel.departureOption===i,value:i})))}_renderDepartureTimeOptions(){return this.viewModel.departureOption!==k.jW.DEPART_AT?null:(0,D.K)("div",{class:E.departureTimeOptions},(0,D.K)("calcite-input-date-picker",{scale:"s",value:this.viewModel.departureIsoDate,onCalciteInputDatePickerChange:e=>{let{currentTarget:{value:t}}=e;Array.isArray(t)||(this.viewModel.departureIsoDate=t,this._solveRouteDebounced())}}),(0,D.K)("calcite-input-time-picker",{scale:"s",value:this.viewModel.departureIsoTime,onCalciteInputTimePickerClose:e=>{let{currentTarget:{value:t}}=e;this.viewModel.departureIsoTime=t,this._solveRouteDebounced()}}))}_renderDirectionsFlowItem(){if("directions"!==this._currentFlowItem)return null;const e=this._getRouteCostSummary();if(!this._sections||!e)return null;const{distance:t,duration:i}=e,{formattedEta:s}=this.viewModel,o=this._sections.at(0)?.stop.name??"",r=this._sections.at(-1)?.stop.name??"";return(0,D.K)("calcite-flow-item",{key:"directions-flow-item",overlayPositioning:"fixed",selected:"directions"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem="primary"}},(0,D.K)("div",{class:E.directionsHeader,slot:"header-content"},(0,D.K)("div",{class:E.headerStops},(0,D.K)("span",null,this.messages.from)," ",(0,D.K)("span",{class:E.directionsHeaderStopName},o),(0,D.K)("span",null,this.messages.to)," ",(0,D.K)("span",{class:E.directionsHeaderStopName},r)),(0,D.K)("div",{class:E.flexColumn},(0,D.K)("span",null,`${i} (${t})`),s?(0,D.K)("span",null,s):null)),this._renderRouteLayerActions({slot:"header-menu-actions"}),(0,D.K)("calcite-accordion",{class:E.accordion,iconPosition:"start",selectionMode:"single"},this._sections.map(((e,t)=>{const{stop:i,directions:s}=e,{name:o}=i;return(0,D.K)("calcite-accordion-item",{expanded:0===t,heading:o??"",key:`stop-${t}`},(0,D.K)("calcite-action",{icon:"zoom-to-object",onclick:()=>{this.viewModel.centerAt(i)},slot:"actions-end",text:this.messages.panToStop}),this._renderDirectionTurns(s))}))))}_renderDirectionTurns(e){return(0,D.K)("calcite-list",{label:this.messages.drivingDirections,selectionMode:"none"},e.map(((e,t)=>{const{directionPoint:i,directionLine:s}=e,{distance:r,duration:a}=s,n=(0,k.BO)(this.messagesUnits,r??0,this.unit),l=(0,k.a3)(a??0),d=n&&l?`${n} | ${l}`:`${n||l}`,h=function(e){const{branchName:t,displayText:i,exitName:s,intersectingName:r,name:a,towardName:n}=e;if(null==i)return null;const l=[t,s,r,a,n].filter(o.Ru).sort(((e,t)=>t.length-e.length)).map((e=>(0,c.Cj)(e)));if(!l.length)return i;const d=new RegExp(l.join("|"),"g"),h=i.matchAll(d);let u=0;const m=[];for(const{0:o,index:c}of h)m.push(i.slice(u,c),(0,D.K)("span",{class:E.labelEmphasize,key:`maneuver-${c}`},o)),u=c+o.length;return m.push(i.slice(u)),(0,D.K)("span",null,m)}(i),u=(0,k.RU)(i.directionPointType);return(0,D.K)("calcite-list-item",{class:E.labelNoBottomMargin,key:`driving-direction-${t}`,onpointerenter:()=>{this.viewModel.highlight(s)},onpointerleave:()=>{this.viewModel.clearHighlights()},onCalciteListItemSelect:()=>{this._activeManeuver===s?this.zoomToRoute():(this._activeManeuver=s,this.viewModel.centerAt(s.geometry))}},(0,D.K)("calcite-icon",{icon:u,slot:"content-start"}),(0,D.K)("div",{slot:"content"},(0,D.K)("calcite-label",{layout:"inline",scale:"s"},h),(0,D.K)("calcite-label",{layout:"inline",scale:"s"},d)))})))}_renderEditFlowItem(){return"edit"!==this._currentFlowItem?null:(0,D.K)("calcite-flow-item",{heading:this.messages.editRoute,headingLevel:this.headingLevel,key:"edit-flow-item",loading:"routing"===this.viewModel.state,selected:"edit"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.viewModel.stopEditing(),this._currentFlowItem="primary"}},(0,D.K)("div",{class:E.flexColumn,key:"edit-container"},(0,D.K)("div",{class:E.editToolbarContainer},(0,D.K)("calcite-label",{layout:"inline",scale:"s"},this.messages.automaticallySolve,(0,D.K)("calcite-switch",{checked:this.viewModel.autoSolve,scale:"s",onCalciteSwitchChange:e=>{this.viewModel.autoSolve=e.target.checked}})),(0,D.K)("div",{class:E.editToolbar},(0,D.K)("calcite-action",{icon:"flag",onclick:()=>{this.viewModel.create("stop")},scale:"s",text:this.messages.networkFeatures.stops.stop,textEnabled:!0}),(0,D.K)("calcite-action",{icon:"line",onclick:()=>{this.viewModel.create("polyline-barrier")},scale:"s",text:this.messages.barrier,textEnabled:!0}),(0,D.K)("calcite-action",{class:E.solveRoute,disabled:this.viewModel.autoSolve,icon:"refresh",onclick:()=>{this._solveRouteDebounced()},scale:"s",text:this.messages.solve,textEnabled:!0}))),(0,D.K)("div",{class:E.selectedFeatureContainer},(0,D.K)("calcite-list",{label:this.messages.selectedNetworkFeatures,scale:"s",selectionMode:"none"},this.viewModel.selectedNetworkFeatures?.toArray().map(((e,t)=>(0,D.K)("calcite-list-item",{description:this._getNetworkFeatureName(e),key:`network-feature-${t}`,label:e.name??e.objectId?.toString()??this.messages.unnamed},(0,D.K)("calcite-action",{icon:"trash",onclick:()=>{this.viewModel.remove(e)},scale:"s",slot:"actions-end",text:this.messages.common.delete})))))),(0,D.K)("div",{class:E.editFooter},this._renderEditFooterContent())))}_renderEditFooterContent(){return this.viewModel.lastError?this._renderErrorNotice():(0,D.K)("calcite-button",{appearance:"outline-fill",bind:this,onclick:this._handleEditingDoneClick,width:"full"},this.messages.common.done)}_renderErrorNotice(){return(0,D.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0},(0,D.K)("calcite-label",{class:E.labelNoBottomMargin,slot:"message"},this._getErrorDescription()))}_renderFooter(){if(!this.viewModel.layer)return(0,D.K)("div",{class:E.primaryFooter,key:"footer-missing-layer"},(0,D.K)("calcite-notice",{icon:"information",open:!0},(0,D.K)("calcite-label",{class:E.labelNoBottomMargin,slot:"message"},this.messages.missingLayer)));if("unauthenticated"===this.viewModel.state)return(0,D.K)("div",{class:E.primaryFooterCentered,key:"footer-sign-in"},(0,D.K)("calcite-label",null,this.messages.signInRequired),(0,D.K)("calcite-button",{onclick:()=>{this.viewModel.load().catch((()=>{}))}},this.messages.common.auth.signIn));if("routing"===this.viewModel.state)return(0,D.K)("div",{class:this.classes(E.primaryFooter,E.primaryFooterLoader),key:"footer-routing"},(0,D.K)("calcite-loader",{label:this.messages.solve,scale:"s"}));if("error"===this.viewModel.state)return(0,D.K)("div",{class:E.primaryFooter,key:"footer-service-error"},this._renderErrorNotice());if(!this.viewModel.layer?.routeInfo)return(0,D.K)("div",{class:E.primaryFooter,key:"footer-unsolved-route"},(0,D.K)("calcite-notice",{icon:"information",open:!0},(0,D.K)("calcite-label",{class:E.labelNoBottomMargin,slot:"message"},this.messages.directionsPlaceholder)));const e=this._getRouteCostSummary();if(!e||!this.viewModel.layer?.directionPoints)return(0,D.K)("div",{class:E.primaryFooter,key:"footer-invalid-route"},(0,D.K)("calcite-notice",{icon:"exclamation-mark-triangle",kind:"danger",open:!0},(0,D.K)("calcite-label",{class:E.labelNoBottomMargin,slot:"message"},this.messages.invalidRoute)));const{distance:t,duration:i}=e,{formattedEta:s}=this.viewModel;return(0,D.K)("div",{class:E.routeItem,key:"footer-directions-summary"},(0,D.K)("button",{"aria-busy":"false","aria-label":this.messages.viewDrivingDirections,"aria-live":"polite",class:E.routeItemButton,onclick:()=>{this._currentFlowItem="directions"},type:"button"},(0,D.K)("div",{class:E.routeItemButtonContent},(0,D.K)("span",{class:E.routeItemLabel},`${i} (${t})`),(0,D.K)("span",{class:E.routeItemDescription},s)),(0,D.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s"})),(0,D.K)("calcite-dropdown",null,(0,D.K)("calcite-action",{icon:"ellipsis",slot:"trigger",text:"Route actions"}),this._renderRouteLayerActions()))}_renderInteractiveRouteActions(){return(0,D.K)("div",{class:E.actionContainer,key:"interactive-route-action-container"},(0,D.K)("calcite-button",{appearance:"outline",class:E.addStopButton,disabled:this._getEffectiveStops().length>=this.maxStops,iconStart:"plus",kind:"neutral",label:this.messages.addStop,onclick:()=>{const e=new v.default;this.viewModel.layer?.stops.add(new p.default({symbol:e}))},width:"half"},this.messages.addStop),(0,D.K)("calcite-button",{appearance:"outline",disabled:"2d"!==this.viewModel.view?.type,iconStart:"pencil",kind:"neutral",label:this.messages.editRoute,onclick:()=>{this._currentFlowItem="edit",this.viewModel.startEditing()},width:"half"},this.messages.editRoute))}_renderLocateStopAction(e){if(null!=e.name||null!=e.geometry)return null;const t=this._getEffectiveStops().indexOf(e),i=!!this.view?.activeTool&&this.view.activeTool===this._searchTool&&this._searchTool.stop===e;return(0,D.K)("calcite-action",{active:i,icon:"crosshair",key:`stop-location-action-${t}`,onclick:()=>this._handleLocateStopAction(e),scale:"s",slot:"actions-end",text:this.messages.pickALocationOnTheMap,title:this.messages.pickALocationOnTheMap})}_renderOptimizeStopOrder(){const{routeParameters:e}=this.viewModel,{findBestSequence:t,preserveFirstStop:i,preserveLastStop:s}=e;return(0,D.K)("calcite-block-section",{class:E.optimizeSection,text:this.messages.optimizeOrder,toggleDisplay:"switch",onCalciteBlockSectionToggle:t=>{let{target:i}=t;e.findBestSequence=i.open,i.open||this._resetStopSequence(),this._solveRouteDebounced()}},t?[(0,D.K)("calcite-label",{class:E.optimizeSwitches,key:"preserve-first-stop",layout:"inline-space-between"},this.messages.preserveFirstStop,(0,D.K)("calcite-switch",{checked:i,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveFirstStop=i,this._resetStopSequence(),this._solveRouteDebounced()}})),(0,D.K)("calcite-label",{class:E.optimizeSwitches,key:"preserve-last-stop",layout:"inline-space-between"},this.messages.preserveLastStop,(0,D.K)("calcite-switch",{checked:s,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveLastStop=i,this._resetStopSequence(),this._solveRouteDebounced()}}))]:null)}_renderPrimaryFlowItem(){return(0,D.K)("calcite-flow-item",{key:"primary-flow-item",loading:"initializing"===this.viewModel.state,selected:"primary"===this._currentFlowItem},(0,D.K)("calcite-panel",{class:E.primaryFlowItem,disabled:!this.viewModel.layer||"unauthenticated"===this.viewModel.state||"error"===this.viewModel.state&&!this.viewModel.serviceDescription},this._renderStops(),this._renderInteractiveRouteActions(),this._renderSeparator(),this._renderRouteSolveOptions()),this._renderFooter())}_renderRouteLayerActions(e){return[this._renderClearRouteAction(e),this._renderSaveLayerAction(e),this._renderSaveLayerAsAction(e),this._renderViewItemDetailsAction(e)]}_renderRouteSolveOptions(){return(0,D.K)("div",{class:E.marginInlineMedium,key:"route-solve-options"},this._renderTravelModes(),this._renderDepartureTime(),this._renderDepartureTimeOptions(),this._renderOptimizeStopOrder())}_renderSaveContent(){switch(this._saveState){case"initialized":return this._renderSaveInitialized();case"connect-to-portal":return this._renderSaveProcessing(this.messages.identity.lblSigning);case"connect-to-portal-error":return this._renderSaveError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderSaveProcessing(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderSaveError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayerSettings();case"saving":return this._renderSaveProcessing(this.messages.processing.saving);case"saving-error":return this._renderSaveError(this.messages.errors.saving)}}_renderSaveError(e){return(0,D.K)("calcite-panel",{class:E.paddingMedium,key:"save-layer-error"},(0,D.K)("div",{class:E.saveError},(0,D.K)("calcite-icon",{class:E.saveErrorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messages.common.errorMessage}),(0,D.K)("calcite-label",{class:E.saveErrorLabel},e)),(0,D.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.close))}_renderSaveInitialized(){return(0,D.K)("calcite-panel",{class:E.paddingMedium,key:"save-layer-initialized"})}_renderSaveFlowItem(){return"save"!==this._currentFlowItem?null:(0,D.K)("calcite-flow-item",{heading:this.messages.saveLayer,headingLevel:this.headingLevel,key:"save-layer-flow-item",selected:"save"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem=this._parentFlowItem}},this._renderSaveContent())}_renderSaveLayerAction(e){if(!this.visibleElements.saveButton)return null;const t=this.viewModel.layer,i=t?.routeInfo,s=t?.portalItem?.itemControl;return(0,D.K)("calcite-action",{disabled:!(i&&("admin"===s||"update"===s)),icon:"save",key:"save-route",onclick:()=>{this.viewModel.layer?.save()},...e,text:this.messages.common.save,textEnabled:!0})}_renderSaveLayerAsAction(e){if(!this.visibleElements.saveAsButton)return null;const t=!this.viewModel.layer?.routeInfo;return(0,D.K)("calcite-action",{disabled:t,icon:"save-as",key:"save-as-route",onclick:()=>{this._handleSaveLayerAsAction()},...e,text:this.messages.common.saveAs,textEnabled:!0})}_renderSaveLayerSettings(){if(null==this.layer||null==this._portalFolders||null==this._portalUserName)return this._renderSaveInitialized();const{stops:e}=this.layer,t=`${e.at(0).name} - ${e.at(-1).name}`,i=[(0,D.K)("calcite-combobox-item",{heading:`${this._portalUserName} (${this.messages.common.home})`,key:`${$}-folder-home`,selected:!0,value:`${$}-folder-home`}),...this._portalFolders.map((e=>(0,D.K)("calcite-combobox-item",{heading:e.title??"",key:`${$}-folder-${e.id}`,value:e.id})))];return(0,D.K)("calcite-panel",{key:"save-layer-panel"},(0,D.K)("div",{class:E.paddingMedium},(0,D.K)("calcite-label",null,this.messages.laverName,(0,D.K)("calcite-input",{afterCreate:e=>{this._portalItemNameInput=e},label:this.messages.laverName,value:t})),(0,D.K)("calcite-label",null,this.messages.saveInFolder,(0,D.K)("calcite-combobox",{afterCreate:e=>{this._portalFolderCombobox=e},clearDisabled:!0,label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},i))),(0,D.K)("calcite-button",{onclick:()=>{if(this._saveState="saving",null==this.layer||null==this._portalFolders)return;const e=this._portalItemNameInput?.value,t=this._portalFolderCombobox?.value,i=this._portalFolders.find((e=>{let{id:i}=e;return i===t}));this.layer.saveAs({title:e},{folder:i}).then((()=>{this._currentFlowItem=this._parentFlowItem})).catch((()=>{this._saveState="saving-error"}))},slot:"footer-actions",width:"full"},this.messages.common.save),(0,D.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.cancel))}_renderSaveProcessing(e){return(0,D.K)("calcite-panel",{class:E.marginInlineMedium,key:"save-layer-processing"},(0,D.K)("calcite-loader",{class:E.saveProcessLoader,label:e,text:e}))}_renderSeparator(){return(0,D.K)("div",{class:E.separator})}_renderStop(e){const t=this.acquireSearch(e);null!=e.name&&(t.searchTerm=e.name);const i=this._getEffectiveStops(),s=this._renderLocateStopAction(e),o=i.length>2&&this._renderDeleteStopAction(e);return(0,D.K)("calcite-list-item",{key:e,value:e},s,o,(0,D.K)("div",{class:E.stopItem,slot:"content"},t.render()))}_renderStops(){const e=this._getEffectiveStops();for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);return(0,D.K)("div",{class:E.stopContainer,key:E.stopContainer},(0,D.K)("calcite-list",{class:E.stopList,dragEnabled:!0,label:this.messages.widgetLabel,scale:"s",onCalciteListOrderChange:t=>{let{detail:i}=t;e.reorder(i.dragEl.value,i.newIndex),this._resetStopSequence(),this._solveRouteDebounced()}},e.toArray().map((e=>this._renderStop(e)))),2===e.length&&(0,D.K)("calcite-action",{icon:"arrow-up-down",onclick:()=>{e.reverse(),this._resetStopSequence(),this._solveRouteDebounced()},scale:"s",text:this.messages.reverseStops}))}_renderTravelModes(){return this.viewModel.travelModes.length?(0,D.K)("calcite-label",{key:"travel-modes"},this.messages.mode,(0,D.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.mode,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.selectedTravelMode=i[0].value,this._solveRouteDebounced())}},this.viewModel.travelModes.map((e=>(0,D.K)("calcite-combobox-item",{heading:e.name,key:e.id,label:e.name,selected:this.viewModel.selectedTravelMode?.id===e.id,value:e}))))):null}_renderViewItemDetailsAction(e){if(!this.visibleElements.layerDetails)return null;const t=this.viewModel.layer?.portalItem;return(0,D.K)("calcite-action",{disabled:!t,icon:"launch",key:"open-route-details-link",onclick:()=>{t&&window.open(`${t.portal.url}/home/item.html?id=${t.id}`,"_blank")},...e,text:this.messages.viewLayerDetails,textEnabled:!0})}_resetStopSequence(){this.viewModel.layer?.stops.forEach((e=>{e.sequence=null}))}async _solveRoute(){if(this.viewModel.updateDepartureTime(),!((this.viewModel.layer?.stops.filter((e=>{let{geometry:t}=e;return!!t})).length??0)<2))try{await this.viewModel.getDirections()}catch{}}};(0,s._)([(0,d.MZ)()],C.prototype,"_currentFlowItem",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"_saveState",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"_searchTool",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"apiKey",null),(0,s._)([(0,d.MZ)(m.q)],C.prototype,"defaultUnit",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"goToOverride",null),(0,s._)([(0,d.MZ)()],C.prototype,"headingLevel",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"icon",null),(0,s._)([(0,d.MZ)()],C.prototype,"label",null),(0,s._)([(0,d.MZ)({readOnly:!0})],C.prototype,"lastRoute",null),(0,s._)([(0,d.MZ)()],C.prototype,"layer",null),(0,s._)([(0,d.MZ)()],C.prototype,"maxStops",null),(0,s._)([(0,d.MZ)(),(0,x.G)("esri/widgets/Directions/t9n/Directions")],C.prototype,"messages",void 0),(0,s._)([(0,d.MZ)(),(0,x.G)("esri/core/t9n/Units")],C.prototype,"messagesUnits",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"searchProperties",void 0),(0,s._)([(0,d.MZ)()],C.prototype,"unit",null),(0,s._)([(0,d.MZ)()],C.prototype,"view",null),(0,s._)([(0,d.MZ)({type:f.default})],C.prototype,"viewModel",void 0),(0,s._)([(0,d.MZ)({type:K,nonNullable:!0})],C.prototype,"visibleElements",void 0),C=(0,s._)([(0,h.$)("esri.widgets.Directions")],C);const A=C}}]);
//# sourceMappingURL=60785.c9d089fe.chunk.js.map