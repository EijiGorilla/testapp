"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[42062,66938,87539,91913],{5600:(e,t,n)=>{n.d(t,{Cq:()=>m,Dt:()=>y,JC:()=>v,Rj:()=>p,Sf:()=>f,b:()=>_,gZ:()=>c,w2:()=>h,xZ:()=>g});var i=n(76460),r=n(87663),s=n(50346),o=n(41289),a=n(25647),l=n(31933),d=n(5874);const u=()=>i.A.getLogger("esri.editing.templateUtils");function c(e){return null!=e&&"prototype"in e}function p(e){return h(e)&&!("definition"in e)}function f(e){return h(e)&&"definition"in e}function h(e){return null!=e&&"templateId"in e}function m(e){return f(e)&&"feature"===e?.type&&(null==e.definition||(0,a.sC)(e.definition))}function y(e){return f(e)&&"group"===e?.type&&(null==e.definition||(0,a.Xc)(e.definition))}function v(e){return f(e)&&"preset"===e?.type&&(null==e.definition||(0,a.vf)(e.definition))}function g(e){return f(e)&&null!=e?.definition}const b=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]];async function _(e,t,n){if(null==t)return e.map((e=>({layer:e,templates:b(e)})));const i=await async function(e,t){const n=await(0,d.Z)(t).load(),i=new Set;for(const r of e)(0,o.kb)(i,I(n,r));return await Promise.all(Array.from(i).map((e=>e.featureService.load()))),i}(e,t);(0,s.throwIfAborted)(n);const a=new Map,c=Array.from(i).map((e=>async function(e){let{serviceInfo:t,out:n,signal:i}=e;const{featureService:o,layersAndTables:a}=t,d=await async function(e){let{featureService:t,layers:n,signal:i}=e;if(!t.capabilities?.editing.supportsSharedTemplates)return new Map;const s=new Map(n.map((e=>[e.layerId,e]))),o=await t.querySharedTemplates({query:{layers:Array.from(s.keys())},requestOptions:{signal:i}}),a=new Map;for(const l of o)for(const e of l.layerIds)s.has(e)&&(0,r.tE)(a,s.get(e),(()=>[])).push(l);return a}({featureService:o,layers:a.toArray(),signal:i});(0,s.throwIfAborted)(i);for(const[r,s]of d.entries())if(0!==s.length)if((0,l.F2)(r)){const e=w(s),t=[],i=e.get(1/0)??t;for(const s of r.sublayers){const r=e.get(s.subtypeCode)??t;n.set(s,[...r,...i])}}else n.set(r,s)}({serviceInfo:e,out:a,signal:n,view:t}))),p=await Promise.allSettled(c);for(const r of p.filter((e=>"rejected"===e.status)))u().warn("Failed to fetch shared templates for service. Will use standard templates if available.",r.reason);return e.map((e=>({layer:e,templates:a.get(e)??b(e)})))}function I(e,t){return(0,l.Sv)(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):(0,l.yZ)(t)?e.tablesAndLayersLookup.get(t):null}function w(e){const t=new Map;for(const n of e)(0,r.tE)(t,n.subtypeCode??1/0,(()=>[])).push(n);return t}},5874:(e,t,n)=>{n.d(t,{Z:()=>Z});var i=n(35143),r=n(55171),s=n(19276),o=n(50076),a=n(54099),l=n(49304),d=n(76460),u=n(87663),c=n(91291),p=n(50346),f=n(67993),h=n(68134),m=n(90534),y=n(46053),v=(n(81806),n(47249),n(85842)),g=n(19451),b=n(13096),_=n(31933),I=n(24883),w=n(96422),M=n(8163),S=n(91967);let T=class extends S.default{constructor(e){super(e),this.layers=new s.default,this.lockType="none",this.tables=new s.default,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new s.default([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}};(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"canCreateVersion",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"canEditVersionedData",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"featureService",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"layers",void 0),(0,i._)([(0,y.MZ)()],T.prototype,"layersAndTables",null),(0,i._)([(0,y.MZ)()],T.prototype,"lockType",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"tables",void 0),(0,i._)([(0,y.MZ)()],T.prototype,"versionInfo",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],T.prototype,"versionService",void 0),(0,i._)([(0,y.MZ)()],T.prototype,"hasAdvancedEditingUserTypeExtension",void 0),(0,i._)([(0,y.MZ)()],T.prototype,"loggedInServiceUser",void 0),(0,i._)([(0,y.MZ)()],T.prototype,"featureServiceVersion",null),T=(0,i._)([(0,v.$)("esri.undoredo.support.ServiceVersionInfo")],T);var A=n(54265);const L=new Map;function Z(e){return(0,u.tE)(L,e,(()=>{const t=new C({view:e});return e.addHandles({remove(){L.delete(e),t.destroy()}}),t.load().catch((e=>{d.A.getLogger("esri.views.Services").error("Failed to load service metadata",e)})),t}))}let C=class extends(l.A.LoadableMixin(c.A.EsriPromiseMixin(a.A.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new g.U,this.items=new s.default,this.tablesAndLayersLookup=new f.A,this.additionalLayers=new s.default,this._debouncedCheckAndUpdateServiceInfos=(0,p.debounce)((async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const n=t.layersAndTables.getItemAt(0);n?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await(0,h.whenOnce)((()=>!this.updating)),await this._updateVersionInfos(e))})),this._debouncedLayersChanged=(0,p.debounce)((async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await(0,h.whenOnce)((()=>!this._updatingHandles.updating)),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const i of e)if("feature"===i.type||"subtype-group"===i.type){if(!i.url)continue;const e=(0,b.qg)(i.url).url.path,r=this._findServiceInfo(e);if(r)this.tablesAndLayersLookup.set(i,r),i.isTable?r.tables.push(i):r.layers.push(i);else if(!t.has(e))try{await this._addServiceInfo(e,i)}catch(n){d.A.getLogger(this).error(`Failed to load feature service: ${e}`,n)}finally{t.add(e)}}})()))})),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return(0,p.throwIfAborted)(e),this.addHandles([(0,h.watch)((()=>this._allLayersAndTables),(()=>{this._debouncedLayersChanged().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))})),(0,h.watch)((()=>this.items.map((e=>e.layersAndTables.map((e=>e.gdbVersion??"")).join(",")))),(()=>{this.checkAndUpdateServiceInfos().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))}))]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,n)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,n=this._findServiceInfo(t);if(!n?.versionService)throw new o.default("services:no-version-management-service");const i=n.hasAdvancedEditingUserTypeExtension,r=n.loggedInServiceUser.toUpperCase(),s=function(e){return!e||0===e.trim().length}(e.ownerName)?r:e.ownerName?.trim().toUpperCase();if(s!==r){if(n.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i)throw new o.default("services:no-advanced-editing-user-type-extension")}if("SDE"===s?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new o.default("services:no-valid-version-name");{const t=await n.versionService.getVersionInfos();if(t?.find((t=>t.versionIdentifier.name.toUpperCase()===(s+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(r+"."+e.versionName).toUpperCase())))throw new o.default("services:no-valid-version-name")}const a=await n.versionService.createVersion({versionName:e.versionName,access:s!==r?"public":e.access,description:e.description});if(s!==r){const{guid:t,name:i}=a.versionIdentifier;await n.versionService.alterVersion({guid:t,name:i},{ownerName:s,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:n.versionService})})())}deleteVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");if(i.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const r={name:t,guid:n};await i.versionService.deleteVersion(r)&&(await this._updateVersionInfo(i),this.emit("version-deleted",{versionIdentifier:r,versionManagementService:i.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new o.default("services:no-version-management-service");if(!t.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const n=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let i=!0;("none"!==t.versionService.getLockType(n)||(i=await t.versionService.startReading(n),i))&&(i=await t.versionService.startEditing(n),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const n=this._findServiceInfo(e);if(!n?.versionService)throw new o.default("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const i=n.versionInfo?.versionIdentifier??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid},r=n.versionService.getLockType(i);if("none"!==r)return"read"===r?(await n.versionService.stopReading(i),void n.updateLockType()):"edit"===r?(await n.versionService.stopEditing(i,t),await n.versionService.stopReading(i),void n.updateLockType()):void 0})())}async _changeVersionInternal(e,t,n){const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");const r=i.versionInfo?.versionIdentifier??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},s={name:t,guid:n};await i.versionService.changeVersion(this.view?.map,r,s)&&await this._updateVersionInfo(i)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const n=e.layersAndTables.getItemAt(0)?.gdbVersion,i=n?await t.getVersionIdentifierFromName(n):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(i)}_findServiceInfo(e){return this.items.find((t=>t.featureService.url===e))??null}_removeFeatureService(e){this.items.remove(e)}async _findPortal(e){const t=r.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const n=`${t.owningSystemUrl}/sharing/rest`,i=I.default.getDefault();return i?.loaded&&(0,m.normalize)(i.restUrl)===(0,m.normalize)(n)?i:new I.default({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch((e=>{d.A.getLogger(this).error("Failed to update version details",e)}))})())}async _addServiceInfo(e,t){const n=new M.default({url:e});await n.load();const i=await this._findPortal(e),r=i?.user?.username;let o=!1;r&&(o=await(0,w.RE)(i,r,"advediting"));let a=null;n.versionManagementServiceUrl&&(a=new A.default({url:n.versionManagementServiceUrl}),await a.load());const l=t.isTable?[]:[t],d=t.isTable?[t]:[],u=new T({loggedInServiceUser:r??"",hasAdvancedEditingUserTypeExtension:o,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:n,versionService:a,layers:new s.default(l),tables:new s.default(d)});return a&&await this._updateVersionInfo(u),this.items.push(u),this.tablesAndLayersLookup.set(t,u),t.isTable?u.tables.push(t):u.layers.push(t),u}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const n of e)"feature"!==n.type&&"subtype-group"!==n.type||this._processed.has(n)||t.push(n);for(const n of this._processed)if(!e.has(n)&&((0,_.F2)(n)||(0,_.yZ)(n))){const e=this.tablesAndLayersLookup.get(n);if(!e)continue;this.tablesAndLayersLookup.delete(n),n.isTable?e.tables.remove(n):e.layers.remove(n),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}};(0,i._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"view",void 0),(0,i._)([(0,y.MZ)()],C.prototype,"items",void 0),(0,i._)([(0,y.MZ)()],C.prototype,"tablesAndLayersLookup",void 0),(0,i._)([(0,y.MZ)()],C.prototype,"additionalLayers",void 0),(0,i._)([(0,y.MZ)()],C.prototype,"updating",null),(0,i._)([(0,y.MZ)()],C.prototype,"_allLayersAndTables",null),C=(0,i._)([(0,v.$)("esri.undoredo.support.Services")],C)},14387:(e,t,n)=>{n.d(t,{Gx:()=>f,kk:()=>u});var i=n(87540),r=n(76099),s=n(54761);const o="esri-item-list",a=`${o}__list-item`,l={base:o,filterContainerSticky:`${o}__filter-container--sticky`,group:`${o}__group`,groupHeader:`${o}__group__header`,item:a,itemDisabled:`${a}--disabled`,itemIcon:`${a}-icon`,itemContentEnd:`${a}-content-end`,noMatchesMessage:`${o}__no-matches-message`,scroller:`${o}__scroller`,scrollerEnabled:`${o}__scroller--enabled`},d=4;function u(e){const{disabled:t,filterText:n="",id:i,messages:r,onFilterChange:o,...a}=e;return(0,s.K)("div",{key:i},e.filterEnabled??1?p({disabled:t,filterText:n,id:i,messages:r,onFilterChange:o}):null,c({...a,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:n,messages:r}))}function c(e){const{headingLevel:t,items:n,...i}=e;return 0===n.length?(0,s.K)("div",{class:l.noMatchesMessage,key:"no-matches"},e.messages.noMatches):(0,s.K)("div",{class:(0,r.Ly)({[l.scroller]:!0,[l.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},n.map((e=>function(e){return!!e.items}(e)?y({...i,group:e,headingLevel:t}):f({...i,grouped:!0,item:e}))))}function p(e){const{disabled:t,messages:n,filterText:i,enableListScroll:r}=e;return(0,s.K)("div",{class:r?void 0:l.filterContainerSticky,key:"filter"},(0,s.K)("calcite-input",{disabled:t,placeholder:n.filterPlaceholder,type:"search",value:i,onCalciteInputInput:t=>{const n=t.currentTarget;e.onFilterChange&&e.onFilterChange(n.value)}}))}function f(e){const{disabled:t,grouped:n,identify:i,item:o,onItemMouseEnter:a,onItemMouseLeave:d,onItemSelect:u,renderIcon:c,renderCustomItem:p,renderItemContent:f,renderItemContentEnd:y,renderItemLabel:v,renderItemDescription:g,renderItemActionEnd:b,renderItemTitle:_,selectedItem:I}=e,w=h(o,i),M=w===h(I,i),S=p?.(e);if(S)return S;const T=f?.(o),A=y?.(o),L=b?.(o),Z=!(!o.disabled&&!t),C=c?.(o);return(0,s.K)("calcite-list-item",{afterUpdate:e=>{e.selected=M},"aria-level":n?"2":"",class:(0,r.Ly)({[l.item]:!0,[l.itemDisabled]:Z}),"data-item":o,description:T?void 0:g?.(o)??void 0,disabled:Z,key:w,label:T?void 0:v?.(o)??o.label??void 0,onblur:e=>d?.(m(e)),onfocus:e=>a?.(m(e)),onmouseenter:e=>a?.(m(e)),onmouseleave:e=>d?.(m(e)),selected:M,title:_?.(o)??void 0,onCalciteListItemSelect:e=>{e.preventDefault(),u?.(m(e))}},C?(0,s.K)("div",{class:l.itemIcon,key:"content-start",slot:"content-start"},C):void 0,T?(0,s.K)("div",{key:"content",slot:"content"},T):null,A?(0,s.K)("div",{class:l.itemContentEnd,key:"content-end",slot:"content-end"},A):null,L??null)}function h(e,t){return e?`${t?.(e)||e.id}__${e.label}`:""}function m(e){return e.currentTarget["data-item"]}function y(e){const{disabled:t,group:n,headingLevel:r=d,selectionMode:o="none",renderCustomGroupContent:a,...u}=e,c=a?.(e);return(0,s.K)("div",{class:l.group,key:n.label??void 0},(0,s.K)(i.D,{class:l.groupHeader,level:r},n.label),c||(0,s.K)("calcite-list",{disabled:t,label:n.label??"",selectionAppearance:"border",selectionMode:o},n.items.map((e=>f({...u,disabled:t,item:e,grouped:!0})))))}},25647:(e,t,n)=>{function i(e){return"feature"===e.type}function r(e){return"group"===e.type}function s(e){return"preset"===e.type}n.d(t,{Xc:()=>r,sC:()=>i,vf:()=>s})},42062:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(35143),r=n(68134),s=n(46053),o=(n(81806),n(76460),n(47249),n(85842)),a=n(31933),l=n(25329),d=n(91656),u=n(87539),c=n(91967);let p=class extends c.default{constructor(e){super(e),this.filter=!0}};(0,i._)([(0,s.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"filter",void 0),p=(0,i._)([(0,o.$)("esri.widgets.FeatureTemplates.VisibleElements")],p);const f=p;var h=n(94126),m=n(98108),y=n(14387),v=n(89025),g=(n(76099),n(63582)),b=n(12254),_=n(54761);const I="esri-feature-templates";function w(e){return e.id}let M=class extends l.default{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new u.default,this.visibleElements=new f,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const n=e.target;if(function(e){return!!e?.["data-has-icon"]}(n))return void t.unobserve(n);const i=function(e){return e?.["data-item"]}(n),{layer:r,template:s}=i;S(n,!0);const o=await(0,v.z)(s,r).catch((()=>(S(n,!1),null)));if(null==o)return;n.appendChild(o)}}))})),this._renderItemIcon=e=>(0,a.bI)(e.layer)?(0,_.K)("span",{"data-has-icon":!0,"data-item":e,key:"icon"},(0,_.K)("calcite-icon",{icon:"table"})):(0,_.K)("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=e=>{let{label:t}=e;return!this.filterText||!!t?.toLowerCase().includes(this.filterText.toLowerCase())};this.addHandles((0,r.watch)((()=>this.viewModel),((t,n)=>{t&&!t.filterFunction&&(this.filterFunction=e),n&&n!==t&&n.filterFunction===e&&(n.filterFunction=null)}),r.initial))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return(0,h.W)({icon:()=>Promise.resolve().then(n.bind(n,16702)),loader:()=>Promise.resolve().then(n.bind(n,35688)),input:()=>Promise.resolve().then(n.bind(n,38841)),list:()=>Promise.resolve().then(n.bind(n,75802)),"list-item":()=>Promise.resolve().then(n.bind(n,70205)),notice:()=>n.e(12261).then(n.bind(n,12261))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:n,headingLevel:i,messages:r,viewModel:{items:s,numberOfFeatureTemplates:o,selectedItem:a,state:l}}=this,u=this.visibleElements.filter&&o>1;if(function(e){return e.length>0&&(0,d.X6)(e[0])}(s)){const e=s.find((e=>e.label===d._t.label));e&&(e.label=r.other)}return(0,_.K)("div",{"aria-label":r.widgetLabel,class:this.classes(I,m.D.widget)},"loading"===l?(0,_.K)("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):"ready"===l?(0,_.K)(y.kk,{disabled:e,enableListScroll:t,filterEnabled:u,filterText:n,headingLevel:i,id:this.id,identify:w,items:s,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:a??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e},onItemSelect:e=>!(0,d.X6)(e)&&this.viewModel.select(e)}):null)}};function S(e,t){e&&(e["data-has-icon"]=t)}(0,i._)([(0,s.MZ)()],M.prototype,"disabled",null),(0,i._)([(0,s.MZ)()],M.prototype,"enableListScroll",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"filterFunction",null),(0,i._)([(0,s.MZ)()],M.prototype,"filterText",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"groupBy",null),(0,i._)([(0,s.MZ)()],M.prototype,"headingLevel",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"icon",null),(0,i._)([(0,s.MZ)()],M.prototype,"label",null),(0,i._)([(0,s.MZ)()],M.prototype,"layers",null),(0,i._)([(0,s.MZ)(),(0,g.G)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],M.prototype,"messages",void 0),(0,i._)([(0,s.MZ)(),(0,g.G)("esri/t9n/common")],M.prototype,"messagesCommon",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],M.prototype,"selectedItem",null),(0,i._)([(0,s.MZ)()],M.prototype,"selectionMode",void 0),(0,i._)([(0,s.MZ)(),(0,b.U)("select")],M.prototype,"viewModel",void 0),(0,i._)([(0,s.MZ)({type:f,nonNullable:!0})],M.prototype,"visibleElements",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderCustomItem",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderCustomGroupContent",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderItemLabel",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderItemDescription",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderItemContent",void 0),(0,i._)([(0,s.MZ)()],M.prototype,"renderItemContentEnd",void 0),M=(0,i._)([(0,o.$)("esri.widgets.FeatureTemplates")],M);const T=M},66938:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(35143),r=n(91967),s=n(5632),o=n(46053),a=(n(81806),n(76460),n(47249),n(85842));let l=class extends(s.A.IdentifiableMixin(r.default)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find((t=>t.template===e))}};(0,i._)([(0,o.MZ)()],l.prototype,"allItems",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"filterFunction",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"items",null),(0,i._)([(0,o.MZ)()],l.prototype,"label",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"id",null),l=(0,i._)([(0,a.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],l);const d=l},87539:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(35143),r=n(98773),s=n(54099),o=n(30726),a=n(50346),l=n(68134),d=n(46053),u=(n(81806),n(76460),n(47249),n(85842)),c=n(19451),p=n(5600),f=n(31933),h=n(91656),m=n(91913),y=n(66938);const v=e=>{let{layer:t}=e;return{key:t,label:t.title??""}},g=e=>{let{layer:t}=e;return{key:t.geometryType,label:t.geometryType??""}};let b=class extends s.A.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new c.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,l.watch)((()=>[this.templateInfos,this.layers]),((e,t)=>{let[n]=e;n&&n===t?.at(0)||(this._updateTask=(0,o.DC)(this._updateTask),n?this._updateAllItems(n):this._getTemplatesAndUpdateAllItems())}),l.syncAndInitial),(0,l.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,o.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),l.sync),(0,l.watch)((()=>this.filterFunction),(e=>{for(const t of this._allItems)(0,h.X6)(t)&&(t.filterFunction=e)}),l.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=v;break;case"geometry":this._groupByFunction=g;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map((e=>(0,l.when)((()=>e.loadStatus),n))),t)}this._set("layers",e)}get state(){return this.updating?"loading":0!==this.layers.length||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((e,t)=>(0,h.X6)(t)?e+t.allItems.length:e+1),0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter((t=>(0,h.X6)(t)?t.items.length>0:e(t)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)(0,h.X6)(e)&&e.reapplyFilter()}select(e){let{emit:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.selectedItem,i=e?.clone()||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:n,template:i?.template??null})}_createItem(e,t){return new m.default({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if((0,h.X6)(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[n,i]=(0,h.K_)(t),r=e=>{const t=n.get(e.template);return t?(n.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:s}=this,o=e.filter(_).map((e=>(0,h.wu)(e)?new y.default({filterFunction:s,label:e.label,allItems:e.templateInfos.filter(_).map((e=>r(e)))}):r(e)));for(const a of[...n.values(),...i])a.destroy();this._allItems=o}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map((async i=>{await(0,h.JS)(i,n),(0,a.throwIfAborted)(e);const r=(0,f.BR)(i)?.operations;r?.supportsEditing&&r?.supportsAdd&&((0,f.F2)(i)?t.push(...i.sublayers):t.push(i))})));const i=await(0,p.b)(t,this.view,e);(0,a.throwIfAborted)(e);const r=(0,h.zA)(i),s=this._groupByFunction;if(null==s)return r;const o=(0,h.AY)(r,s);return 1===o.length&&o[0].label===h._t.label?o[0].templateInfos:o}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=(0,r.UT)((async e=>{const t=await this._getTemplatesFromLayers(e);(0,a.throwIfAborted)(e),this._updateAllItems(t)}));this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function _(e){return(0,h.wu)(e)?e.templateInfos.some(_):!(0,p.w2)(e.template)||!1!==e.template.visible}(0,i._)([(0,d.MZ)()],b.prototype,"_allItems",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"_groupByFunction",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"_updatingHandles",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"disabled",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"disabledItemFunction",void 0),(0,i._)([(0,d.MZ)({value:null})],b.prototype,"filterFunction",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"groupBy",null),(0,i._)([(0,d.MZ)({value:[]})],b.prototype,"layers",null),(0,i._)([(0,d.MZ)()],b.prototype,"state",null),(0,i._)([(0,d.MZ)({readOnly:!0})],b.prototype,"numberOfFeatureTemplates",null),(0,i._)([(0,d.MZ)({readOnly:!0})],b.prototype,"items",null),(0,i._)([(0,d.MZ)({readOnly:!0})],b.prototype,"selectedItem",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"templateInfos",void 0),(0,i._)([(0,d.MZ)()],b.prototype,"updating",null),(0,i._)([(0,d.MZ)()],b.prototype,"view",void 0),b=(0,i._)([(0,u.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],b);const I=b},89025:(e,t,n)=>{n.d(t,{z:()=>l});var i=n(39356),r=n(76931),s=n(5600),o=n(85632),a=n(8503);async function l(e,t,n){if(!(0,o.DU)(e)&&(0,s.Rj)(e)&&e.thumbnail){const n=`data:image/png;base64,${e.thumbnail.imageData}`,i=document.createElement("div");return i.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&i.classList.add(`esri-thumbnail-preview--${t.geometryType}`),i.style.backgroundImage=`url(${n})`,i}const i=await d(t,e);if(null==i)return null;const l={maxSize:(0,r.PN)(n?.maxSize??32)};if(((0,o.DU)(e)||(0,s.gZ)(e))&&"renderer"in t&&"dictionary"===t.renderer?.type&&(l.fieldMap=t.renderer.fieldMap??void 0,l.feature=(0,o.DU)(e)?e:{attributes:e.prototype.attributes??{}}),(0,o.DU)(e)&&e.geometry&&!1!==n?.useGeometry&&!e.geometry.type.includes("point")){l.geometry=e.geometry,l.useMarkerSymbolSize=!1;const t=(0,r.PN)(n?.maxSize??22);l.size={width:t,height:t}}return await(0,a.renderPreviewHTML)(i,l)}async function d(e,t){if(!(0,o.DU)(t)&&(0,s.Rj)(t))return u(e);if("renderer"in e&&e.renderer){const{renderer:n}=e,r=(0,o.DU)(t)?t:new i.default({attributes:t.prototype.attributes});if("getSymbolAsync"in n){const e=await n.getSymbolAsync(r);if(e)return e}}return u(e)}async function u(e){if(!("geometryType"in e))return null;const{geometryType:t}=e,i="point"===t||"multipoint"===t?await Promise.resolve().then(n.bind(n,76940)):"polyline"===t?await Promise.resolve().then(n.bind(n,38996)):"polygon"===t||"mesh"===t||"multipatch"===t?await Promise.resolve().then(n.bind(n,86875)):null;return i?new i.default:null}},91656:(e,t,n)=>{n.d(t,{AY:()=>a,Ex:()=>l,JS:()=>d,K_:()=>u,X6:()=>c,_t:()=>r,wu:()=>s,zA:()=>o});var i=n(87663);const r={key:Symbol(),label:"Other\u200b"};function s(e){return"templateInfos"in e}function o(e){const t=[];for(const{layer:n,templates:i}of e)for(const e of i)t.push({layer:n,template:e});return t}function a(e,t){const n=new Map;for(const s of e){const e=t(s),{key:o,label:a}=null!=e.key?e:r;(0,i.tE)(n,o,(()=>({label:a,templateInfos:[]}))).templateInfos.push(s)}return Array.from(n.values())}function l(e,t){return{label:e.title??"",templateInfos:t.map((t=>({layer:e,template:t})))}}async function d(e,t){return"subtype-sublayer"===e.type?await(e.parent?.load(t)):await e.load(t),e}function u(e){const t=new Map,n=[];for(const i of e)if(c(i)){n.push(i);for(const e of i.items)t.set(e.template,e)}else t.set(i.template,i);return[t,n]}const c=e=>"items"in e},91913:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i,r=n(35143),s=n(91967),o=n(68134),a=n(46053),l=(n(81806),n(76460),n(47249),n(85842));let d=i=class extends s.default{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,o.watch)((()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),o.initial))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}\u2013${this.layer?.id}`}get supportsUpload(){return"scene"===this.layer?.type}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new i({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};(0,r._)([(0,a.MZ)()],d.prototype,"description",null),(0,r._)([(0,a.MZ)()],d.prototype,"disabled",null),(0,r._)([(0,a.MZ)()],d.prototype,"disabledFunction",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"label",null),(0,r._)([(0,a.MZ)()],d.prototype,"layer",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"template",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"thumbnail",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"id",null),(0,r._)([(0,a.MZ)()],d.prototype,"supportsUpload",null),d=i=(0,r._)([(0,l.$)("esri.widgets.FeatureTemplates.TemplateItem")],d);const u=d},96422:(e,t,n)=>{n.d(t,{Kw:()=>s,RE:()=>a,Sl:()=>o});var i=n(55171),r=n(3825);async function s(e,t,n){const s=i.id?.findCredential(e.restUrl);if(!s)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const o={responseType:"json",query:{f:"json"}};if(n&&(o.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,r.default)(e.restUrl+"/community/self",o);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await(0,r.default)(e.restUrl+"/community/users/"+t,o);if(a.data){const e=a.data;return e.error?null:e}return null}async function o(e,t,n){const i=await s(e,t,!0);return i?.privileges?.includes(n)??!1}async function a(e,t,n){const i=await s(e,t,!0);return i?.userLicenseTypeExtensions?.includes(n)??!1}}}]);
//# sourceMappingURL=42062.b2208f27.chunk.js.map