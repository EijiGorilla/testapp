"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[36201,75166,89040],{770:(e,t,a)=>{a.d(t,{bG:()=>i,Ty:()=>l,YJ:()=>c,Fq:()=>m,vt:()=>o});var r=a(53084),s=a(42633);class n{constructor(e){const{name:t,label:a,description:r,schemes:n}=e;this.name=t,this.label=a,this.description=r,this.schemes=n;const i=e.basemapGroups||s.Np;let o=[];Object.keys(i).forEach((e=>{o=o.concat(i[e])})),this.supportedBasemaps=o,this.basemapGroups=i}isBasemapSupported(e){const t=(0,s.T1)(e,this.supportedBasemaps);return!(!t||!this.supportedBasemaps.includes(t))}getRawSchemes(e){const{basemapId:t,basemapTheme:a}=function(e,t,a){let r=null,n=null;if(t&&(r=(0,s.T1)(t,e,!1),r)){const e=(0,s.BV)(r);null!=e&&(n=e)}return!r&&a&&(r="dark"===a?"dark-gray":"gray",n=a),r||n||(r="gray",n="light"),{basemapId:r,basemapTheme:n}}(this.supportedBasemaps,e.basemap,e.basemapTheme);let n=a;if(t){const e=(0,s.BV)(t,this.basemapGroups);null!=e&&(n=e)}let i=e.geometryType;"multipoint"===i?i="point":"mesh"===i&&(i="polygon");const o=this.schemes[i]||this.schemes.default;return{schemesInfo:(0,r.clone)(o[n]),basemapId:t,basemapTheme:a}}}function i(e){const t=e.themeDictionary,a=new Map;for(const r in t){const e=t[r];a.set(r,new n(e))}return a}function o(e,t){const a=[];return e.forEach((e=>{e.isBasemapSupported(t)&&a.push({name:e.name,label:e.label,description:e.description,basemaps:[...e.supportedBasemaps]})})),a}function l(e,t){if(!e)return;if(!t)return;let a=null;const r=[t.primaryScheme,...t.secondarySchemes];for(const s of r)if(s.name?.toLowerCase()===e.toLowerCase()){a=s;break}return a}function c(e,t,a){if(!e&&!t)return[];if(!a)return[];const r=!e?.length,s=!t?.length,n=[a.primaryScheme,...a.secondarySchemes],i=[];for(const o of n){const a=!!r||e.some((e=>o.tags.includes(e))),n=!s&&t.some((e=>o.tags.includes(e)));a&&!n&&i.push(o)}return i}function m(e){const t=e.theme;if(t)return t.getRawSchemes({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme})}},29310:(e,t,a)=>{a.r(t),a.d(t,{createRasterLayerAdapter:()=>x,getDefaultBandCombination:()=>R,getSupportedRendererInfo:()=>I,processRasterRendererParameters:()=>T});var r=a(50076),s=a(78937),n=a(35143),i=a(46053),o=(a(81806),a(76460),a(47249),a(85842)),l=a(19247),c=a(86866),m=a(46570),u=a(49304),p=a(53521);let h=class extends u.A{constructor(){super(...arguments),this.type="raster-layer-adapter",this._statsCache=new p.q(20)}get serviceRasterInfo(){return this.rasterInfo}async updateRasterInfo(e){this.rasterInfo=await this.generateRasterInfo(e),this.rasterFunction=e?.rasterFunction}async updateRasterInfoWithEstimatedStats(e,t){const a=await this.estimateStatisticsHistograms(t);a?.statistics&&(e.statistics=a.statistics),a?.histograms&&(e.histograms=a.histograms)}};(0,n._)([(0,i.MZ)()],h.prototype,"layer",void 0),(0,n._)([(0,i.MZ)()],h.prototype,"serviceRasterInfo",null),(0,n._)([(0,i.MZ)()],h.prototype,"rasterInfo",void 0),(0,n._)([(0,i.MZ)()],h.prototype,"rasterFunction",void 0),(0,n._)([(0,i.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,n._)([(0,i.MZ)()],h.prototype,"version",void 0),h=(0,n._)([(0,o.$)("esri.smartMapping.raster.support.adapters.RasterLayerAdapter")],h);const d=h;let f=class extends d{generateRasterInfo(e){const t=e?.rasterFunction;try{return this.layer.generateRasterInfo(t,{signal:e?.signal})}catch{return Promise.resolve(this.layer.serviceRasterInfo)}}async estimateStatisticsHistograms(e){const{layer:t}=this,a=t.mosaicRule?.multidimensionalDefinition?.[0]?.variableName??"",r=`${e?.rasterFunction?.functionName??"default"}${a}`,s=this._statsCache.get(r);if(s)return s;let{width:n,height:i,pixelSize:o}=t.rasterInfo,u=1;for(;n>2e3||i>2e3;)n/=2,i/=2,u*=2;const p=e?.rasterFunction??t.rasterFunction,{fullExtent:h,mosaicRule:d}=t;o=new l.default(o.x*u,o.y*u,h.spatialReference);const f=new m.default({geometry:h,pixelSize:o,renderingRule:p,mosaicRule:d});let y;if(t.capabilities.operations.supportsComputeStatisticsHistograms)y=await t.computeStatisticsHistograms(f,e);else{const{histograms:a}=await t.computeHistograms(f,e);y={statistics:(0,c.Pg)(a),histograms:a}}return y&&this._statsCache.put(r,y),y}supportsMultidirectionalHillshade(){return this.layer.version>=10.81}load(e){return this.addResolvingPromise(this.layer.load(e).then((()=>{this.generateRasterInfo({rasterFunction:this.rasterFunction,signal:e?.signal}).then((e=>this.rasterInfo=e))}))),Promise.resolve(this)}};(0,n._)([(0,i.MZ)()],f.prototype,"layer",void 0),f=(0,n._)([(0,o.$)("esri.smartMapping.raster.support.adapters.ImageryLayerAdapter")],f);const y=f;var g=a(76797);let b=class extends d{async generateRasterInfo(e){const{layer:t}=this,a=e?.rasterFunction;if("imagery-tile"===t.type&&a)try{return await t.generateRasterInfo(a,{signal:e?.signal})}catch{return t.serviceRasterInfo}return this.rasterInfo}async estimateStatisticsHistograms(e){const{layer:t}=this,a=t.multidimensionalDefinition?.[0]?.variableName??"",s=`${t.rasterFunction?.functionName??"default"}${a}`,n=this._statsCache.get(s);if(n)return n;const{raster:i}=t,{extent:o,width:l,height:m}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const{pyramidScalingFactor:a,maximumPyramidLevel:r}=e.storageInfo;let{extent:s,width:n,height:i,pixelSize:o}=e,l=Math.max(0,Math.ceil(Math.log(Math.max(n,i)/t)/Math.log(a))-1),c=0,m=0;if(l<=r){const e=a**l;n=Math.floor(n/e),i=Math.floor(i/e)}else l=0,n=Math.min(n,t),i=Math.min(i,t),c=Math.max(Math.floor(n/2-500),0),m=Math.max(Math.floor(i/2-500),0),s=new g.default({xmin:s.xmin+c*o.x,xmax:Math.min(s.xmax,s.xmin+c*o.x*t),ymin:s.ymin+m*o.y,ymax:Math.min(s.ymax,s.ymin+m*o.y*t)});return{extent:s,width:n,height:i,origin:{x:c,y:m}}}(i.rasterInfo),{pixelBlock:u}=await t.fetchPixels(o,l,m,e);if(null==u)throw new r.default("raster-layer-adapter","Unable to estimate histograms");const p=(0,c.f4)(u);return p&&this._statsCache.put(s,p),p}supportsMultidirectionalHillshade(){return!0}load(e){return this.addResolvingPromise(this.layer.load(e).then((()=>this.rasterInfo=this.layer.raster.rasterInfo))),Promise.resolve(this)}};(0,n._)([(0,i.MZ)()],b.prototype,"layer",void 0),b=(0,n._)([(0,o.$)("esri.smartMapping.raster.support.adapters.ImageryTileLayerAdapter")],b);const w={imagery:{adapter:y,label:"ImageryLayer"},"imagery-tile":{adapter:b,label:"ImageryTileLayer"},wcs:{adapter:b,label:"WCSLayer"}},S={"raster-stretch":"raster-stretch","unique-value":"raster-unique-value","raster-rgb":"raster-rgb","class-breaks":"raster-class-breaks","raster-colormap":"raster-colormap","raster-shaded-relief":"raster-shaded-relief","vector-field":"raster-vector-field",flow:"raster-flow"},v=Object.keys(w).map((e=>w[e].label));function x(e){if("raster-layer-adapter"===e.type)return e;const t=w[e.type]?.adapter;return null==t?null:new t({layer:e})}async function I(e){const t=x((e=await T(e)).layer),a=await t.generateRasterInfo(e),r=(0,s.fp)(a,!0).map((e=>S[e])),n=t.layer,i="imagery-tile"===n.type?(0,s.Mm)(n.raster):void 0,o="wcs"!==n.type?n.presetRenderers:void 0,l=(0,s.I8)({variableName:e.variableName,rasterFunctionName:e.rasterFunction?.functionName,presetRenderers:o}),c=l?.renderer??(0,s.PD)(a,{rasterFunctionColorRamp:i,variableName:e.variableName}),{bandCount:m}=a;return m>1&&r.push("raster-rgb"),!r.includes("raster-class-breaks")&&1===m&&+t.layer?.version>=10.3&&r.push("raster-class-breaks"),{supportedTypes:r,defaultRenderer:c}}async function R(e){const t=x((e=await T(e)).layer),a=await t.generateRasterInfo(e),{layer:r}=t;if("wcs"!==r.type&&r.presetRenderers?.length){const t=(0,s.I8)({variableName:e.variableName,rasterFunctionName:e.rasterFunction?.functionName,presetRenderers:r.presetRenderers});if(t?.bandIds?.length)return t.bandIds}return(0,s.ci)(a)}async function T(e){const{layer:t}=e;if(!t)throw new r.default("raster-renderer-creator:missing-parameters","'layer' parameter is required");const a=x(t);if(null==a)throw new r.default("raster-renderer-creator:invalid-parameters","'layer' must be one of these types: "+v.join(", "));await a.load();const s=e.rasterFunction??e.renderingRule??t.rasterFunction;return await a.updateRasterInfo({rasterFunction:s,signal:e.signal}),{...e,layer:a,rasterFunction:s}}},80791:(e,t,a)=>{a.d(t,{_J:()=>c,_t:()=>l});var r=a(76931),s=a(42633);const n=s.Np.light,i=s.Np.dark;function o(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}function l(e,t){let a=0;if(e.length===t.length){let r=e.every(((e,a)=>o(e,t[a])));r?a=1:(r=e.slice().reverse().every(((e,a)=>o(e,t[a]))),r&&(a=-1))}return a}function c(e,t){return Math.ceil(function(e){const t=e.width,a=e.height;let s=e.pixelSizeAt(e.toMap((0,r.tc)(.5*t,.5*a),{exclude:[]}));if(s<=0&&(s=e.pixelSizeAt(e.toMap((0,r.tc)(.5*t,.95*a),{exclude:[]})),s<=0&&"camera"in e)){const t=e.camera.position.clone();t.z=0,s=2*e.pixelSizeAt(t)}return s}(t)*(0,r.Lz)((0,r.cr)(e)))}},90127:(e,t,a)=>{a.r(t),a.d(t,{createRenderer:()=>S});var r=a(59784),s=a(50076),n=a(9922),i=a(45430),o=a(78937),l=a(84563),c=a(64694),m=a(48548),u=a(43996),p=a(77718),h=a(14776),d=a(63040),f=a(29310),y=a(51006),g=a(95248);const b=5;async function w(e,t){t.flowRepresentation&&(e.flowRepresentation=t.flowRepresentation);const a=await async function(e){let t=e.flowScheme,a=null,r=null;const s=await(0,y.Ib)(null,e.view);if(a=null!=s.basemapId?s.basemapId:null,r=null!=s.basemapTheme?s.basemapTheme:null,t)return{scheme:(0,g.cloneScheme)(t),basemapId:a,basemapTheme:r};const n=(0,g.getSchemes)({basemapTheme:r,theme:e.theme,hasSizeVariable:e.hasSizeVariable});return n&&(t=n.primaryScheme,a=n.basemapId,r=n.basemapTheme),{scheme:t,basemapId:a,basemapTheme:r}}({theme:t.theme,flowScheme:t.flowScheme,view:t.view,hasSizeVariable:t.includeSizeVariable}),f=a.scheme;if(!f)throw new s.default("flow-renderer:insufficient-info","Unable to find flow scheme");e.flowSpeed=f.flowSpeed,e.density=f.density,e.trailLength=f.trailLength,e.trailWidth=f.trailWidth,e.trailCap=f.trailCap,e.color=f.color;const w=[],S=[],v="Magnitude",x=t.layer.serviceRasterInfo,I=null==x?.statistics||"vector-magdir"!==x.dataType&&"vector-uv"!==x.dataType?{minMagnitude:0,maxMagnitude:10}:(0,o.iG)(x.dataType,x.statistics);if(null==I?.minMagnitude||null==I.maxMagnitude)throw new s.default("flow-renderer:insufficient-info","stats not available");const R={min:I.minMagnitude,max:I.maxMagnitude},T={min:R.min,max:null!=R.max?R.max/2:null},M=(0,y.Gc)(T,null,null),z=(0,y.TQ)(M,T,null);if(t.includeColorVariable){const e=(0,r.Iy)(f.colors,b);if(e.length<b)throw new s.default("flow-renderer:insufficient-info","Flow scheme does not have enough colors");const t=new c.default({field:v,stops:z.map(((t,a)=>new p.default({value:t,color:e[a]})))});w.push(t);const a=new i.default({type:"color",minSliderValue:R.min,maxSliderValue:R.max,theme:"high-to-low"});S.push(a)}if(t.includeOpacityVariable){const e=new m.default({field:v,stops:[new h.default({value:z[0],opacity:f.minOpacity}),new h.default({value:z[4],opacity:f.maxOpacity})]});w.push(e);const t=new i.default({type:"opacity",minSliderValue:R.min,maxSliderValue:R.max});S.push(t)}if(t.includeSizeVariable){const e=new u.default({field:v,stops:[new d.default({value:R.min,size:f.minSize}),new d.default({value:R.max,size:f.maxSize})]});w.push(e);const t=new i.default({type:"size",minSliderValue:R.min,maxSliderValue:R.max,theme:"high-to-low"});S.push(t)}const F=new n.default({type:"flow",visualVariables:S.length?S:void 0,flowTheme:f.theme});return e.visualVariables=w,e.authoringInfo=F,e.legendOptions=l.A.from(t.legendOptions),{renderer:e,visualVariables:w.map((e=>e.clone())),flowScheme:(0,g.cloneScheme)(f),basemapId:a.basemapId,basemapTheme:a.basemapTheme,layerEffect:f.layerEffect,statistics:R}}async function S(e){e=await async function(e){const t={...e};return t.theme||(t.theme="flow-line"),(0,f.processRasterRendererParameters)(t)}(e);const t=(0,o.un)(e.layer.serviceRasterInfo);if(null==t)throw new s.default("flow-renderer:not-supported","Only vector data is supported");return w(t,e)}},95248:(e,t,a)=>{a.r(t),a.d(t,{cloneScheme:()=>g,getSchemeByName:()=>f,getSchemes:()=>d,getSchemesByTag:()=>y,getThemes:()=>h});var r=a(69539),s=a(18690),n=a(39289),i=a(89132),o=a(770);const l={color:"#4c64c9",density:.8,layerEffect:"drop-shadow(1px, 1px, 3px, rgba(0,0,0,0.75))"},c={color:"#00ffff",density:.8,layerEffect:"bloom(1.4, 0.6px, 0)"},m={flowSpeed:10,trailLength:100,trailWidth:1,trailCap:"butt",minSize:1,maxSize:4},u={flowSpeed:3,trailLength:.7,trailWidth:8,trailCap:"butt",minSize:4,maxSize:16},p=(0,o.bG)({themeDictionary:{"flow-line":{name:"flow-line",label:"TODO",description:"TODO",schemes:{default:{light:{common:{...m,...l},primary:"seq-lines-purple-brown",secondary:[...n.sequentialLightSchemes,...n.sequentialDarkSchemes].filter((e=>"seq-lines-purple-brown"!==e))},dark:{common:{...m,...c},primary:"seq-mentone-beach",secondary:[...n.sequentialDarkSchemes,...n.sequentialLightSchemes].filter((e=>"seq-mentone-beach"!==e))}}}},"wave-front":{name:"wave-front",label:"TODO",description:"TODO",schemes:{default:{light:{common:{...u,...l},primary:"seq-lines-purple-brown",secondary:[...n.sequentialLightSchemes,...n.sequentialDarkSchemes].filter((e=>"seq-lines-purple-brown"!==e))},dark:{common:{...u,...c},primary:"seq-mentone-beach",secondary:[...n.sequentialDarkSchemes,...n.sequentialLightSchemes].filter((e=>"seq-mentone-beach"!==e))}}}}}});function h(e){return(0,o.vt)(p,e)}function d(e){const t=e.theme||"flow-line",a=(0,o.Fq)({basemap:e.basemap,basemapTheme:e.basemapTheme,theme:p.get(t)});if(!a)return;const{schemesInfo:r,basemapId:n,basemapTheme:i}=a,l=r.common,c={...e,basemap:n};return{primaryScheme:b(c,r.primary,l),secondarySchemes:r.secondary.map((e=>b(c,e,l))).filter(s.Ru),basemapId:n,basemapTheme:i}}function f(e){return(0,o.Ty)(e.name,d(e))}function y(e){return(0,o.YJ)(e.includedTags,e.excludedTags,d(e))}function g(e){if(!e)return;const t={...e};return t.colors=t.colors.map((e=>new r.default(e))),t.tags=[...t.tags],t.color&&(t.color=new r.default(t.color)),t}function b(e,t,a){const s=e.theme||"flow-line",n=i.A[t];if(!n)return;const o=n.stops;return{id:`${s}/${e.basemap}/${t}`,name:n.name,tags:[...n.tags],theme:s,color:new r.default(a.color),colors:o.map((e=>new r.default(e))),density:a.density,flowSpeed:a.flowSpeed,trailLength:"wave-front"===s&&e.hasSizeVariable?2*a.trailLength:a.trailLength,trailWidth:a.trailWidth,trailCap:a.trailCap,layerEffect:a.layerEffect,minSize:a.minSize,maxSize:a.maxSize,minOpacity:.25,maxOpacity:1}}}}]);
//# sourceMappingURL=36201.ebd636f1.chunk.js.map