{"version":3,"file":"static/js/12718.8b418917.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/knowledgeGraph/KnowledgeGraphLayerDataManager.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import i from\"../../core/Error.js\";import n from\"../../core/Logger.js\";import{getOrCreateMapValue as o}from\"../../core/MapUtils.js\";import{createAbortError as s}from\"../../core/promiseUtils.js\";import{parseWhereClause as a}from\"../../core/sql.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import d from\"../../geometry/Extent.js\";import l from\"../../geometry/Polygon.js\";import{initializeProjection as m,project as h}from\"../../geometry/projection.js\";import{wgs84 as c}from\"../../geometry/support/spatialReferenceUtils.js\";import{systemOidFieldName as y,systemOriginIdFieldName as u,systemDestinationIdFieldName as f,systemIsSpatialFieldName as g,systemLayoutGeometryFieldName as b}from\"./constants.js\";import w from\"./SessionMemoryStorage.js\";import{utilsExtentToInBoundsRings as T}from\"./supportUtils.js\";import{executeQueryStreaming as I}from\"../../rest/knowledgeGraphService.js\";import M from\"../../rest/knowledgeGraph/GraphQueryStreaming.js\";import D from\"../../rest/support/Query.js\";let E=class extends t{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((i=>{i.name&&(t.set(i.name,\"entity\"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&\"esriGeometryNull\"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??\"\",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((i=>{i.name&&(t.set(i.name,\"relationship\"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&\"esriGeometryNull\"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??\"\",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,s)=>{if(\"entity\"===t.get(s))this.entityTypeNames.add(s);else{if(\"relationship\"!==t.get(s))return n.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(s);this.relationshipTypeNames.add(s)}const a=new Map;i.members?.forEach((e=>{o(this.memberIdTypeLookup,e.id,(()=>new Set)).add(s);const t=this.getById(e.id);t&&a.set(e.id,t)})),this.sublayerCaches.set(s,a)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new i(\"knowledge-graph:layer-data-manager\",\"You cannot add to a layer's exclusion list if it was not created with an exclusion list originally\");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(e);i.members||(i.members=new Map),i.members.set(t,{id:t}),o(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const i=new Map;i.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:i}),o(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return w.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new D({where:\"1=1\",outFields:[\"*\"]}),\"link-chart\"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(t.objectType.name??\"\"),o=n.outFields;o&&1===o.length&&o[0]===y&&\"1=1\"===n.where||await Promise.all(i??[]);const s=this.sublayerCaches.has(t.objectType.name??\"\")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],a=[];return s.forEach((i=>{if(this.relationshipTypeNames.has(t.objectType.name)){i.geometry=e.relationshipLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.memberIdTypeLookup.get(i.attributes[u]),o=this.memberIdTypeLookup.get(i.attributes[f]),s=this._isEndEntitySpatial(n,i,u),a=this._isEndEntitySpatial(o,i,f);i.attributes[g]=Number(s&&a)}else{i.geometry=e.entityLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.geographicLookup.get(t.objectType.name);n&&i.attributes[n.name]?i.attributes[g]=1:i.attributes[g]=0}i.attributes[b]=i.geometry,a.push(i)})),a}return this.retrieveDataFromService(n,t,i)}async getConnectedRecordIds(e,t,i){const n=[];let o=\"\";const s=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)o=o+e+\"|\";o=o.slice(0,-1)}const a={},r=[];for(const[l,m]of s){const e=`${l}_ids`;a[e]=m,t&&0!==t?.length?r.push(`MATCH (n:${l}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r:${o}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):r.push(`MATCH (n:${l}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!r.length)return n;const p=r.join(\" UNION \"),d=(await I(this.knowledgeGraph,new M({openCypherQuery:p,bindParameters:a}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}}return n}async getRelationshipsBetweenNodes(e,t,i){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size)return[];const o={relationshipExclusionIds:t,possibleConnectionEntityIds:e},s=[];for(const[d,l]of n.entries()){const e=`${d}_ids`;o[e]=l,s.push(`MATCH (n:${d}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=s.join(\" UNION \"),r=[],p=(await I(this.knowledgeGraph,new M({openCypherQuery:a,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];r.push({id:e[0],typeName:e[1]})}}return r}async getRelationshipsFromNodes(e,t,i,n){const o=this._getNamedTypeIdMapFromNodeIds(e);if(0===o.size||0===t.length)return[];const s={relationshipExclusionIds:i,possibleConnectionEntityIds:t},a=[];for(const[m,h]of o.entries()){const e=`${m}_ids`;s[e]=h,a.push(`MATCH (n:${m}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const r=a.join(\" UNION \"),p=new Map,d=(await I(this.knowledgeGraph,new M({openCypherQuery:r,bindParameters:s}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let i=0;i<t.length;i++){const e=t[i];let n=p.get(e[1]);n||(n=new Set,p.set(e[1],n)),n.add(e[0])}}const l=[];for(const[m,h]of p)for(const e of h)l.push({id:e,typeName:m});return l}async refreshCacheContent(e,t,n,a=!0,r){const p=w.getInstance(),d=[],l=new Map,m=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&m.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&m.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))l.has(t)?l.get(t)?.push(e):l.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?l.set(t,null):e.members&&e.members.forEach((e=>{l.has(t)&&null!==l.get(t)?l.get(t)?.push(e.id):l.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,null)})));for(const[s,h]of l){const e=new Set(h),l=new Promise(((d,l)=>{const c=async()=>{const d=new Set,l=[];let c,u=\"\",f=!1;if(t||m.get(s)?.properties?.forEach((e=>{e.name&&d.add(e.name)})),n&&this.geographicLookup.has(s)){const e=this.geographicLookup.get(s)?.name;e&&d.add(e)}if(this.entityTypeNames.has(s))u=`MATCH (n:${s}) ${h?\"WHERE id(n) IN $ids \":\"\"}return ID(n)`,d.forEach((e=>{u+=`, n.${e}`,l.push(e)}));else{if(!this.relationshipTypeNames.has(s))throw new i(\"knowledge-graph:layer-data-manager\",`The graph type of ${s} could not be determined. Was this type set in the KG data model and inclusion definition?`);f=!0,u=`MATCH ()-[n:${s}]->() ${h?\"WHERE id(n) IN $ids \":\"\"}return ID(n), id(startNode(n)), id(endNode(n))`,d.forEach((e=>{u+=`, n.${e}`,l.push(e)}))}c=new M(h?{openCypherQuery:u,bindParameters:{ids:h}}:{openCypherQuery:u});const g=(await I(this.knowledgeGraph,c,{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:i}=await g.read();if(t)break;const n=[];for(let s=0;s<i.length;s++){const t=i[s];let a=0,r=0;const p={properties:{}};for(p.id=t[a],a++,r++,f&&(p.originId=t[a],a++,r++,p.destinationId=t[a],a++,r++,o(this.nodeConnectionsLookup,p.originId,(()=>new Set)).add(p.id),o(this.nodeConnectionsLookup,p.destinationId,(()=>new Set)).add(p.id),o(this.relationshipConnectionsLookup,p.id,(()=>[p.originId,p.destinationId])));a<t.length;a++)p.properties[l[a-r]]=t[a];e.delete(p.id),n.push(p)}const r=p.writeToStore(n,y,this.geographicLookup.get(s)?.name);this.sublayerCaches.has(s)||this.sublayerCaches.set(s,new Map),a&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(s)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(s,{useAllData:!1,members:new Map}),a&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(s).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(s).members=new Map);const d=this.sublayerCaches.get(s);r.forEach((e=>{d?.set(e.attributes[y],e),a&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(s).members.has(e.attributes[y])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(s).members.set(e.attributes[y],{id:e.attributes[y]}),o(this.memberIdTypeLookup,e.attributes[y],(()=>new Set)).add(s))}))}const b=this.inclusionModeDefinition?.namedTypeDefinitions.get(s);if(b)for(const t of e)b.members?.delete(t)};c().then((()=>{d(null)})).catch((e=>{\"AbortError\"===e.name?d(null):l(e)}))}));d.push(l),this._processingCacheUpdatesLookup.get(s)?.push(l)}if(await Promise.all(d),r?.signal?.aborted)throw s()}removeFromLayer(e){const t=new Set,i=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),1===this.memberIdTypeLookup.get(n.id)?.size?this.memberIdTypeLookup.delete(n.id):this.memberIdTypeLookup.get(n.id)?.delete(n.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===n.typeName&&e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,n)=>{i.has(n)&&this.sublayerCaches.get(e)?.delete(n)}))}))}async retrieveDataFromService(e,t,n){const o=w.getInstance(),s=new Set,r=[];let p,u=\"\",f=[];const g=\"relationship\"===t.graphType,b=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,D=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let E=!b&&D?Array.from(D).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(E=e.objectIds);else if(null!=e.objectIds&&E&&E.length>0){const t=e.objectIds;e.objectIds=E.filter((e=>t.includes(e)))}else if(null!=e.objectIds)E=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=E}if(null!=e.outFields){const i=e.outFields;i.includes(\"*\")?t.fields.forEach((e=>{s.add(e.name)})):i.forEach((e=>{e!==y&&e!==t.geometryFieldName&&s.add(e)}))}if(null!=e.geometry){const n=e.geometry;let o;const y=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,f=y?.spatialReference,b=y?.serviceCapabilities?.geometryCapabilities;let w=b?.geometryMaxBoundingRectangleSizeX,I=b?.geometryMaxBoundingRectangleSizeY;if(\"point\"===n.type){let e=n;e.spatialReference?.isWGS84||(await m(e.spatialReference,c),e=h(e,c)),o=new d({spatialReference:c,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await m(n.extent.spatialReference,c),o=h(n.extent,c)):o=n.extent;if(w&&I&&f){if(4326!==f.wkid){const e=new d({spatialReference:f,xmax:w,ymax:I}),t=h(e,c);w=t.xmax,I=t.ymax}if(o.xmax-o.xmin>w)throw new i(\"knowledge-graph:layer-data-manager\",`Extent x bounds should be within ${w}° latitude, limit exceeded`);if(o.ymax-o.ymin>I)throw new i(\"knowledge-graph:layer-data-manager\",`Extent y bounds should be within ${I}° longitude, limit exceeded`)}if(null!=e.where&&\"1=1\"!==e.where){const i=await a(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&s.add(e.name)}))}u=g?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach((e=>{u+=`, n.${e}`,r.push(e)})),p=new M({openCypherQuery:u,bindParameters:{param_filter_geom:new l({rings:T(o)})}})}else{let i=\"\";if(null!=e.where&&\"1=1\"!==e.where){const n=await a(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&s.add(e.name)}));const o=new Set([\"column-reference\",\"string\",\"number\",\"binary-expression\"]),r=new Set([\"=\",\"<\",\"<=\",\"<>\",\">\",\">=\",\"AND\",\"OR\",\"LIKE\"]);let p=!1;const d=e=>{if(\"column-reference\"===e.type)return`n.${e.column}`;if(\"string\"===e.type)return`'${e.value}'`;if(\"number\"===e.type)return`${e.value}`;if(\"binary-expression\"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&r.has(e.operator))return`${d(e.left)} ${e.operator} ${d(e.right)}`;if(\"binary-expression\"===e.type&&\"LIKE\"===e.operator){let t=\"\";if(\"function\"===e.left.type&&\"column-reference\"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if(\"column-reference\"!==e.left.type)return p=!0,\"\";t+=`lower(n.${e.left.column})`}if(t+=\" CONTAINS (\",\"string\"!==e.right.type)return p=!0,\"\";{let i=e.right.value;\"%\"===i.charAt(0)&&(i=i.slice(1)),\"%\"===i.charAt(i.length-1)&&(i=i.slice(0,-1)),t+=`'${i.toLowerCase()}')`}return t}return p=!0,\"\"};i=d(n.parseTree),p&&(i=\"\")}let n=\"\";n=g?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;E&&(o=!0,n+=\" WHERE ID(n) IN $ids\"),i&&(n+=o?\" AND\":\" WHERE\",n+=` ${i}`),n+=\" return ID(n)\",g&&(n+=\", id(startNode(n)), id(endNode(n))\"),e.returnGeometry&&t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach((e=>{n+=`, n.${e}`,r.push(e)})),p=new M(E?{openCypherQuery:n,bindParameters:{ids:E}}:{openCypherQuery:n})}const N=(await I(t.parentCompositeLayer.dataManager.knowledgeGraph,p,n)).resultRowsStream.getReader();for(;;){const{done:e,value:i}=await N.read();if(e)break;const n=[];for(let t=0;t<i.length;t++){const e=i[t];let o=0,s=0;const a={properties:{}};for(a.id=e[o],o++,s++,g&&(a.originId=e[o],o++,s++,a.destinationId=e[o],o++,s++);o<e.length;o++)a.properties[r[o-s]]=e[o];n.push(a)}f=f.concat(o.writeToStore(n,y,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return f}_isEndEntitySpatial(e,t,i){for(const n of e??[])if(this.entityTypeNames.has(n)){const e=this.geographicLookup.get(n),o=e&&this.sublayerCaches.get(n)?.get(t.attributes[i]);if(e&&o?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const i of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(i))return;t.has(i)?t.get(i)?.push(e):t.set(i,[e])}})),t}};e([r()],E.prototype,\"knowledgeGraph\",void 0),e([r()],E.prototype,\"inclusionModeDefinition\",void 0),e([r()],E.prototype,\"entityTypeNames\",void 0),e([r()],E.prototype,\"relationshipTypeNames\",void 0),e([r()],E.prototype,\"geographicLookup\",void 0),e([r()],E.prototype,\"sublayerCaches\",void 0),e([r()],E.prototype,\"nodeConnectionsLookup\",void 0),e([r()],E.prototype,\"relationshipConnectionsLookup\",void 0),e([r()],E.prototype,\"memberIdTypeLookup\",void 0),E=e([p(\"esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager\")],E);export{E as KnowledgeGraphLayerDataManager};\n"],"names":["E","t","constructor","e","super","this","_processingCacheUpdatesLookup","Map","knowledgeGraph","inclusionModeDefinition","generateAllSublayers","namedTypeDefinitions","entityTypeNames","Set","relationshipTypeNames","geographicLookup","sublayerCaches","nodeConnectionsLookup","relationshipConnectionsLookup","memberIdTypeLookup","dataModel","entityTypes","forEach","i","name","set","add","properties","geometryType","relationshipTypes","s","get","n","getLogger","warn","delete","a","members","o","id","getById","addToLayer","_ref","typeName","has","useAllData","w","getInstance","readFromStoreById","getData","objectType","size","D","where","outFields","parentCompositeLayer","type","length","y","Promise","all","Array","from","values","geometry","relationshipLinkChartDiagramLookup","attributes","objectIdField","u","f","_isEndEntitySpatial","g","Number","entityLinkChartDiagramLookup","b","push","retrieveDataFromService","getConnectedRecordIds","_getNamedTypeIdMapFromNodeIds","slice","r","l","m","p","join","d","I","M","openCypherQuery","bindParameters","signal","resultRowsStream","getReader","done","value","read","getRelationshipsBetweenNodes","relationshipExclusionIds","possibleConnectionEntityIds","entries","getRelationshipsFromNodes","h","refreshCacheContent","arguments","undefined","async","c","ids","originId","destinationId","writeToStore","then","catch","aborted","removeFromLayer","map","graphType","sublayerIdsCache","sort","objectIds","filter","includes","fields","geometryFieldName","dataManager","serviceDefinition","spatialReference","serviceCapabilities","geometryCapabilities","geometryMaxBoundingRectangleSizeX","geometryMaxBoundingRectangleSizeY","isWGS84","xmin","x","ymin","xmax","ymax","extent","wkid","toUpperCase","fieldsIndex","fieldNames","param_filter_geom","rings","T","column","left","right","operator","args","charAt","toLowerCase","parseTree","returnGeometry","N","concat","prototype"],"sourceRoot":""}