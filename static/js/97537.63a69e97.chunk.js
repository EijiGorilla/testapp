"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[97537],{89887:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var s=r(35143),i=r(53084),o=r(46053),l=r(81806),n=r(76460),a=r(85842),u=r(72934),c=(r(11265),r(50076)),d=r(30726),h=r(31633),g=r(65215),p=r(86100),f=r(77269),y=r(39348),m=r(65256);const S=/https?:\/\/services.*\.arcgis\.com/i,_=/(?:\{([^}]+)\})/g,v=()=>n.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function w(e,t){const{exactMatch:r=!1,location:s,maxResults:i,spatialReference:o,source:l,sourceIndex:n,suggestResult:a,view:u}=e,{layer:d,filter:g,zoomScale:p}=l,f=u?.scale,y=b(l,u),m=t?.signal;return M(d).then((()=>{const e=d.popupTemplate;return e?e.getRequiredFields(d.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:S}=d,_=Z(l);if(!P(d,_))throw v().error("invalid-field: displayField is invalid."),new c.default("getResults():invalid-field","displayField is invalid.");const w=e?.length?e:[_],x=l.outFields||w,b=F(x);if(x.includes(t)||b||x.push(t),d.floorInfo?.floorField&&x.push(d.floorInfo.floorField),!b&&!A(d,x))throw v().error("invalid-field: outField is invalid."),new c.default("getResults():invalid-field","outField is invalid.");const M=d.createQuery(),{orderByFields:$}=l;if($&&(M.orderByFields=$),o){M.outSpatialReference=o;const e=1/(0,h.GA)(o);e&&(M.maxAllowableOffset=e)}const O="mesh"===d.geometryType||"multipatch"===d.geometryType,D=d.capabilities?.data?.supportsZ&&!O;if(M.returnZ=D&&!1!==S,M.returnGeometry=!0,M.multipatchOption=O?"xyFootprint":null,x&&(M.outFields=x),s)M.geometry=s;else if(a.key)M.objectIds=[a.key];else{const e=l.searchFields||[_];if(!A(d,e))throw v().error("invalid-field: search field is invalid."),new c.default("getResults():invalid-field","search field is invalid.");E(d)&&(M.num=i),y&&(M.geometry=y);const t=a.text?.trim();if(!t)return[];const s=a.text,{prefix:o="",suffix:n=""}=l,u=C(`${o}${s}${n}`);R(d)&&L(d,e)&&!r&&s&&(M.fullText=I({text:s,searchFields:e}));const h=G({searchTerm:u,layer:d,searchFields:e,filter:g,exactMatch:r,query:M,type:"search"});if(M.where=h,!T(M))return[]}return d.queryFeatures(M,{signal:m}).then((e=>function(e,t,r,s,i,o,l){return e.features.map((e=>N(e,t,r,s,i,o,l)))}(e,u,l,n,_,f,p)))}))}function x(e,t){const{source:r,spatialReference:s,view:i,suggestTerm:o,maxSuggestions:l,sourceIndex:n,exactMatch:a}=e,{layer:u,filter:d}=r,h=t?.signal,g=b(r,i);return M(u).then((()=>{if(!E(u))return[];const e=Z(r),t=r.searchFields||[e],i=[];r.suggestionTemplate?r.suggestionTemplate.replaceAll(_,((e,t)=>(i.push(t),e))):i.push(e);const p=F(i);i.includes(u.objectIdField)||p||i.push(u.objectIdField);const f=P(u,e),y=p||A(u,i),m=A(u,t);if(!f)throw v().error("invalid-field: displayField is invalid."),new c.default("getSuggestions():invalid-field","displayField is invalid.");if(!y)throw v().error("invalid-field: outField is invalid."),new c.default("getSuggestions():invalid-field","outField is invalid.");if(!m)throw v().error("invalid-field: search field is invalid."),new c.default("getSuggestions():invalid-field","search field is invalid.");const S=u.createQuery(),{orderByFields:w}=r;if(w&&(S.orderByFields=w),S.outSpatialReference=s,S.returnGeometry=!1,S.num=l,S.outFields=i,g&&(S.geometry=g),!o.trim())return[];const{prefix:x="",suffix:b=""}=r,M=C(`${x}${o}${b}`);R(u)&&L(u,t)&&!a&&o&&(S.fullText=I({text:o,searchFields:t}));const $=G({searchTerm:M,layer:u,searchFields:t,filter:d,exactMatch:a,query:S,type:"suggest"});return S.where=$,T(S)?u.queryFeatures(S,{signal:h}).then((t=>function(e,t,r,s){return e.features.map((e=>function(e,t,r,s){const i=e.sourceLayer,{attributes:o}=e,{objectIdField:l}=i,n=l?o[l]:null;return{text:O(e,t.suggestionTemplate,s),key:n,sourceIndex:r}}(e,t,r,s)))}(t,r,n,e))):[]}))}function b(e,t){const{filter:r,withinViewEnabled:s}=e,i=t?.extent,o=r?.geometry;return o??(s&&i?i:void 0)}function F(e){return e&&e.includes("*")}async function M(e){e&&await e.load()}function T(e){return!(!e.fullText&&!e.where)}function L(e,t){const r=e?.indexes;return!(!r||!t?.length)&&r.filter((e=>"FullText"===e.indexType)).some((e=>{const r=e.fields?.split(",").map((e=>e.trim().toLowerCase()))||[];return t.every((e=>r.includes(e.toLowerCase())))}))}function I(e){let{text:t,searchFields:r}=e;return t.trim().split(" ").filter((e=>!!e.trim())).map((e=>new f.A({onFields:r,searchTerm:e,searchType:"prefix"})))}function R(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function E(e){return e?.capabilities?.query?.supportsPagination??!1}function Z(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function A(e,t){return!(!e||!t?.length)&&t.every((t=>P(e,t)))}function P(e,t){return!!e.getField(t)}function C(e){return e.replaceAll("'","''")}function $(e,t){const r=t?.where;return r?`(${e}) AND (${r})`:e}function G(e){let{searchTerm:t,layer:r,searchFields:s,filter:i,exactMatch:o,query:n,type:a}=e;const{definitionExpression:u,url:c}=r;let h="";return!n.fullText&&t&&s&&s.forEach((e=>{const s=r.getField(e),n=r.getFieldDomain?.(e,{excludeImpliedDomains:(0,l.A)("esri-widget-legacy-field-domain-calculation")}),u=(n&&"coded-value"===n.type?function(e,t,r){let{codedValues:s}=e;return(0,d.Pb)(s??[],(e=>{const s=e.name,i=r?s:s.toLowerCase();return(r?t:t.toLowerCase())===i?e.code.toString():null}))??null}(n,t,o):null)||t||null;if(null!==u){const e=function(e){let{currentTerm:t,field:r,filter:s,exactMatch:i,url:o,type:l}=e;const n=r?.type,a=r?.name;if("string"===n||"date"===n||"global-id"===n){const e=S.test(o??""),r=e&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(t)?"N":"";return $(i&&"search"===l?`${a} = ${r}'${t}'`:e?`${a} LIKE ${r}'${t}%'`:`LOWER(${a}) LIKE ${r}'${t.toLowerCase()}%'`,s)}if("oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n){const e=Number(t);return isNaN(e)?null:$(`${a} = ${e}`,s)}return $(`${a} = ${t}`,s)}({currentTerm:u,field:s,filter:i,exactMatch:o,url:c,type:a});e&&(h+=function(e,t){return e?` OR (${t})`:`(${t})`}(h,e))}})),u&&h?`(${u}) AND (${h})`:u||h}function O(e,t,r){const s=e.sourceLayer,{attributes:i}=e,o=s.getFieldDomain?.(r,{feature:e,excludeImpliedDomains:(0,l.A)("esri-widget-legacy-field-domain-calculation")});if(t)return(0,y.V)(t,i);if(r&&i){const e=s.getField(r),t=function(e,t){return e[t]??e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(i,r);return null==t?"":o&&"coded-value"===o.type?function(e,t){let r=null;const{codedValues:s}=e;return s&&s.length&&s.some((e=>e.code===t&&(r=e.name,!0))),r}(o,t)??"":"date"===e?.type?(0,m.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function N(e,t,r,s,o,l,n){const a=e.clone(),u=e.sourceLayer,c=u?.objectIdField,d=c?e.attributes[c]:null,h=O(e,r.searchTemplate,o);null!=l&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(u)&&(u.minScale&&u.minScale<l?l=u.minScale:u.maxScale&&u.maxScale>l&&(l=u.maxScale));const f=a.geometry?(0,p.ZY)(a.geometry,t??void 0,l??void 0):void 0,y="number"==typeof n&&f?(0,p.DN)((0,i.clone)(f),t??void 0,n):f,m=e.clone();return null!=y&&(m.geometry=g.default.fromExtent(y)),{extent:y,target:m,feature:a,key:d,name:h,sourceIndex:s}}var D;let j=D=class extends u.default{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>w({source:this,...e},t),this.getSuggestions=(e,t)=>x({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new D({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,i.clone)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,i.clone)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const r=e.getField(t);return r?.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,s._)([(0,o.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],j.prototype,"displayField",void 0),(0,s._)([(0,o.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],j.prototype,"exactMatch",void 0),(0,s._)([(0,o.MZ)({value:null})],j.prototype,"layer",null),(0,s._)([(0,o.MZ)()],j.prototype,"name",null),(0,s._)([(0,o.MZ)({type:[String],json:{write:!0}})],j.prototype,"orderByFields",void 0),(0,s._)([(0,o.MZ)()],j.prototype,"searchFields",void 0),(0,s._)([(0,o.MZ)()],j.prototype,"searchTemplate",void 0),(0,s._)([(0,o.MZ)()],j.prototype,"suggestionTemplate",void 0),j=D=(0,s._)([(0,a.$)("esri.widgets.Search.LayerSearchSource")],j);const k=j},97537:(e,t,r)=>{r.r(t),r.d(t,{default:()=>q});var s=r(35143),i=r(28899),o=r(86560),l=r(39356),n=r(73204),a=r(91967),u=r(18690),c=r(19276),d=r(50076),h=r(54099),g=r(76460),p=r(30726),f=r(50346),y=r(68134),m=r(46053),S=(r(81806),r(85842)),_=r(19247),v=r(13312),w=r(86100),x=r(38042),b=r(63860),F=r(24883),M=r(27410),T=r(86875),L=r(38996),I=r(86659),R=r(90992),E=r(89887),Z=r(17160),A=r(72934),P=r(19448),C=r(99403),$=r(79535);function G(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const O="highlight",N=c.default.ofType({key:e=>e.layer?"layer":"locator",base:A.default,typeMap:{layer:E.default,locator:Z.default}}),D=v.default.WGS84,j=/<[\s\S]*?>/g,k=-1;let V=class extends((0,$.A)(h.A.EventedMixin(a.default))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new N,this.defaultSymbols={point:new M.default({url:(0,i.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new L.default({color:[130,130,130,1],width:2}),polygon:new T.default({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=F.default.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new N,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,b.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new n.default({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,y.watch)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),y.initial),(0,x.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?k:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:r}=this,s="function"==typeof r?r.call(null,{sources:e,defaultSources:t}):r?t.concat(e):e,i=this._get("allSources")||new N;return i.removeAll(),i.addMany(s.filter(Boolean)),i}get locationEnabled(){return this._get("locationEnabled")||(0,C.$j)()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=(0,C.$j)();if(e&&!t){const e=new d.default("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});g.A.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:r}=this;if(t===k)return r??"";const s=e.at(t);return s?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(e),s=(async()=>{try{await this.when();const e=await this._getResultsFromSources(r,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(s,e,r);const i=this._getFirstResult(s.results),o=r.location&&i?i.name:r.text,l=o?.replace(j,"");return this._set("searchTerm",l),(r.key&&"number"==typeof r.sourceIndex||r.location)&&this._set("selectedSuggestion",r),this._set("results",s.results),this._set("resultCount",s.results.reduce(((e,t)=>e+(t.results?.length??0)),0)),this.emit("search-complete",s),await this._selectFirstResult(i),s}finally{this._clearSearching()}})();return this._searching=s,s}async searchNearby(e){if(!this.locationEnabled){const e=new d.default("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw g.A.getLogger(this).error(e),e}const t=(async()=>{try{const t=await(0,C.J1)(),r=await(0,C.Ly)({position:t,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new d.default("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw g.A.getLogger(this).error(t),t}const{view:t}=this,r=G(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),s=null!=r?this.allSources.at(r):null;if(!s){const e=new d.default("select:missing-source","Cannot select without a source.",{source:s});throw g.A.getLogger(this).error(e),e}const i=s instanceof E.default?this._getLayerSourcePopupTemplate(s):s.popupTemplate,o=s.resultSymbol||this._getDefaultSymbol(e),n=G(s,"resultGraphicEnabled")?s.resultGraphicEnabled:this.resultGraphicEnabled,a=G(s,"autoNavigate")?s.autoNavigate:this.autoNavigate,u=G(s,"popupEnabled")?s.popupEnabled:this.popupEnabled,c=u?i||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const e=new d.default("select:missing-feature","Cannot select without a feature.",{feature:h});throw g.A.getLogger(this).error(e),e}const{attributes:p,geometry:y,layer:m,sourceLayer:S}=h,_=y?(0,w.z8)(y):null,v={layerViewQuery:this._getLayerView(h),elevationQuery:t&&null!=_?(0,w.Sv)(_,t):Promise.resolve(_)},x=await(0,f.eachAlways)(v),b=x.layerViewQuery.value,F=x.elevationQuery.value;o instanceof I.default&&(o.text=e.name);const M=t&&a?e.target||e.extent:null,T=null!=M?this._goToSearchResult(M):Promise.resolve();await T;const L=b?h:new l.default({geometry:y,symbol:o,attributes:p,layer:m,sourceLayer:S,popupTemplate:c}),Z=t?.popup,A=Z&&u&&L.getEffectivePopupTemplate(Z.defaultPopupTemplateEnabled);return A&&await t.openPopup({features:[L],location:F}),b&&(0,R.Of)(b)&&!A&&this._highlightFeature({graphic:L,layerView:b}),!b&&n&&t&&t.graphics.push(L),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",L),this.emit("select-result",{result:e,source:s,sourceIndex:r}),e}async suggest(e,t,r){const s=e||this.searchTerm;this.emit("suggest-start",{searchTerm:s}),await this._suggestTimer(t,r);const i=await this._suggestImmediate(s,r);return this._set("suggestions",i?.results),this._set("suggestionCount",i?.results.reduce(((e,t)=>e+(t.results?.length??0)),0)??null),this.emit("suggest-complete",i),i}async when(){await(0,y.whenOnce)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const r=this._updatingPromise=(0,f.eachAlways)([e?.load(),t?.when()]);if(this.destroyed)return;if(await r,r!==this._updatingPromise)return}await(0,y.whenOnce)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=o.default.apiKey&&(0,P.m$)(e.url)?{url:P.jd}:null,r=Z.default.fromJSON({...e,...t}),s=r.url;if((0,P.m$)(s)||(0,P.jE)(s)||(0,P.sx)(s)){const e=r.outFields??["Addr_type","Match_addr","StAddr","City"],t=(r.placeholder||this.messages?.placeholder)??"",s="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=e,r.placeholder=t,r.defaultZoomScale=s}return r.singleLineFieldName?r:void 0})).filter(u.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const r=this.view?.map;return e.map((e=>{const s=r.findLayerById(e.id);if(!s)return;const i=this._getLayerJSON(e),o=E.default.fromJSON(i);return o.placeholder=t,this._getLayer(s,i).then((e=>{o.layer=e})),o})).filter(u.Ru).toArray()}_getTableSources(e,t){const r=this.view?.map;return e.map((e=>{if(!e.id)return;const s=r.findTableById(e.id);if(!s)return;const i=this._getLayerJSON(e),o=E.default.fromJSON(i);return o.placeholder=t,this._getLayer(s,i).then((e=>{o.layer=e})),o})).filter(u.Ru).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:r,hintText:s,layers:i,tables:o}=t;return r?[...this._getLayerSources(i,s),...this._getTableSources(o,s)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const r=e.allSublayers.find((e=>e.id===t.subLayer));if(!r)throw new Error;const s=await(r.createFeatureLayer?.());if(!s)throw new Error;return this._createdFeatureLayers.push(s),s}async _getBuildingSubLayer(e,t){await e.load();const r=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==r?.type)throw new Error;if(await r.load(),null==r.associatedLayer)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(r){const t=new d.default("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return g.A.getLogger(this).error(t),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const r="selectedFeature"in e,s=r?e.selectedFeature:null;r&&s&&s===t&&e.close()}_suggestTimer(e,t){const r=null!=e?e:this.suggestionDelay;return(0,f.after)(r,null,t?.signal)}_createLocationForSearch(e){return e instanceof l.default&&e.geometry?(0,w.z8)(e.geometry):e instanceof _.default?e:Array.isArray(e)&&2===e.length?new _.default({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&G(e,"key")&&G(e,"text")&&G(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),r="string"==typeof e?e:this.searchTerm,{selectedSuggestion:s,selectedResult:i}=this,o=!e&&s&&i,l=o&&s.key===i.key&&s.sourceIndex===i.sourceIndex,n=o&&s.location;return l||n?s:{location:t,text:t?"":r,sourceIndex:null,key:null}}_getFirstResult(e){return(0,p.Pb)(e,(e=>{let{results:t}=e;return t?.[0]}))??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const r=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(s,r),s}_formatSourceResponse(e,t,r){const s=t?.value||[],i=t?.error,o=this.allSources.at(r);if(i){const t={sourceIndex:r,source:o,error:i};e.errors.push(t),g.A.getLogger(this).error(i),e.numErrors++}else{const t={sourceIndex:r,source:o,results:s};e.results.push(t),e.numResults+=s.length}}_formatResponse(e,t,r){if(t)if(e.activeSourceIndex===k){const s=r&&G(r,"sourceIndex")&&-1!==r.sourceIndex?r.sourceIndex:void 0;t.forEach(((t,r)=>{const i=void 0!==s?s:r;this._formatSourceResponse(e,t,i)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:r}=this,s=!e.location&&G(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,i=[];if(!r.length){const e=new d.default("search:no-sources-defined","At least one source is required.",{allSources:r});throw g.A.getLogger(this).error(e),e}return s===k?r.forEach(((r,s)=>{i.push(this._getResultsFromSource(e,s,t))})):i.push(this._getResultsFromSource(e,s,t)),(0,f.eachAlways)(i)}async _getSuggestionsFromSources(e,t){const{allSources:r,activeSourceIndex:s}=this,i=[];if(!r.length){const e=new d.default("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw g.A.getLogger(this).error(e),e}return s===k?r.forEach(((r,s)=>{i.push(this._getSuggestionsFromSource(e,s,t))})):i.push(this._getSuggestionsFromSource(e,s,t)),(0,f.eachAlways)(i)}async _getResultsFromSource(e,t,r){const s=null!=t?this.allSources.at(t):null;if(!s)return null;const{location:i=null}=e,o=this.view?.spatialReference||D,l=G(s,"maxResults")?s.maxResults:this.maxResults,n=!!(s instanceof E.default&&G(s,"exactMatch"))&&s.exactMatch,{view:a}=this;return s.getResults?.({view:a,sourceIndex:t,location:i,suggestResult:e,spatialReference:o,exactMatch:n,maxResults:l},r)}async _getSuggestionsFromSource(e,t,r){const s=this.allSources.at(t);if(!s)return null;e??="";const i=G(s,"suggestionsEnabled")?s.suggestionsEnabled:this.suggestionsEnabled,o=e?.length,l=G(s,"minSuggestCharacters")?s.minSuggestCharacters:this.minSuggestCharacters;if(i&&e.trim()&&o>=l){const i=this.view?.spatialReference||D,o=G(s,"maxSuggestions")?s.maxSuggestions:this.maxSuggestions,{view:l}=this,n=!!(s instanceof E.default&&G(s,"exactMatch"))&&s.exactMatch;return s.getSuggestions?.({view:l,sourceIndex:t,suggestTerm:e,spatialReference:i,maxSuggestions:o,exactMatch:n},r)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return G(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return(0,p.Pb)(this.results??[],(t=>{let{results:r,sourceIndex:s}=t;const i=r?.includes(e);return i?s:null}))??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const r={target:{target:e},options:{signal:t.signal}};e||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,r=e.feature?.geometry;if(null==r)return null;switch(r.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(O)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer?.type||"subtype-sublayer"===e.layer?.type)return null;const{layer:r}=e;return r?(await t.when(),t.whenLayerView(r)):null}_highlightFeature(e){const{graphic:t,layerView:r}=e,{attributes:s,layer:i}=t,{objectIdField:o}=i,l=(o&&s?.[o])??null,n=r.highlight(l??t);this.addHandles(n,O)}_setResultFloor(e){const{view:t}=this,r=e.feature?.attributes,s=e.feature?.sourceLayer;if(s&&"floorInfo"in s&&s?.floorInfo?.floorField&&r){const e=r[s.floorInfo.floorField];t?.emit("select-result-floor",e)}}};V.ALL_INDEX=k,(0,s._)([(0,m.MZ)()],V.prototype,"_searching",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"_updatingPromise",void 0),(0,s._)([(0,m.MZ)({readOnly:!0,value:null})],V.prototype,"activeSource",null),(0,s._)([(0,m.MZ)()],V.prototype,"activeSourceIndex",null),(0,s._)([(0,m.MZ)()],V.prototype,"allPlaceholder",null),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"allSources",null),(0,s._)([(0,m.MZ)()],V.prototype,"autoNavigate",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"autoSelect",void 0),(0,s._)([(0,m.MZ)({type:n.default})],V.prototype,"defaultPopupTemplate",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"defaultSources",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"defaultSymbols",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"includeDefaultSources",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"locationEnabled",null),(0,s._)([(0,m.MZ)()],V.prototype,"maxInputLength",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"maxResults",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"maxSuggestions",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"messages",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"placeholder",null),(0,s._)([(0,m.MZ)()],V.prototype,"popupEnabled",void 0),(0,s._)([(0,m.MZ)({type:n.default})],V.prototype,"popupTemplate",void 0),(0,s._)([(0,m.MZ)({type:F.default})],V.prototype,"portal",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"resultCount",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"resultGraphic",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"results",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"selectedSuggestion",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"searchAllEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"selectedResult",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"searchTerm",null),(0,s._)([(0,m.MZ)({type:N})],V.prototype,"sources",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"state",null),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionDelay",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionCount",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"suggestions",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"updating",null),(0,s._)([(0,m.MZ)()],V.prototype,"view",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"clear",null),V=(0,s._)([(0,S.$)("esri.widgets.Search.SearchViewModel")],V);const q=V},99403:(e,t,r)=>{r.d(t,{$j:()=>p,J1:()=>f,Ly:()=>m});var s=r(86560),i=r(50076),o=r(81806),l=r(76460),n=r(19247),a=r(45417),u=r(24883),c=r(71334),d=r(70414);const h=()=>l.A.getLogger("esri.widgets.support.geolocationUtils"),g={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function p(){return function(){const e=!!(0,o.A)("esri-geolocation");return e||h().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||h().warnOnce("insecure-context","Geolocation requires a secure origin."),e}()}function f(e){return e??=g,new Promise(((t,r)=>{setTimeout((()=>r(new i.default("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,r,e??void 0)}))}let y;function m(e,t){if(y)return y(e,t);const{position:r,view:o}=e,l=function(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e?{coords:r,timestamp:e.timestamp,toJSON:()=>({})}:e}(r),h=l?.coords;if(!h)throw new i.default("geometry-service:no-coords","Geolocation has no coordinates");return function(e,t,r){if(!t)return Promise.resolve(e);const o=t.spatialReference;return o.isWGS84?Promise.resolve(e):o.isWebMercator?Promise.resolve((0,a.geographicToWebMercator)(e)):function(e){if(s.default.geometryServiceUrl)return Promise.resolve(s.default.geometryServiceUrl);const t=u.default.getDefault();return t.load(e).catch((()=>{})).then((()=>t.helperServices?.geometry?.url))}(r).then((t=>{if(!t)throw new i.default("geometry-service:missing-url","Geometry service URL is missing");const s=new d.default({geometries:[e],outSpatialReference:o});return(0,c.C)(t,s,r).then((e=>e[0]))}))}(function(e){let{longitude:t,latitude:r,altitude:s}=e;return new n.default({longitude:t,latitude:r,z:s||void 0,spatialReference:{wkid:4326}})}(h),o,t)}}}]);
//# sourceMappingURL=97537.63a69e97.chunk.js.map