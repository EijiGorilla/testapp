{"version":3,"file":"static/js/73814.ef4cad25.chunk.js","mappings":"0OAImxBA,eAAeC,EAAEC,EAAEC,GAAG,MAAMC,EAAEF,EAAEG,SAASC,WAAW,GAAGF,GAAGG,GAAG,aAAaH,EAAEI,KAAKL,GAAiD,SAAWA,GAAG,MAAMC,EAAED,EAAEE,SAASC,WAAW,IAAIF,GAAGK,OAAON,EAAEO,eAAeC,SAASP,EAAEK,MAAM,MAAM,IAAIP,EAAAA,QAAE,iCAAiC,gEAAgE,CAACO,KAAKL,GAAGK,KAAKG,aAAaT,EAAEO,eAAeG,KAAK,OAAO,CAA/SC,CAAEZ,GAAGA,EAAEa,cAAcb,EAAEa,aAAaX,GAA4QJ,eAAiBE,EAAEC,GAAG,MAAMC,EAAEF,EAAEG,SAASW,EAAEZ,EAAEE,WAAW,IAAIU,EAAE,OAAO,MAAMC,IAAIC,EAAEC,MAAMC,GAAGJ,EAAEK,GAAEC,EAAAA,EAAAA,GAAEN,EAAE,eAAe,GAAG,UAAUZ,EAAEK,KAAK,OAAmOT,eAAiBG,EAAEC,EAAEmB,GAAG,MAAMP,EAAEb,EAAEG,WAAW,IAAIH,EAAEqB,mBAAmB,OAAO,MAAML,MAAMG,EAAEb,KAAKS,GAAGF,EAAE,GAAG,gBAAgBE,EAAE,CAAC,KAAIO,EAAAA,EAAAA,GAAET,EAAE,OAAO,MAAM,IAAId,EAAAA,QAAE,wCAAwC,kEAAkE,OAAgDF,eAAiBG,EAAEC,GAAG,MAAMmB,EAAEpB,EAAEG,WAAWU,QAAQO,EAAEG,UAAU,QAAQ,IAAIV,EAAE,OAAO,IAAIZ,EAAEuB,mBAAmB,MAAM,IAAIzB,EAAAA,QAAE,sCAAsC,gCAAgC,MAAMgB,GAAEI,EAAAA,EAAAA,GAAEC,EAAE,WAAWpB,EAAEyB,KAAKZ,EAAEE,SAASd,EAAEuB,mBAAmBxB,EAAEa,EAAE,CAACa,QAAQX,IAAIf,EAAE2B,mBAAmB,CAACxB,WAAWiB,EAAEQ,MAAMb,EAAEc,mBAAmB,GAAG,CAAxXC,CAAE9B,EAAEoB,EAAE,CAAC,OAAOpB,EAAEyB,KAAK,CAACT,MAAMG,GAAGlB,GAA0VJ,eAAiBG,EAAEC,GAAG,IAAIY,EAAE,MAAMV,WAAWgB,GAAGnB,EAAE,IAAImB,EAAE,OAAO,MAAMY,EAAEZ,EAAEb,KAAK0B,EAAE/B,EAAEgC,mBAAmB,IAAID,EAAE,MAAM,IAAIjC,EAAAA,QAAE,uCAAuC,6DAA6D,OAAOgC,GAAG,IAAI,kBAAkB,IAAI,qBAAqBlB,EAAEmB,EAAEE,aAAa,MAAM,IAAI,iBAAiBrB,EAAEmB,EAAEG,YAAY,MAAM,IAAI,gBAAgBtB,EAAEmB,EAAEI,WAAW,MAAM,QAAQ,MAAM,IAAIrC,EAAAA,QAAE,wCAAwC,kBAAkBgC,0CAA0C,MAAMM,EAAE,IAAIjB,EAAAA,EAAE,IAAIkB,EAAEhB,SAASiB,QAAQC,IAAI,CAAC3B,IAAI4B,EAAExC,EAAEoC,KAAKK,EAAEA,IAAIJ,EAAE,GAAG,oBAAoBP,EAAE,CAAC,MAAMhC,GAAEgB,EAAAA,EAAAA,IAAEO,IAAIqB,iBAAiBrB,EAAEH,EAAEL,UAAUG,EAAAA,EAAAA,IAAEK,EAAEH,EAAEL,IAAIuB,GAAG,CAAC,EAAEK,QAA+nF7C,eAAiBE,EAAEC,GAAG,MAAM4C,OAAO3C,EAAE4C,OAAOzB,GAAGrB,EAAEc,EAAE,IAAIZ,GAAG,MAAMmB,GAAG,IAAI,IAAIP,EAAEiC,OAAO,OAAO,MAAM3B,EAAE,IAAI4B,IAAIhC,EAAE,GAAG,IAAI,MAAMiC,UAAUC,KAAKpC,EAAE,CAAC,MAAMd,EAAEkD,GAAG,qBAAqB,GAAG9B,EAAE+B,IAAInD,GAAG,SAASoB,EAAEgC,IAAIpD,GAAG,MAAME,EAAED,GAAEsC,EAAAA,EAAAA,IAAEvC,IAAIgB,EAAEqC,KAAKnD,IAAI,CAAC,MAAMgB,QAAQsB,QAAQC,IAAIzB,GAAGG,EAAE,IAAImC,IAAI,OAAOC,MAAMC,KAAKpC,GAAGqC,SAAS,CAACzD,EAAEC,KAAKkB,EAAEuC,IAAI1D,EAAEkB,EAAEjB,GAAG,IAAI0D,IAAiB,IAAfV,UAAUjD,GAAE2D,EAAI,MAAM1D,EAAED,GAAG,qBAAqB,OAAOmB,EAAEyC,IAAI3D,EAAE,CAAC,CAA7/F4D,CAAEtC,EAAEU,IAAIU,EAAE,MAAMzC,QAAy9EJ,eAAiBE,EAAEC,GAAG,MAAM6D,WAAWzC,SAASnB,EAAAA,EAAAA,GAAEF,EAAEC,GAAG,IAAIoB,EAAE,OAAO,KAAK,MAAMP,EAAE,IAAIO,EAAEwB,UAAUxB,EAAEyB,QAAQ,OAAO9C,GAAGc,EAAEiD,MAAM9D,GAAGA,EAAEI,KAAKL,EAAEK,IAAI,CAA9lF2D,CAAE5C,EAAEL,IAAI,CAAC6B,iBAAiB5C,EAAEiE,YAAY3B,IAAI,aAAa4B,EAAEjE,EAAE0C,EAAEA,EAAEpB,EAAEU,EAAE/B,EAAE,CAAC,MAAM,kBAAkB8B,GAAGZ,EAAEL,MAAMQ,QAAQJ,EAAAA,EAAAA,IAAEC,EAAEG,EAAEe,KAAIY,EAAAA,EAAAA,IAAE3B,GAAG,QAAQ2C,EAAEjE,EAAE0C,EAAE,KAAKpB,EAAEU,SAAkBnC,eAAiBE,EAAEC,EAAEC,GAAG,MAAME,WAAWiB,GAAGrB,EAAE,IAAIqB,GAAGN,IAAI,OAAO,MAAMD,QAAQqD,EAAAA,EAAAA,GAAE9C,EAAEN,KAAKD,GAAGoD,EAAElE,EAAEC,EAAE,KAAK,CAAC4C,OAAO/B,EAAE+B,QAAQuB,IAAIpC,EAAAA,IAAGc,OAAOhC,EAAEgC,QAAQsB,IAAIpC,EAAAA,KAAI9B,EAAE,CAAlKmE,CAAEpE,EAAE0C,EAAEV,EAAE,CAA5qCqC,CAAErE,EAAEoB,EAAE,CAA3gBkD,CAAErE,EAAEiB,EAAEnB,GAAGgB,GAAG,UAAUd,EAAEK,MAAML,EAAEwB,KAAK,CAACX,IAAIC,GAAGG,GAAG,MAAM+B,EAAE,IAAI7B,EAAAA,EAAEW,QAAQU,EAAE1C,EAAEkD,EAAEjD,GAAG,OAAO+B,GAAG9B,EAAEwB,KAAKM,EAAEb,GAAGjB,EAAE0B,mBAAmB,CAACxB,WAAWU,EAAEe,MAAMV,EAAEW,mBAAmB,IAAI,kBAAkB5B,EAAEK,MAAML,EAAEwB,KAAK,CAACT,MAAMC,GAAGC,IAAGwB,EAAAA,EAAAA,GAAEzC,EAAEiB,EAAE,CAAhnBqD,CAAExE,EAAEC,EAAE,CAA2tEH,eAAeoE,EAAElE,EAAEC,EAAEC,EAAEmB,EAAEP,EAAEM,GAAG,IAAIJ,EAAEK,EAAEwB,QAAQ,GAAG,MAAM3B,EAAEG,EAAEyB,QAAQ,GAAG,GAAG,uBAAuB9C,EAAEI,YAAYG,MAAMS,EAAEyC,SAAS,CAACzD,EAAEC,KAAKD,EAAEK,GAAGJ,EAAE,UAAUD,GAAGyE,iBAAiBlE,MAAMW,EAAEmC,KAAKrD,EAAE,IAAIgB,EAAEA,EAAE0D,QAAQ1E,GAAG,UAAUA,GAAGyE,iBAAiBlE,SAASS,EAAE2D,UAAUzD,EAAEyD,WAAW3D,EAAEyC,SAASvD,IAAI,MAAMY,EAAEM,IAAIlB,GAAG,GAAGY,IAAIM,EAAE,CAAC,MAAMA,EAAEwD,EAAE5E,EAAEC,EAAEC,GAAGmB,EAAEnB,EAAEY,GAAGd,EAAEoD,IAAIhC,EAAE,KAAKF,EAAE6B,OAAO,CAAC,MAAM9C,EAAEC,EAAE,WAAWY,EAAEqB,eAAejB,EAAEuC,SAAS3C,IAAI,MAAME,EAAEI,IAAIN,GAAG,GAAGE,IAAII,EAAE,CAAC,MAAMA,EAAEwD,EAAE5E,EAAEE,EAAEA,EAAEY,GAAGb,EAAEoB,EAAEP,EAAEE,GAAGhB,EAAE8C,OAAOM,IAAIhC,EAAE,IAAI,CAAC,CAAC,SAASwD,EAAE5E,EAAEC,EAAEC,EAAEmB,EAAED,GAAG,MAAMJ,EAAEhB,EAAEI,WAAWc,EAAE,CAACd,WAAWY,EAAE6D,QAAQC,QAAQzD,EAAEhB,IAAI,MAAMgB,EAAEN,MAAMG,EAAEH,IAAIM,EAAEN,KAAK,MAAMI,EAAE,IAAIlB,EAAEiB,GAAG,GAAG,eAAeC,IAAIA,EAAE4D,WAAW3D,GAAG,kBAAkBD,EAAEZ,MAAM,YAAYY,EAAEZ,OAAOY,EAAE6D,kBAAkB,gBAAgB,uBAAuBhE,EAAET,KAAK,CAAC,MAAMP,EAAE,CAACiF,OAAO,cAAcC,OAAOlE,EAAEkE,QAAQpE,EAAAA,QAAEqE,cAAchE,EAAEO,KAAKL,EAAErB,GAAG,MAAMC,EAAEC,EAAEkF,WAAW,MAAMnF,GAAGkB,EAAEO,KAAK,CAAC0D,WAAWnF,GAAGD,EAAE,CAAC,OAAOmB,CAAC,CAACrB,eAAe4C,EAAE1C,EAAEC,EAAEC,GAAG,IAAG,IAAKF,EAAEqF,aAAa,OAAO,MAAMhE,EAAErB,EAAEG,SAASW,EAAEO,EAAEjB,WAAW,IAAIU,EAAE,OAAO,IAAIM,EAAE,KAAK,IAAIA,QAAQN,EAAEU,UAAU,OAAOtB,EAAE,CAAC,MAAMgB,GAAG,CAAC,GAAm3B,SAAWlB,GAAG,MAAM,WAAWA,EAAEO,MAAM,YAAYP,CAAC,CAAp6BsF,CAAEjE,GAAG,CAAC,IAAIrB,EAAE,KAAK,MAAME,QAA4bJ,eAAiBE,EAAEE,EAAEmB,GAAG,GAAGnB,GAAG2C,QAAQ3C,GAAG4C,OAAO,OAAOI,EAAAA,EAAAA,IAAEhD,GAAG,MAAMY,GAAEb,EAAAA,EAAAA,IAAED,EAAEe,KAAK,IAAID,EAAE,OAAO,EAAE,MAAMM,QAAQC,EAAEkE,qBAAqBzE,EAAEC,IAAIyE,KAAK,CAAC5C,kBAAiB5B,EAAAA,EAAAA,IAAEd,IAAI0C,mBAAmB6C,OAAO,IAAI,OAAO,OAAOvF,GAAG2C,QAAQE,QAAQ3B,GAAGyB,QAAQE,QAAQ,IAAI7C,GAAG4C,QAAQC,QAAQ3B,GAAG0B,QAAQC,QAAQ,EAAE,CAAttB2C,CAAE5E,EAAEM,EAAEnB,GAAG,IAAImB,GAAGyB,QAAQzB,GAAG0B,SAAS5C,EAAE,EAAE,CAAC,GAAG,MAAMmB,EAAEyD,QAAQ,CAAC,MAAM9E,GAAEiC,EAAAA,EAAAA,GAAEZ,EAAEd,MAAMN,EAAED,GAAG+C,QAAOT,EAAAA,EAAAA,IAAElB,EAAEpB,GAAG,IAAGgB,EAAAA,EAAAA,IAAEI,GAAGnB,IAAIoB,EAAEyD,QAAQ7E,EAAEI,GAAG,CAACL,EAAylB,SAAWA,EAAEC,GAAG,MAAM6E,QAAQ5E,GAAGD,EAAEoB,EAAErB,EAAE6C,QAAQkB,MAAM/D,GAAGA,EAAEK,KAAKH,KAAKF,EAAE8C,QAAQiB,MAAM/D,GAAGA,EAAEK,KAAKH,IAAI,OAAOmB,GAAsE,SAAWrB,EAAEC,GAAG,MAAMC,EAAE,cAAcF,GAAGA,EAAEiD,WAAW1C,KAAKc,GAAGpB,EAAE,QAAQ,YAAYoB,GAAGnB,GAAG,uBAAuBF,EAAEiD,WAAW,YAAY5B,IAAInB,GAAG,qBAAqBmB,IAAInB,GAAG,kBAAkBmB,IAAInB,EAAE,CAAxQyF,CAAEtE,EAAEpB,GAAGoB,EAAE,IAAI,CAAhtBuE,CAAExE,EAAEC,GAAG,yBAAyBrB,GAAGiD,WAAW,qBAAqB5B,EAAEd,MAAMc,EAAEwE,qBAAqBzC,IAAI,iBAAiBpD,GAAG,MAAMoB,EAAEgE,aAAapF,EAAEoF,WAAWhE,EAAEgE,WAAW,CAAC,OAAOlF,EAAE,GAAG,sBAAsBmB,GAAG,iBAAiBA,EAAE2D,oBAAoB3D,EAAE2D,kBAAkB,+BAA+BhF,CAAC,CAAC,OAAOoB,CAAC,C","sources":["../node_modules/@arcgis/core/portal/support/layersLoader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{parse as t}from\"../../layers/support/arcgisLayerUrl.js\";import{fetchFeatureService as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as a}from\"../../layers/support/LayerLoadContext.js\";import o from\"../Portal.js\";import{createForItemRead as n}from\"./jsonContext.js\";import{getFirstLayerOrTable as s,preprocessFSItemData as l,populateSceneServiceItemData as i,getNumLayersAndTables as u,createSublayerData as p,instanceTypeToLayerTypes as c,getSublayersByLayerType as y,layerTypeToLayerModuleType as m}from\"./loadUtils.js\";import{hasTypeKeyword as d}from\"./portalItemUtils.js\";import{loadStyleRenderer as f}from\"../../renderers/support/styleUtils.js\";import{fetchArcGISServiceJSON as w}from\"../../support/requestPresets.js\";async function h(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),g(e),e.validateItem&&e.validateItem(r),I(e,t)}function g(t){const r=t.instance.portalItem;if(!r?.type||!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r?.type,expectedType:t.supportedTypes.join(\", \")})}async function I(e,t){const r=e.instance,o=r.portalItem;if(!o)return;const{url:s,title:l}=o,i=n(o,\"portal-item\");if(\"group\"===r.type)return b(r,i,e);s&&\"media\"!==r.type&&r.read({url:s},i);const u=new a,p=await F(e,u,t);return p&&r.read(p,i),r.resourceReferences={portalItem:o,paths:i.readResourcePaths??[]},\"subtype-group\"!==r.type&&r.read({title:l},i),f(r,i)}async function b(t,r,a){const o=t.portalItem;if(!t.sourceIsPortalItem)return;const{title:n,type:s}=o;if(\"Group Layer\"===s){if(!d(o,\"Map\"))throw new e(\"portal:invalid-layer-item-typekeyword\",\"'Group Layer' item without 'Map' type keyword is not supported\");return L(t,a)}return t.read({title:n},r),S(t,a)}async function L(t,r){const a=t.portalItem,o=await a.fetchData(\"json\");if(!o)return;if(!r.populateGroupLayer)throw new e(\"portal:missing-populate-group-layer\",\"Missing populate group layer\");const s=n(a,\"web-map\");t.read(o,s),await r.populateGroupLayer(t,o,{context:s}),t.resourceReferences={portalItem:a,paths:s.readResourcePaths??[]}}async function S(t,r){let o;const{portalItem:n}=t;if(!n)return;const p=n.type,c=r.layerModuleTypeMap;if(!c)throw new e(\"portal:missing-layer-module-type-map\",\"Layer module type map is required to construct sub layers\");switch(p){case\"Feature Service\":case\"Feature Collection\":o=c.FeatureLayer;break;case\"Stream Service\":o=c.StreamLayer;break;case\"Scene Service\":o=c.SceneLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${p}' is not supported as a 'IGroupLayer'`)}const y=new a;let[m,d]=await Promise.all([o(),F(r,y)]),f=()=>m;if(\"Feature Service\"===p){const e=s(d)?.customParameters;d=n.url?await l(d,n.url,y):{},f=await D(d,c)||f;const r=await C(n.url,{customParameters:e,loadContext:y});return await v(t,f,f,d,c,r)}return\"Scene Service\"===p&&n.url&&(d=await i(n,d,y)),u(d)>0?await v(t,f,null,d,c):await T(t,f,c)}async function T(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const o=await w(a.url);o&&v(e,t,null,{layers:o.layers?.map(p),tables:o.tables?.map(p)},r)}async function v(e,t,r,a,o,n){let s=a.layers||[];const l=a.tables||[];if(\"Feature Collection\"===e.portalItem?.type?(s.forEach(((e,t)=>{e.id=t,\"Table\"===e?.layerDefinition?.type&&l.push(e)})),s=s.filter((e=>\"Table\"!==e?.layerDefinition?.type))):(s.reverse(),l.reverse()),s.forEach((r=>{const o=n?.(r);if(o||!n){const n=j(e,t(r),a,r,o);e.add(n)}})),l.length){const t=r?null:await o.FeatureLayer();l.forEach((o=>{const s=n?.(o);if(s||!n){const n=j(e,r?r(o):t,a,o,s);e.tables.add(n)}}))}}function j(e,t,r,a,n){const s=e.portalItem,l={portalItem:s.clone(),layerId:a.id};null!=a.url&&(l.url=a.url);const i=new t(l);if(\"sourceJSON\"in i&&(i.sourceJSON=n),\"subtype-group\"!==i.type&&\"catalog\"!==i.type&&(i.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===s.type){const e={origin:\"portal-item\",portal:s.portal||o.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function F(e,t,r){if(!1===e.supportsData)return;const a=e.instance,o=a.portalItem;if(!o)return;let n=null;try{n=await o.fetchData(\"json\",r)}catch(l){}if(x(a)){let e=null;const r=await M(o,n,t);if((n?.layers||n?.tables)&&r>0){if(null==a.layerId){const e=c(a.type),t=e?.length?y(n,e)[0]:s(n);t&&(a.layerId=t.id)}e=P(n,a),\"OrientedImageryLayer\"===e?.layerType&&\"oriented-imagery\"===a.type&&a.supportedSourceTypes.add(\"Feature Layer\"),e&&null!=n.showLegend&&(e.showLegend=n.showLegend)}return r>1&&\"sublayerTitleMode\"in a&&\"service-name\"!==a.sublayerTitleMode&&(a.sublayerTitleMode=\"item-title-and-service-name\"),e}return n}async function M(e,r,a){if(r?.layers&&r?.tables)return u(r);const o=t(e.url);if(!o)return 1;const n=await a.fetchServiceMetadata(o.url.path,{customParameters:s(r)?.customParameters}).catch((()=>null));return(r?.layers?.length??n?.layers?.length??0)+(r?.tables?.length??n?.tables?.length??0)}function P(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&G(a,t)?a:null}function x(e){return\"stream\"!==e.type&&\"layerId\"in e}function G(e,t){const r=\"layerType\"in e&&e.layerType,{type:a}=t;return!(\"feature\"===a&&r&&\"ArcGISFeatureLayer\"!==e.layerType||\"catalog\"===a&&!r||\"oriented-imagery\"===a&&!r||\"subtype-group\"===a&&!r)}async function C(e,t){const{layersJSON:a}=await r(e,t);if(!a)return null;const o=[...a.layers,...a.tables];return e=>o.find((t=>t.id===e.id))}async function D(e,t){const{layers:r,tables:a}=e,o=[...r??[],...a??[]];if(!o.length)return;const n=new Set,s=[];for(const{layerType:u}of o){const e=u??\"ArcGISFeatureLayer\";if(n.has(e))continue;n.add(e);const r=t[m(e)];s.push(r())}const l=await Promise.all(s),i=new Map;return Array.from(n).forEach(((e,t)=>{i.set(e,l[t])})),({layerType:e})=>{const t=e??\"ArcGISFeatureLayer\";return i.get(t)}}export{h as load};\n"],"names":["async","h","e","t","r","instance","portalItem","id","load","type","supportedTypes","includes","expectedType","join","g","validateItem","o","url","s","title","l","i","n","a","sourceIsPortalItem","d","fetchData","populateGroupLayer","read","context","resourceReferences","paths","readResourcePaths","L","p","c","layerModuleTypeMap","FeatureLayer","StreamLayer","SceneLayer","y","m","Promise","all","F","f","customParameters","layers","tables","length","Set","layerType","u","has","add","push","Map","Array","from","forEach","set","_ref","get","D","layersJSON","find","C","loadContext","v","w","map","T","S","b","I","layerDefinition","filter","reverse","j","clone","layerId","sourceJSON","sublayerTitleMode","origin","portal","getDefault","showLegend","supportsData","x","fetchServiceMetadata","path","catch","M","G","P","supportedSourceTypes"],"sourceRoot":""}