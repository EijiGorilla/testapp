"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[98156,98344],{43543:(t,e,i)=>{i.d(e,{F:()=>s});var r=i(98156);function s(t,e,i){if(null==t?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:n,useViewTime:a}=t;let l=t.timeExtent;s&&(l=(0,r.toLocalTimeExtent)(l));let h=a?e&&l?e.intersection(l):e||l:l;return!h||h.isEmpty||h.isAllTime?h:(n&&(h=h.offset(-n.value,n.unit)),s&&(h=(0,r.toUTCTimeExtent)(h)),h.equals(i)?i:h)}},47777:(t,e,i)=>{i.d(e,{A:()=>h});var r=i(35143),s=i(46053),n=(i(81806),i(76460),i(47249),i(85842)),a=i(1420),l=i(43543);const h=t=>{let e=class extends t{initialize(){this.exportImageParameters=new a.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,l.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,r._)([(0,s.MZ)()],e.prototype,"exportImageParameters",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],e.prototype,"floors",null),(0,r._)([(0,s.MZ)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,r._)([(0,s.MZ)()],e.prototype,"layer",void 0),(0,r._)([(0,s.MZ)()],e.prototype,"suspended",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),e=(0,r._)([(0,n.$)("esri.views.layers.MapImageLayerView")],e),e}},70822:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(35143),s=(i(76460),i(81806),i(47249),i(50076),i(85842)),n=i(61551),a=i(8995),l=i(13692);let h=class extends a.f{get hasHighlight(){return this.children.some((t=>t.hasData))}renderChildren(t){this.attributeView.update(),t.drawPhase===n.S5.HIGHLIGHT&&this.children.some((t=>t.hasData))&&(super.renderChildren(t),t.context.setColorMask(!0,!0,!0,!0),(0,l.lB)(t,!1,(t=>{this._renderChildren(t,n.RI.Highlight)})))}};h=(0,r._)([(0,s.$)("esri.views.2d.layers.graphics.HighlightGraphicContainer")],h);const o=h},98156:(t,e,i)=>{i.r(e),i.d(e,{getTimeExtentFromLayers:()=>m,getTimeSliderSettingsFromWebDocument:()=>g,toLocalTimeExtent:()=>f,toUTCTimeExtent:()=>c});var r=i(18690),s=i(53084),n=i(18288),a=i(59187),l=i(42052),h=i(72027);function o(t){return void 0!==t.timeInfo}async function u(t,e){return t.widgets?.timeSlider?.fullTimeExtent??m(t.allLayers,e)}function p(t){const{numStops:e,stopInterval:i,stops:r}=t;return r?{dates:(0,s.clone)(r)}:i?{interval:i.clone()}:{count:e??5}}async function m(t,e){if(0===t.length)return a.default.allTime;await Promise.all(t.map((t=>t.load({signal:e}))));const i=t.filter(o),s=t.filter((t=>!o(t)&&null!=t.visibilityTimeExtent));if(0===i.length&&0===s.length)return a.default.allTime;const n=[],l=[];for(const r of i)"feature"!==r?.type&&"map-image"!==r?.type||!r.timeInfo?.hasLiveData?l.push(r):n.push(r);const h=t=>null==t||t.isAllTime,u=[...l.map((t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return e?.intersection(i)??i})),...s.map((t=>t.visibilityTimeExtent))];if(u.some(h))return a.default.allTime;const p=n.map((async t=>{const i=(await t.fetchRecomputedExtents({signal:e}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=t;return i?.intersection(r)??r})),m=(await Promise.allSettled(p)).map((t=>"fulfilled"===t.status?t.value:null));if(m.some(h))return a.default.allTime;const d=[...m,...u].filter(r.Ru);return 0===d.length?a.default.allTime:d.reduce(((t,e)=>t.union(e)))}function d(t,e){const i=t.currentTimeExtent;if(!i)return null;const{start:r,end:s}=i,n=r??s??null;switch(e){case"time-window":return new a.default({start:r,end:s});case"cumulative-from-start":return new a.default({start:null,end:n});case"cumulative-from-end":return new a.default({start:n,end:null});case"instant":return new a.default({start:n,end:n})}}async function g(t,e){if(!(0,l.r)(t)&&!function(t){return null!=t&&"object"==typeof t&&h.X in t}(t))return null;await t.load({signal:e});const i=t?.widgets?.timeSlider;if(!i)return null;const r=await u(t,e),s=i.loop,n=function(t){const e=t.numThumbs??2,i=t.currentTimeExtent;if(i){const{start:t,end:r}=i;return null!=t&&null!=r&&t.getTime()===r.getTime()?"instant":2===e?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===e?"time-window":"cumulative-from-start"}(i);return{fullTimeExtent:r,loop:s,mode:n,playRate:i.stopDelay??2e3,stops:p(i),timeExtent:d(i,n)}}function c(t){if(!t)return t;const{start:e,end:i}=t;return new a.default({start:null!=e?(0,n.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,n.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}function f(t){if(!t)return t;const{start:e,end:i}=t;return new a.default({start:null!=e?(0,n.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,n.S1)(i,i.getTimezoneOffset(),"minutes"):i})}},98344:(t,e,i)=>{i.r(e),i.d(e,{default:()=>H});var r=i(35143),s=i(54901),n=i(76460),a=i(50346),l=i(68134),h=i(46053),o=(i(81806),i(47249),i(85842)),u=i(64519),p=i(14509),m=i(2101),d=i(69679),g=i(70822),c=i(4176),f=i(13692),y=i(91196),w=i(47777),x=i(771),v=i(58423),_=i(55754),T=i(1723);let E=class extends((0,w.A)((0,x.A)((0,m.e)(y.default)))){constructor(){super(...arguments),this._highlightGraphics=new u.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){const e=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==e&&(this._updateHash=e,this.strategy.update(t).catch((t=>{(0,a.isAbortError)(t)||n.A.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,r=i>=10.3,s=i>=10;this._bitmapContainer=new p.l,this.container.addChild(this._bitmapContainer),this._highlightView=new d.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new v.Uh({createFetchPopupFeaturesQueryGeometry:(t,e)=>(0,_.V)(t,e,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,e)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:e})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new c.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:r,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles((0,l.watch)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t,e){const i=(0,f.Oq)(t);if(0===i.length)return(0,s.hA)();const r=e?.name??T.Tv;return this._addHighlightGraphics(i,r),(0,s.hA)((()=>!this.destroyed&&this._removeHighlightGraphics(i,r)))}_processHighlight(){const t=this._getHighlights();this._highlightView?.setHighlight(t)}_addHighlightGraphics(t,e){this._highlightGraphics.addMany(t),this._addHighlights(t.map((t=>t.uid)),e)}_removeHighlightGraphics(t,e){this._highlightGraphics.removeMany(t),this._removeHighlights(t.map((t=>t.uid)),e)}};(0,r._)([(0,h.MZ)()],E.prototype,"strategy",void 0),(0,r._)([(0,h.MZ)()],E.prototype,"updating",void 0),E=(0,r._)([(0,o.$)("esri.views.2d.layers.MapImageLayerView2D")],E);const H=E}}]);
//# sourceMappingURL=98344.4ebbcf9e.chunk.js.map