"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[49587],{49587:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var i=r(35143),s=r(19276),o=r(54901),a=r(53521),n=r(87663),l=r(77717),d=r(67993),y=r(68134),p=r(75540),h=r(46053),u=r(40565),c=(r(81806),r(47249),r(85842)),_=r(25515),f=r(65624),g=r(5682),v=r(95363),b=r(51162),m=r(72003);let L=class extends((0,g.j)((0,f.dM)((0,l.P)(_.default)))){constructor(e){super(e),this._layerCache=new a.q(20,(e=>e.destroy())),this._oidToReference=new d.A,this._layerToReference=new Map,this.legendEnabled=!0,this.layers=new s.default,this.maximumVisibleSublayers=10,this.opacity=1,this.parent=null,this.persistenceEnabled=!0,this.title="Layers in view",this.type="catalog-dynamic-group",this.visible=!0}initialize(){this.addHandles([this.layers.on("after-add",(e=>{let{item:t}=e;t.parent=this})),this.layers.on("after-remove",(e=>{let{item:t}=e;t.parent=null})),(0,y.watch)((()=>this._orderBy),(()=>{this._updateLayerSortValues(),this._sortAllLayers()}))])}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}destroy(){this._layerCache.destroy(),this._oidToReference.clear(),this._layerToReference.clear()}get _orderBy(){return this.parent?this.parent.orderBy?.find((e=>!e.valueExpression&&e.field))??new b.default({field:this.parent.objectIdField}):null}get _referenceComparator(){const e=this._orderBy;if(!this.parent||!e)return()=>0;const t=this.parent.fieldsIndex.get(e.field),r=(0,m.FM)(t?.toJSON().type,"descending"===e.order),i=(0,m.FM)("esriFieldTypeOID","descending"===e.order);return(e,t)=>r(t.sortValue,e.sortValue)||i(t.objectId,e.objectId)}get fullExtent(){return this.parent?.fullExtent??null}get updating(){return(0,n.Bs)(this._oidToReference,(e=>{let{pending:t}=e;return null!=t}))}acquireLayer(e){if(this.destroyed)return(0,o.hA)();const t=this._getLayerReference(e);return t.count++,(0,o.hA)((()=>{t.count--,t.count||this._destroyLayerReference(t)}))}_getLayerReference(e){const t=e.getObjectId();return(0,n.tE)(this._oidToReference,t,(()=>{const t=e.getObjectId(),r=`${t}`,i=e.getAttribute(this.parent.itemSourceField),s=new R(e,t,i),o=this._layerCache.pop(r);return o?(this._addLayer(s,o),s):(s.pending=this.parent.createLayerFromFootprint(e).then((e=>{s.count?this._addLayer(s,e):(this.destroyed||this._layerCache.get(r)||this._layerCache.put(r,e),s.layer=null)})).catch((()=>{})).finally((()=>{s.pending=null})),s)}))}_destroyLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),this.destroyed?e.layer.destroy():this._layerCache.put(`${e.objectId}`,e.layer),e.layer=null),this._oidToReference.delete(e.objectId)}_addLayer(e,t){e.layer=t,t.persistenceEnabled=!1,this._layerToReference.set(t,e),this._updateLayerSortValue(e),this.layers.add(t),this._sortAllLayers()}_updateLayerSortValues(){for(const e of this._layerToReference.values())this._updateLayerSortValue(e)}_updateLayerSortValue(e){this._orderBy&&(e.sortValue=e.footprint.getAttribute(this._orderBy.field))}_sortAllLayers(){this.layers.sort(((e,t)=>this._referenceComparator(this._layerToReference.get(e),this._layerToReference.get(t))))}};(0,i._)([(0,h.MZ)()],L.prototype,"_orderBy",null),(0,i._)([(0,h.MZ)({readOnly:!0})],L.prototype,"_referenceComparator",null),(0,i._)([(0,h.MZ)(v.fV)],L.prototype,"legendEnabled",void 0),(0,i._)([(0,h.MZ)({type:["show","hide","hide-children"],json:{write:!0}})],L.prototype,"listMode",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],L.prototype,"fullExtent",null),(0,i._)([(0,h.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0,isRequired:!0}}})],L.prototype,"id",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],L.prototype,"layers",void 0),(0,i._)([(0,h.MZ)({type:u.jz,range:{min:0,max:50},json:{write:!0,default:10}})],L.prototype,"maximumVisibleSublayers",void 0),(0,i._)([(0,h.MZ)(v.ke)],L.prototype,"opacity",void 0),(0,i._)([(0,h.MZ)({clonable:!1})],L.prototype,"parent",void 0),(0,i._)([(0,h.MZ)({type:String,nonNullable:!0,json:{write:{ignoreOrigin:!0,isRequired:!0}}})],L.prototype,"title",void 0),(0,i._)([(0,h.MZ)({json:{read:!1}})],L.prototype,"type",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],L.prototype,"updating",null),(0,i._)([(0,h.MZ)({type:Boolean,json:{name:"visibility",write:!0}})],L.prototype,"visible",void 0),L=(0,i._)([(0,c.$)("esri.layers.catalog.CatalogDynamicGroupLayer")],L);const M=L;class R{constructor(e,t,r){this.footprint=e,this.objectId=t,this.itemSource=r,this.count=0,this.layer=null,this.sortValue=void 0,this._pending=(0,p.v)(null)}get pending(){return this._pending.value}set pending(e){this._pending.value=e}}}}]);
//# sourceMappingURL=49587.91f36adf.chunk.js.map