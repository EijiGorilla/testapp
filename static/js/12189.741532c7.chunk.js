"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[12189],{12189:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var r=i(35143),s=i(46053),n=(i(81806),i(76460),i(47249),i(85842)),o=i(19247),a=i(64465),h=i(67234),l=i(78702),d=i(32344),p=i(42151),c=i(57308),u=i(82307),_=i(974),m=i(59833),v=i(11500);let g=class extends h.default{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){"click"===this.mode?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,v.ZV)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),c.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,v.ZV)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()))}),c.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,v.ZV)(e),this._updateCursor())}),c.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,v.ZV)(e),this._updateCursor())}),c.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),c.o.TOOL),this.view.on("key-down",(e=>{e.key===u.NE.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===u.NE.pan&&(this._panEnabled=!0)}),c.o.TOOL),this.view.on("key-up",(e=>{e.key===u.NE.pan&&(this._panEnabled=!1)}),c.o.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),c.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),c.o.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,v.ZV)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()}),c.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,v.ZV)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor()}),c.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),c.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),c.o.TOOL),this.view.on("key-down",(e=>{e.key===u.NE.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===u.NE.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),c.o.TOOL)]}_addDrawTool(){const e=new l.B({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new d.Sf(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new d.sQ(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new d.cH(e.getVertexCoords())),this._removeDrawTool()})),this.view.on("key-down",(t=>{t.key!==u.NE.vertexAdd||t.repeat||"click"!==this.mode?t.key!==u.NE.complete||t.repeat||e.completeCreateOperation():e.drawOperation.numCommittedVertices>0?e.completeCreateOperation():e.drawOperation.commitStagedVertex()}),c.o.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(t))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=(0,p.ZP)(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,r=new d.Sf(this.view,i,this.vertices);this.emit("vertex-add",r)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=e&&this._pushCursorVertex(e.vertex,(()=>this.emit("cursor-update",new d.sQ(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new o.default(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new d.cH(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new m.p(new _.ZE("polygon",this._coordinateHelper),a.RT.Local),this._activeComponent=new _.uA(this._coordinateHelper.spatialReference,a.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,r._)([(0,s.MZ)({type:["freehand","click"]})],g.prototype,"mode",void 0),g=(0,r._)([(0,n.$)("esri.views.draw.SegmentDrawAction")],g);const w=g},42151:(e,t,i)=>{i.d(t,{E5:()=>u,ZP:()=>g,vz:()=>m});var r=i(18690),s=i(94967),n=i(99809),o=i(60008),a=i(4336),h=i(20664),l=i(9392),d=i(19247),p=i(5568);function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?[e,t,i]:[e,t]}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?{x:e,y:t,z:i}:{x:e,y:t}}class _{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(r.Ru)}get doUnnormalization(){return!1}}class m extends _{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t),this._defaultZ=i,this.transform=(0,n.vt)(),this.transformInv=(0,n.vt)(),this.transform=(0,n.o8)(e),(0,s.B8)(this.transformInv,this.transform)}makeMapPoint(e,t){return c(e,t,this._defaultZ)}mapToLocal(e){return u(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return c(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class v extends _{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,l.vt)(),this.tangentFrameUpWS=(0,l.vt)(),this.tangentFrameRightWS=(0,l.vt)(),this.tangentFrameForwardWS=(0,l.vt)(),this.localFrameRightWS=(0,l.vt)(),this.localFrameUpWS=(0,l.vt)(),this.worldToLocalTransform=(0,a.vt)(),this.localToWorldTransform=(0,a.vt)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,p._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,p._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,p._.Z,this.tangentFrameForwardWS);const r=(0,l.vt)();(0,h.h)(r,this.tangentFrameForwardWS,(0,h.f)(i,this.tangentFrameForwardWS)),(0,h.d)(this.localFrameRightWS,i,r),(0,h.n)(this.localFrameRightWS,this.localFrameRightWS),(0,h.e)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,o.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,o.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return c(e,t,this.defaultZ)}mapToLocal(e){const t=(0,l.vt)();this.view.renderCoordsHelper.toRenderCoords(new d.default({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,h.w)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new d.default({spatialReference:this.view.spatialReference}));return null!=i?u(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=(0,l.vt)();this.view.renderCoordsHelper.toRenderCoords(new d.default({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,h.w)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new d.default({spatialReference:this.view.spatialReference}));return null!=i?c(i.x,i.y,this.defaultZ):null}}function g(e,t){if("2d"===e.type)return new m(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new d.default({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new d.default({x:t[0],y:t[1],spatialReference:e.spatialReference});return new v(e,i)}return null}}}]);
//# sourceMappingURL=12189.741532c7.chunk.js.map