{"version":3,"file":"static/js/58206.eb60e4a0.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/analysis/Viewshed.js","../node_modules/@arcgis/core/analysis/featureReferenceUtils.js","../node_modules/@arcgis/core/analysis/ViewshedAnalysis.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import{featureReferenceEquals as r,featureReferenceProperty as i}from\"./featureReferenceUtils.js\";import o from\"../core/Clonable.js\";import{cyclicalDegrees as t}from\"../core/Cyclical.js\";import s from\"../core/JSONSupport.js\";import{equalsMaybe as a}from\"../core/maybe.js\";import{property as l}from\"../core/accessorSupport/decorators/property.js\";import{cast as n}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/has.js\";import\"../core/RandomLCG.js\";import{subclass as p}from\"../core/accessorSupport/decorators/subclass.js\";import{ensureNumber as c}from\"../core/accessorSupport/ensureType.js\";import m from\"../geometry/Point.js\";let u=class extends(s.JSONSupportMixin(o)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45,this.feature=null}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return a(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView&&r(this.feature,e.feature)}};e([l({type:m,json:{write:{isRequired:!0}}})],u.prototype,\"observer\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],u.prototype,\"farDistance\",void 0),e([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),n((e=>t.normalize(c(e),void 0,!0)))],u.prototype,\"heading\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,\"tilt\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}})],u.prototype,\"horizontalFieldOfView\",void 0),e([l({type:Number,nonNullable:!0,range:{min:0,max:180},json:{write:{isRequired:!0}}})],u.prototype,\"verticalFieldOfView\",void 0),e([l(i)],u.prototype,\"feature\",void 0),e([l({json:{read:!1}})],u.prototype,\"isValid\",null),u=e([p(\"esri.analysis.Viewshed\")],u);const d=u;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{a as e,l as t,b as r}from\"../chunks/vec32.js\";import{create as n}from\"../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as l,fromPoints as o}from\"../geometry/support/ray.js\";import{StoreResults as i}from\"../views/3d/webgl-engine/lib/IntersectorInterfaces.js\";import{toGraphic as u,hasLod as s,getIntersectedFeatureBSRadius as a}from\"../views/3d/webgl-engine/lib/intersectorUtilsConversions.js\";function c(e,t){return d(e)===d(t)}function d(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:\"\";let r=null;return r=null!=e.objectId?e.objectId:null!=e.layer&&\"objectIdField\"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==r?null:`o-${t}-${r}`}const b={json:{write:{writer:f,target:{\"feature.layerId\":{type:[Number,String],isRequired:!0},\"feature.objectId\":{type:[Number,String],isRequired:!0}}},origins:{\"web-scene\":{read:I}}}};function f(e,t){null!=e?.layer?.objectIdField&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function I(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:\"ObjectId\"},attributes:{ObjectId:e.objectId}}}function m(l,s,a,c){const{sceneIntersectionHelper:b}=l,{observer:f,observerFeatureId:I,targetFeatureId:m,target:g}=a;if(null==I&&null==m)return;c||(c=e=>e),e(p,f,g);const v=t(p),S=1;r(p,f,p,S/v);const F=o(p,g,y);s.options.store=i.ALL,b.intersectToolIntersectorRay(F,s);let N=null,w=null,R=null,A=null;for(const e of s.results.all){const t=u(e,l);if(null==t||null==e.distanceInRenderSpace)continue;const r=d(t);null!=r&&(null!=I&&r===I&&(N??=c(j(e,l,v)),e.distanceInRenderSpace-S<N&&(R=e)),null!=m&&r===m&&(w??=c(j(e,l,v)),null==A&&e.distanceInRenderSpace-S<v&&v-e.distanceInRenderSpace+S<w&&(A=e)))}const{observerAdjusted:T,targetAdjusted:h}=a;R?.getIntersectionPoint(T)?a.observerSurfaceNormal=R.getTransformedNormal(n()):a.observerSurfaceNormal=null,A?.getIntersectionPoint(h)?a.targetSurfaceNormal=A.getTransformedNormal(n()):a.targetSurfaceNormal=null}function j(e,t,r){if(s(e)){const n=a(e,t);if(null!=n)return Math.min(n*g,r)}return 1e-5*r}const g=.05,y=l(),p=n();export{c as featureReferenceEquals,b as featureReferenceProperty,d as getFeatureId,m as updatePointsFromFeatureReference};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"./Analysis.js\";import r from\"./Viewshed.js\";import n from\"../core/Collection.js\";import{referenceSetter as s,castForReferenceSetter as i}from\"../core/collectionUtils.js\";import{cyclicalDegrees as o}from\"../core/Cyclical.js\";import{deg2rad as l,clamp as a}from\"../core/mathUtils.js\";import{watch as p,syncAndInitial as c}from\"../core/reactiveUtils.js\";import{property as u}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/Logger.js\";import\"../core/RandomLCG.js\";import{subclass as m}from\"../core/accessorSupport/decorators/subclass.js\";import d from\"../geometry/Extent.js\";import{projectOrLoadMany as h}from\"../geometry/projection.js\";const f=n.ofType(r);let x=class extends t{constructor(e){super(e),this.type=\"viewshed\",this._extent=null}initialize(){this.addHandles(p((()=>this._computeExtent()),(e=>{null==e.pending&&(this._extent=e.extent)}),c))}get viewsheds(){return this._get(\"viewsheds\")||new f}set viewsheds(e){this._set(\"viewsheds\",s(e,this.viewsheds,f))}get spatialReference(){for(const e of this.viewsheds)if(null!=e.observer)return e.observer.spatialReference;return null}get extent(){return this._extent}get requiredPropertiesForEditing(){return this.viewsheds.items.map((({observer:e})=>e))}async waitComputeExtent(){const e=this._computeExtent();null!=e.pending&&await e.pending}_computeExtent(){const{spatialReference:e}=this;if(null==e)return{pending:null,extent:null};const t=this.viewsheds.filter((e=>null!=e.observer)),r=t.map((e=>e.observer)).toArray(),n=h(r,e);if(null!=n.pending)return{pending:n.pending,extent:null};return{pending:null,extent:n.geometries.map(((e,r)=>{const n=t.at(r);return null!=e&&null!=n?this._computeViewshedExtent(this.viewsheds.at(r),e):null})).filter((e=>null!=e)).reduce(((e,t)=>y(e,t)),null)}}_computeViewshedExtent(e,t){const{farDistance:r,heading:n,tilt:s,horizontalFieldOfView:i,verticalFieldOfView:p}=e,{spatialReference:c}=t,u=i/2,m=p/2,h=r/c.metersPerUnit,f=[o.normalize(n-u),n,o.normalize(n+u)],x=d.fromPoint(t),y=e=>{const t=f.map((t=>o.normalize(t-e)));if(t[0]>t[2]||360===i)return h;const r=t.map((e=>Math.abs(e>180?360-e:e))).reduce(((e,t)=>e>t?t:e));return r>90?0:h*Math.cos(l(r))};x.xmax+=y(90),x.xmin-=y(-90),x.ymax+=y(0),x.ymin-=y(180);const w=t.z;if(null!=w){let e=w,t=w;const n=s-90,i=a(n+m,-90,90),o=a(n-m,-90,90),l=c?.isGeographic?r:h;e+=l*g(i),t+=l*g(o);const p=v(m)*l,d=g(n)*p*(1-v(u));s<90&&(e-=d),s>90&&(t-=d),x.zmax=Math.max(e,w),x.zmin=Math.min(t,w)}return x}clear(){this.viewsheds.removeAll()}};function y(e,t){return null==e?t:null==t?e:e.union(t)}function v(e){return Math.cos(l(e))}function g(e){return Math.sin(l(e))}e([u({type:[\"viewshed\"]})],x.prototype,\"type\",void 0),e([u({cast:i,type:f,nonNullable:!0})],x.prototype,\"viewsheds\",null),e([u({readOnly:!0})],x.prototype,\"spatialReference\",null),e([u()],x.prototype,\"_extent\",void 0),e([u({readOnly:!0})],x.prototype,\"extent\",null),e([u({readOnly:!0})],x.prototype,\"requiredPropertiesForEditing\",null),x=e([m(\"esri.analysis.ViewshedAnalysis\")],x);const w=x;export{w as default};\n"],"names":["u","s","JSONSupportMixin","o","constructor","e","super","this","observer","farDistance","heading","tilt","horizontalFieldOfView","verticalFieldOfView","feature","isValid","equals","a","r","l","type","m","json","write","isRequired","prototype","Number","nonNullable","range","min","n","t","normalize","c","max","i","read","p","d","layer","id","objectId","objectIdField","attributes","uid","b","writer","layerId","target","String","origins","ObjectId","sceneIntersectionHelper","f","observerFeatureId","I","targetFeatureId","g","v","F","y","options","store","ALL","intersectToolIntersectorRay","N","w","R","A","results","all","distanceInRenderSpace","j","observerAdjusted","T","targetAdjusted","h","getIntersectionPoint","observerSurfaceNormal","getTransformedNormal","targetSurfaceNormal","Math","ofType","x","_extent","initialize","addHandles","_computeExtent","pending","extent","viewsheds","_get","_set","spatialReference","requiredPropertiesForEditing","items","map","_ref","waitComputeExtent","filter","toArray","geometries","at","_computeViewshedExtent","reduce","union","metersPerUnit","fromPoint","abs","cos","xmax","xmin","ymax","ymin","z","isGeographic","zmax","zmin","clear","removeAll","sin","cast","readOnly"],"sourceRoot":""}