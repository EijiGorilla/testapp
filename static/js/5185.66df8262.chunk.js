"use strict";(self.webpackChunktestapp=self.webpackChunktestapp||[]).push([[5185],{5185:(e,a,r)=>{r.r(a),r.d(a,{createRenderer:()=>q,createRendererForClustering:()=>j,regenerateRenderer:()=>F});var t=r(69539),n=r(18690),i=r(59784),l=r(50076),o=r(76931),s=r(63860),u=r(3522),c=r(22993),d=r(41626),p=r(79364),m=r(59536),f=r(84563),h=r(33766),y=r(31650),b=r(87990),g=r(53680),w=r(51006),v=r(15231),z=r(28383),S=r(90494),E=r(42633),C=r(11563),T=r(37590),x=r(38996),V=r(29632);const k=[C.mb.CSVLayer,C.mb.FeatureLayer,C.mb.GeoJSONLayer,C.mb.KnowledgeGraphSublayer,C.mb.OGCFeatureLayer,C.mb.OrientedImageryLayer,C.mb.ParquetLayer,C.mb.StreamLayer,C.mb.WFSLayer];async function O(e){if(!(e?.layer&&e.view&&e.attributes?.length))throw new l.default("pie-chart-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(e.attributes.length>10)throw new l.default("pie-chart-renderer:invalid-parameters","PieChart renderer does not support more than 10 attributes");e.forBinning&&(0,S.p)(e,"pie-chart-renderer");const a={...e,layer:e.layer,view:e.view,attributes:e.attributes};a.shape=a.shape||"pie",a.othersCategoryEnabled??=!0,a.includeSizeVariable=e.includeSizeVariable||!1;const r=e.forBinning?C.Mi:k,t=(0,C.Jg)(a.layer,r,e.forBinning);if(!t)throw new l.default("pie-chart-renderer:invalid-parameters","'layer' must be one of these types: "+(0,C.Ho)(r).join(", "));const n=null!=a.signal?{signal:a.signal}:null;await Promise.all([e.view.when(),t.load(n)]);const i=t.geometryType,o="polygon"===i,s="point"===i||"multipoint"===i||o;if(a.outlineOptimizationEnabled=!!o&&a.outlineOptimizationEnabled,a.sizeOptimizationEnabled=!!s&&a.sizeOptimizationEnabled,!s)throw new l.default("pie-chart-renderer:not-supported","PieChart renderer is only supported for point and polygon layers");const u=[],c=a.attributes;for(const l of c){const e=await(0,E.EG)({field:l.field,valueExpression:l.valueExpression});u.push(...e)}const d=(0,w.MH)(t,u.filter(Boolean),"pie-chart-renderer:invalid-parameters");if(d)throw d;return{...a,layer:t}}async function I(e){let a=e.pieChartScheme,r=null,t=null;const n=await(0,w.Ib)(e.basemap,e.view);if(r=null!=n.basemapId?n.basemapId:null,t=null!=n.basemapTheme?n.basemapTheme:null,a)return{scheme:(0,T.cloneScheme)(a),basemapId:r,basemapTheme:t};const i=(0,T.getSchemes)({numColors:e.attributes.length,geometryType:e.layer.geometryType,basemapTheme:t});return i&&(a=i.primaryScheme,r=i.basemapId,t=i.basemapTheme),{scheme:a,basemapId:r,basemapTheme:t}}async function $(e,a){const{valueExpression:r,sqlExpression:t,sqlWhere:n}=(0,z.D9)(e.attributes),i=await(0,s.ud)("esri/smartMapping/t9n/smartMapping");return(0,b.createVisualVariables)({layer:e.layer,basemap:e.basemap,valueExpression:r,sqlExpression:t,sqlWhere:n,sizeScheme:a,sizeOptimizationEnabled:e.sizeOptimizationEnabled,legendOptions:{title:i.sumOfCategories},view:e.view,signal:e.signal})}async function q(e){const[a,r]=await Promise.all([O(e),(0,s.ud)("esri/smartMapping/t9n/smartMapping")]),t=await I(a),u=t?.scheme;if(!u)throw new l.default("pie-chart-renderer:insufficient-info","Unable to find pie-chart scheme");const{layer:c,includeSizeVariable:b,sizeOptimizationEnabled:g,outlineOptimizationEnabled:z,view:S,signal:E,filter:C}=a,V=u.sizeScheme,k=a.attributes,q=k.map((e=>e.field)).filter(n.Ru),[F,L,M,R]=await Promise.all([q.length>1?(0,v.default)({layer:c,fields:q,view:S,signal:E,filter:C}):null,b?$(a,V):null,!b&&g?(0,y.default)({layer:c,view:S,signal:E,filter:C}).catch(w.ou):null,z?(0,h.A)({layer:c,view:S,signal:E,filter:C}).catch(w.ou):null]),A=F?.predominantCategoryInfos?{uniqueValueInfos:F.predominantCategoryInfos}:{uniqueValueInfos:q.map((e=>({value:e,count:0})))},j=(0,i.Iy)(u.colors,k.length),G=k.map(((e,a)=>new p.default({field:e.field,valueExpression:e.valueExpression,label:e.label,valueExpressionTitle:e.valueExpressionTitle,color:j[a]}))),H=c.geometryType,J=null!=V&&"background"in V&&V.background,N=new d.default({attributes:G,othersCategory:new m.i({label:r.other,color:a.othersCategoryEnabled?u.colorForOthersCategory:null,threshold:.04}),holePercentage:"donut"===a.shape?.45:0,backgroundFillSymbol:J?(0,w.v5)(H,{type:"2d",color:J.color,outline:(0,w.qc)(J,H,R?.opacity)}):null,size:(0,o.cr)(u.size),outline:new x.default((0,w.qc)(u,"point",R?.opacity)),legendOptions:f.A.from(a.legendOptions)});if(L&&(B(L,g,H),N.authoringInfo=L.authoringInfo.clone(),N.visualVariables=L.visualVariables?.map((e=>e.clone()))),R?.visualVariables?.length){const e=R.visualVariables.map((e=>e.clone())).filter((e=>"color"!==e.type&&"rotation"!==e.type));N.visualVariables?N.visualVariables.push(...e):N.visualVariables=e}return M?.minSize&&(P(M,H),N.visualVariables?N.visualVariables.push(M.minSize):N.visualVariables=[M.minSize]),{renderer:N,pieChartScheme:(0,T.cloneScheme)(u),size:L,basemapId:t.basemapId,basemapTheme:t.basemapTheme,statistics:A}}async function F(e){const{creatorParameters:a,view:r,signal:t,filter:n,renderer:i}=await async function(e){const a="regenerate-pie-chart-renderer";await(0,g.AC)(e,a);const r=await(0,g.mE)(e);if("pie-chart"!==(0,g.UJ)(r))throw new l.default(`${a}:invalid-parameters`,"Renderer is invalid");const{visualVariables:t}=r,{layer:n,forBinning:i,filter:o,view:s,signal:u}=e,c=(0,g.DW)(r),d=(0,g.Rv)(r),p=t?.some(g.OW),m=r.attributes.map((e=>({field:e.field,label:e.label,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle}))),f=await O({layer:n,attributes:m,outlineOptimizationEnabled:c,sizeOptimizationEnabled:d,includeSizeVariable:p,forBinning:i,filter:o,view:s,signal:u});return{...e,creatorParameters:f,renderer:r}}(e),{layer:o,outlineOptimizationEnabled:s,includeSizeVariable:u,sizeOptimizationEnabled:c}=a,d=await I(a),p=d?.scheme?.sizeScheme,[m,f,b]=await Promise.all([s?(0,h.A)({layer:o,view:r,signal:t,filter:n}).catch(w.ou):null,u?$(a,p):null,!u&&c?(0,y.default)({layer:o,view:r,signal:t,filter:n}).catch(w.ou):null]),v=o.geometryType;if(f&&(B(f,c,v),(0,g.ke)(i,f?.visualVariables,g.Jy),(0,g.Hj)(i,f?.authoringInfo,"size")),m?.visualVariables?.length){const e=m.visualVariables.map((e=>e.clone())).filter((e=>"color"!==e.type&&"rotation"!==e.type));(0,g.ke)(i,e,g._i)}return b?.minSize&&(P(b,v),(0,g.ke)(i,b?.minSize,g.kc)),{renderer:i}}function B(e,a,r){a||e.visualVariables.forEach((e=>{"number"==typeof e.minSize&&"number"==typeof e.maxSize&&(e.minSize*=2.5,e.maxSize*=1.8)})),a&&"point"===r&&e.visualVariables.forEach((e=>{e?.minSize&&"object"==typeof e.minSize&&e.minSize?.stops?.forEach((e=>{e.size*=1.8}))}))}function P(e,a){"point"===a&&e.minSize.stops?.forEach((e=>{e.size*=2.5})),"polygon"===a&&e.minSize.stops?.forEach((e=>{e.size*=1.8}))}const L=new Set(["unique-value","class-breaks"]),M=new t.default("#aaaaaa"),R=new t.default("#5c5c5c"),A=[new t.default("#e60049"),new t.default("#0bb4ff"),new t.default("#50e991"),new t.default("#e6d800"),new t.default("#9b19f5"),new t.default("#ffa300"),new t.default("#dc0ab4"),new t.default("#b3d4ff"),new t.default("#00bfa0"),new t.default("#f0cccc")];async function j(e){const a=await async function(e){if(!e||!e.layer)throw new l.default("pie-chart-cluster-renderer:missing-parameters","'layer' parameter is required");const a={...e};a.shape=a.shape||"pie",a.defaultSymbolEnabled??=!0;const r=e.layer;if(!(0,C.nn)(k).includes(r.type))throw new l.default("pie-chart-cluster-renderer:invalid-parameters","'layer' must be one of these types: "+(0,C.Ho)(k).join(", "));const t=null!=a.signal?{signal:a.signal}:null;if(await r.load(t),"point"!==r.geometryType)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","Cluster renderers are only supported for point layers");const n="renderer"in r?r.renderer:void 0;if(!n)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","input layer does not have a renderer.");if(!L.has(n.type))throw new l.default("pie-chart-cluster-renderer:invalid-parameters",`Cannot create a pie chart renderer for clusters based on a ${n.type} renderer.`);if("valueExpression"in n&&n.valueExpression)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a layer whose renderer contains a valueExpression.");if("unique-value"===n.type){if(n.field2)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a UniqueValueRenderer using more than one field.");if(null!=n.uniqueValueInfos&&n.uniqueValueInfos.length>10)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer cannot be created from a UniqueValueRenderer with more than 10 unique value infos.")}if("class-breaks"===n.type){if(n.classBreakInfos.length<2)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","Cannot create a pie chart renderer for clusters from a layer renderer with a continuous color or size gradient.");if(n.classBreakInfos.length>10)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer can not be created from a ClassBreaksRenderer with more than 10 class break infos.");if("class-breaks-size"===n?.authoringInfo?.type)throw new l.default("pie-chart-cluster-renderer:invalid-parameters","PieChart cluster renderer can not be created from a ClassBreaksRenderer with breaks varied by size instead of color.")}return a}(e),{layer:r,shape:t,defaultSymbolEnabled:n,legendOptions:o}=a,m="renderer"in r?r.renderer:void 0,h=(await(0,s.ud)("esri/smartMapping/t9n/smartMapping")).other;let y=[];"unique-value"===m?.type&&(y=function(e){const{renderer:a,defaultSymbolEnabled:r,defaultLabelBackup:t}=e,{field:n,defaultSymbol:l,defaultLabel:o}=a,s=a.uniqueValueInfos??[],d=l&&r,p=d?9:10,m=(0,i.Iy)(A,p),f=(n?s.slice(0,p).map(((e,a)=>{const r=e.label,t=m[a];return{field:new u.default({name:G(e.value?.toString()),alias:r,onStatisticExpression:new c.default({title:`Field definition - ${r}`,expression:J(n,e),returnType:"number"}),statisticType:"sum"}),color:H(e.symbol,t)}})):null)??[];if(d){const e="cluster_default",a=o||t;f.push({field:new u.default({name:G(e),alias:a,onStatisticExpression:new c.default({title:`Field definition - ${a}`,expression:N(n,s),returnType:"number"}),statisticType:"sum"}),color:H(l,R)})}return f}({renderer:m,defaultSymbolEnabled:n,defaultLabelBackup:h})),"class-breaks"===m?.type&&(y=function(e){const{renderer:a,defaultSymbolEnabled:r,defaultLabelBackup:t}=e,{field:n,classBreakInfos:l,defaultSymbol:o,defaultLabel:s}=a,d=o&&r,p=d?9:10,m=(0,i.Iy)(A,p),f=l.slice(0,p).map(((e,a)=>{const r=e.label||`${e.minValue} - ${e.maxValue}`,t=m[a];return{field:new u.default({name:G(r),alias:r,onStatisticExpression:new c.default({title:`Field definition - ${r}`,expression:_(n,e),returnType:"number"}),statisticType:"sum"}),color:H(e.symbol,t)}}));if(d){const e="cluster_default",a=s||t;f.push({field:new u.default({name:G(e),alias:a,onStatisticExpression:new c.default({title:`Field definition - ${a}`,expression:D(n,l),returnType:"number"}),statisticType:"sum"}),color:H(o,R)})}return f}({renderer:m,defaultSymbolEnabled:n,defaultLabelBackup:h}));const b=[],g=[];for(const i of y){const{field:e,color:a}=i;b.push(e),g.push(new p.default({color:a,field:e.name,label:e.alias}))}return{fields:b,renderer:new d.default({attributes:g,legendOptions:f.A.from(o),holePercentage:"donut"===t?.45:0,outline:null,size:9,othersCategory:null})}}function G(e){return"SUM_"+(e+"").replaceAll(/[^a-zA-Z0-9_]/g,"_")}function H(e,a){if("simple-marker"===e?.type&&e.color)return e.color.clone();if("cim"===e?.type){const a=(0,V.getCIMSymbolColor)(e);if(a)return a.clone()}return a?a.clone():M.clone()}function J(e,a){return`Number(Text($feature["${e}"]) == "${a.value+""}")`}function N(e,a){return`Number(!(${a.map((a=>`(Text($feature["${e}"]) == "${a.value+""}")`)).join(" || ")}))`}function _(e,a){return`Number($feature["${e}"] >= ${a.minValue} && $feature["${e}"] < ${a.maxValue})`}function D(e,a){return`Number(!(${a.map((a=>`($feature["${e}"] >= ${a.minValue} && $feature["${e}"] < ${a.maxValue})`)).join(" || ")}))`}},15231:(e,a,r)=>{r.r(a),r.d(a,{default:()=>o});var t=r(50076),n=r(28383),i=r(90494),l=r(11563);async function o(e){const{layerAdapter:a,...r}=await async function(e){if(!(e&&e.layer&&e.view&&e.fields))throw new t.default("predominant-categories:missing-parameters","'layer', 'view' and 'fields' parameters are required");e.forBinning&&(0,i.p)(e,"predominant-categories");const{layer:a,...r}=e,o=e.forBinning?l.Mi:l.G3,s=(0,l.Jg)(a,o,e.forBinning);if(!s)throw new t.default("predominant-categories:invalid-parameters","'layer' must be one of these types: "+(0,l.Ho)(o).join(", "));const u={layerAdapter:s,...r};await Promise.all([u.view.when(),s.load({signal:u.signal})]);const c=(0,n.MH)(s,u.fields,"predominant-categories:invalid-parameters");if(c)throw c;return u}(e);return a.predominantCategories(r)}},37590:(e,a,r)=>{r.r(a),r.d(a,{cloneScheme:()=>g,getSchemeByName:()=>y,getSchemes:()=>h,getSchemesByTag:()=>b,getThemes:()=>f});var t=r(69539),n=r(18690),i=r(59784),l=r(76281),o=r(89132),s=r(770);const u="#aaaaaa",c="25px",d={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},p=["vibrant-rainbow","cat-dark","predominant-v2","predominant-v5","predominance-race","desert-blooms","tropical-bliss","under-the-sea","ocean-bay","cat-light","predominant-v4","predominance-money","predominant-v3","predominance-race-ethnic","pastel-chalk","predominance-rainbow","predominance-sequence","cat-popup-olympic-sunset"],m=(0,s.bG)({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for visualizing features using a pie chart of categories.",schemes:{point:{light:{primary:"predominant-v1",secondary:p,common:{outline:d.light,colorForOthersCategory:u,size:c}},dark:{primary:"predominant-v2",secondary:p.map((e=>"predominant-v2"===e?"predominant-v1":e)),common:{outline:d.darker,colorForOthersCategory:u,size:c}}},polygon:{light:{primary:"predominant-v1",secondary:p,common:{colorForOthersCategory:u,outline:d.light,size:c}},dark:{primary:"predominant-v2",secondary:p.map((e=>"predominant-v2"===e?"predominant-v1":e)),common:{colorForOthersCategory:u,outline:d.dark,size:c}}}}}}});function f(e){return(0,s.vt)(m,e)}function h(e){const a=(0,s.Fq)({basemap:e.basemap,basemapTheme:e.basemapTheme,geometryType:e.geometryType,theme:m.get("default")});if(!a)return;const{schemesInfo:r,basemapId:t,basemapTheme:i}=a,o=r.common,u=e.numColors,c=(0,l.getSchemes)({basemap:e.basemap,geometryType:e.geometryType}),d=c?.primaryScheme;return{primaryScheme:w(r.primary,o,u,d),secondarySchemes:r.secondary.map((e=>w(e,o,u,d))).filter(n.Ru),basemapId:t,basemapTheme:i}}function y(e){return(0,s.Ty)(e.name,h(e))}function b(e){return(0,s.YJ)(e.includedTags,e.excludedTags,h(e))}function g(e){if(!e)return;const a={...e};return a.tags=[...a.tags],a.colors&&(a.colors=a.colors.map((e=>new t.default(e)))),a.colorForOthersCategory&&(a.colorForOthersCategory=new t.default(a.colorForOthersCategory)),a.outline&&(a.outline={color:a.outline.color&&new t.default(a.outline.color),width:a.outline.width}),"sizeScheme"in a&&a.sizeScheme&&(a.sizeScheme=(0,l.cloneScheme)(a.sizeScheme)),a}function w(e,a,r,n){const l=o.A[e];if(l)return function(e){return{name:e.name,tags:[...e.tags],colors:e.colors.map((e=>new t.default(e))),colorForOthersCategory:new t.default(e.colorForOthersCategory),outline:{color:new t.default(e.outline.color),width:e.outline.width},size:e.size,sizeScheme:e.sizeScheme}}({name:l.name,tags:l.tags,colors:l[r]||(0,i.Iy)(l.stops,r),colorForOthersCategory:a.colorForOthersCategory,outline:a.outline,size:a.size,sizeScheme:n})}}}]);
//# sourceMappingURL=5185.66df8262.chunk.js.map